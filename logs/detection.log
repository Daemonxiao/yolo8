2025-11-09 17:11:37,704 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}, {"deviceGbCode": "31011500001320000002", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00);(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}], "scene": "安全帽检测", "algorithm": "安全帽检测", "endDate": "2026-11-09 16:12:00"}
2025-11-09 17:11:37,704 - src.scene_manager - INFO - 开始部署场景: 安全帽检测, 算法: 安全帽检测, 设备数: 2
2025-11-09 17:11:37,704 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-09 17:11:37,705 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-09 17:11:37,715 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://localhost:8554/stream1
2025-11-09 17:11:37,715 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:11:38,523 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 帧率设置: fps_limit=0.2, frame_interval=5.0
2025-11-09 17:11:38,523 - src.detection_engine - INFO - 视频流检测启动成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:11:38,524 - src.stream_manager - INFO - 视频流启动成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:11:38,524 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程启动
2025-11-09 17:11:38,524 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已启动
2025-11-09 17:11:38,525 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-09 17:11:38,525 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000002 (尝试 1/3)
2025-11-09 17:11:38,533 - src.device_platform_client - INFO - 成功获取设备 31011500001320000002 的流地址: rtsp://localhost:8554/stream2
2025-11-09 17:11:38,533 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:11:39,307 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 视频设置:
2025-11-09 17:11:39,307 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-09 17:11:39,307 - src.detection_engine - INFO -   - 分辨率: 1920x1080
2025-11-09 17:11:39,307 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-09 17:11:39,308 - src.detection_engine - INFO - 开始处理视频流: scene_安全帽检测_31011500001320000001
2025-11-09 17:11:40,135 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 帧率设置: fps_limit=0.2, frame_interval=5.0
2025-11-09 17:11:40,135 - src.detection_engine - INFO - 视频流检测启动成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:11:40,136 - src.stream_manager - INFO - 视频流启动成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:11:40,136 - src.heartbeat_manager - INFO - 设备 31011500001320000002 心跳工作线程启动
2025-11-09 17:11:40,136 - src.heartbeat_manager - INFO - 设备 31011500001320000002 心跳线程已启动
2025-11-09 17:11:40,138 - src.scene_manager - INFO - 设备 31011500001320000002 部署成功
2025-11-09 17:11:40,138 - src.scene_manager - INFO - 场景部署完成: 成功2个, 失败0个
2025-11-09 17:11:40,138 - src.api_server - INFO - 场景下发成功: scene=安全帽检测, algorithm=安全帽检测
2025-11-09 17:11:40,960 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 视频设置:
2025-11-09 17:11:40,961 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-09 17:11:40,961 - src.detection_engine - INFO -   - 分辨率: 1920x1080
2025-11-09 17:11:40,961 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-09 17:11:40,961 - src.detection_engine - INFO - 开始处理视频流: scene_安全帽检测_31011500001320000002
2025-11-09 17:12:24,648 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 10 帧, 检测耗时: 0.038s
2025-11-09 17:12:26,178 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 10 帧, 检测耗时: 0.032s
2025-11-09 17:13:14,982 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 20 帧, 检测耗时: 0.104s, 实际帧间隔: 5.027s
2025-11-09 17:13:16,401 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 20 帧, 检测耗时: 0.029s, 实际帧间隔: 5.020s
2025-11-09 17:14:05,128 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 30 帧, 检测耗时: 0.035s, 实际帧间隔: 5.022s
2025-11-09 17:14:06,700 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 30 帧, 检测耗时: 0.033s, 实际帧间隔: 5.032s
2025-11-09 17:14:17,262 - src.detection_engine - WARNING - 读取帧失败: scene_安全帽检测_31011500001320000001
2025-11-09 17:14:17,267 - src.detection_engine - INFO - 尝试重连视频流，第 1 次
2025-11-09 17:14:27,424 - src.detection_engine - INFO - 视频流重连成功
2025-11-09 17:14:52,141 - src.detection_engine - WARNING - 读取帧失败: scene_安全帽检测_31011500001320000001
2025-11-09 17:14:52,142 - src.detection_engine - INFO - 尝试重连视频流，第 1 次
2025-11-09 17:14:56,981 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 40 帧, 检测耗时: 0.136s, 实际帧间隔: 5.017s
2025-11-09 17:15:02,284 - src.detection_engine - INFO - 视频流重连成功
2025-11-09 17:15:02,523 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.95
2025-11-09 17:15:27,501 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 40 帧, 检测耗时: 0.027s, 实际帧间隔: 8.230s
2025-11-09 17:15:37,533 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.90
2025-11-09 17:15:43,515 - __main__ - INFO - 接收到信号 2，正在关闭系统...
2025-11-09 17:15:43,516 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-09 17:15:43,517 - src.api_server - INFO - 正在停止API服务器...
2025-11-09 17:20:37,638 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-09 17:20:37,638 - src.config_manager - INFO - 重新加载配置文件
2025-11-09 17:20:37,644 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-09 17:20:37,645 - __main__ - INFO - 正在初始化系统组件...
2025-11-09 17:20:37,645 - __main__ - INFO - 预加载AI模型...
2025-11-09 17:20:37,645 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-09 17:20:37,782 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:20:37,782 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-09 17:20:37,881 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: mps
2025-11-09 17:20:37,881 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-09 17:20:37,983 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:20:37,984 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-09 17:20:38,060 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:20:38,060 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:20:38,226 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: mps
2025-11-09 17:20:38,227 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-09 17:20:38,227 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-09 17:20:38,227 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-09 17:20:38,227 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-09 17:20:38,227 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-09 17:20:38,227 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:20:38,227 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-09 17:20:38,227 - __main__ - INFO - 初始化检测引擎...
2025-11-09 17:20:38,227 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:20:38,277 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-09 17:20:38,277 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8080
2025-11-09 17:20:38,277 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-09 17:20:38,277 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-09 17:20:38,277 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-09 17:20:38,277 - __main__ - INFO - 初始化流管理器...
2025-11-09 17:20:38,277 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-09 17:20:38,277 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:20:38,277 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-09 17:20:38,277 - src.stream_manager - INFO - 流监控线程启动
2025-11-09 17:20:38,277 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-09 17:20:38,277 - __main__ - INFO - 初始化场景管理组件...
2025-11-09 17:20:38,277 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-09 17:20:38,277 - src.device_platform_client - INFO - 设备平台客户端初始化: http://127.0.0.1:8081
2025-11-09 17:20:38,277 - __main__ - INFO - 初始化报警系统...
2025-11-09 17:20:38,278 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-09 17:20:38,278 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-09 17:20:38,278 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-09 17:20:38,278 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-09 17:20:38,278 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-09 17:20:38,278 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-09 17:20:38,278 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:20:38,278 - __main__ - INFO - 初始化API服务器...
2025-11-09 17:20:38,284 - src.api_server - INFO - API服务器初始化完成
2025-11-09 17:20:38,284 - __main__ - INFO - 系统组件初始化完成
2025-11-09 17:20:38,284 - __main__ - INFO - 启动实时视频检测系统...
2025-11-09 17:20:38,284 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-09 17:20:38,284 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-09 17:20:44,073 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}, {"deviceGbCode": "31011500001320000002", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00);(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}], "scene": "安全帽检测", "algorithm": "安全帽检测", "endDate": "2026-11-09 16:12:00"}
2025-11-09 17:20:44,074 - src.scene_manager - INFO - 开始部署场景: 安全帽检测, 算法: 安全帽检测, 设备数: 2
2025-11-09 17:20:44,074 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-09 17:20:44,074 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-09 17:20:44,128 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://localhost:8554/stream1
2025-11-09 17:20:44,128 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:20:49,261 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 帧率设置: fps_limit=0.2, frame_interval=5.0
2025-11-09 17:20:49,261 - src.detection_engine - INFO - 视频流检测启动成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:20:49,261 - src.stream_manager - INFO - 视频流启动成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:20:49,262 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程启动
2025-11-09 17:20:49,262 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已启动
2025-11-09 17:20:49,262 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-09 17:20:49,262 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000002 (尝试 1/3)
2025-11-09 17:20:49,272 - src.device_platform_client - INFO - 成功获取设备 31011500001320000002 的流地址: rtsp://localhost:8554/stream2
2025-11-09 17:20:49,273 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:20:52,205 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 视频设置:
2025-11-09 17:20:52,206 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-09 17:20:52,206 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-09 17:20:52,206 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-09 17:20:52,206 - src.detection_engine - INFO - 开始处理视频流: scene_安全帽检测_31011500001320000001
2025-11-09 17:20:52,989 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 帧率设置: fps_limit=0.2, frame_interval=5.0
2025-11-09 17:20:52,989 - src.detection_engine - INFO - 视频流检测启动成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:20:52,989 - src.stream_manager - INFO - 视频流启动成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:20:52,989 - src.heartbeat_manager - INFO - 设备 31011500001320000002 心跳工作线程启动
2025-11-09 17:20:52,989 - src.heartbeat_manager - INFO - 设备 31011500001320000002 心跳线程已启动
2025-11-09 17:20:52,989 - src.scene_manager - INFO - 设备 31011500001320000002 部署成功
2025-11-09 17:20:52,990 - src.scene_manager - INFO - 场景部署完成: 成功2个, 失败0个
2025-11-09 17:20:52,990 - src.api_server - INFO - 场景下发成功: scene=安全帽检测, algorithm=安全帽检测
2025-11-09 17:20:53,781 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 视频设置:
2025-11-09 17:20:53,781 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-09 17:20:53,781 - src.detection_engine - INFO -   - 分辨率: 1920x1080
2025-11-09 17:20:53,781 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-09 17:20:53,781 - src.detection_engine - INFO - 开始处理视频流: scene_安全帽检测_31011500001320000002
2025-11-09 17:21:02,518 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.84
2025-11-09 17:21:32,556 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.84
2025-11-09 17:21:37,575 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 10 帧, 检测耗时: 0.037s
2025-11-09 17:21:39,017 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 10 帧, 检测耗时: 0.027s
2025-11-09 17:22:02,819 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.91
2025-11-09 17:22:02,820 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_安全帽检测_31011500001320000001, 类别=head, 置信度=0.91
2025-11-09 17:22:02,820 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_安全帽检测_31011500001320000001 | 类别: head | 置信度: 0.91 | 级别: high | 连续帧数: 6
2025-11-09 17:22:02,831 - src.device_platform_client - INFO - 告警发送成功: 31011500001320000001, 类型: head
2025-11-09 17:22:02,831 - src.alarm_system - INFO - 告警回调发送成功: 31011500001320000001, 类型: head
2025-11-09 17:22:27,991 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 20 帧, 检测耗时: 0.179s, 实际帧间隔: 5.025s
2025-11-09 17:22:28,640 - __main__ - INFO - 接收到信号 2，正在关闭系统...
2025-11-09 17:22:28,640 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-09 17:22:28,640 - src.api_server - INFO - 正在停止API服务器...
2025-11-09 17:22:29,223 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 20 帧, 检测耗时: 0.032s, 实际帧间隔: 5.018s
2025-11-09 17:22:32,904 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-09 17:22:33,645 - src.api_server - INFO - API服务器已停止
2025-11-09 17:22:42,020 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-09 17:22:42,020 - src.config_manager - INFO - 重新加载配置文件
2025-11-09 17:22:42,043 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-09 17:22:42,043 - __main__ - INFO - 正在初始化系统组件...
2025-11-09 17:22:42,043 - __main__ - INFO - 预加载AI模型...
2025-11-09 17:22:42,043 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-09 17:22:42,173 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:22:42,173 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-09 17:22:42,350 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:22:42,350 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-09 17:22:42,475 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:22:42,475 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-09 17:22:42,625 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: mps
2025-11-09 17:22:42,625 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:22:42,858 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: mps
2025-11-09 17:22:42,859 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-09 17:22:42,859 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-09 17:22:42,859 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-09 17:22:42,859 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-09 17:22:42,859 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-09 17:22:42,859 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:22:42,859 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-09 17:22:42,859 - __main__ - INFO - 初始化检测引擎...
2025-11-09 17:22:42,859 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:22:42,942 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-09 17:22:42,943 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8080
2025-11-09 17:22:42,943 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-09 17:22:42,943 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-09 17:22:42,943 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-09 17:22:42,943 - __main__ - INFO - 初始化流管理器...
2025-11-09 17:22:42,943 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-09 17:22:42,944 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:22:42,944 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-09 17:22:42,944 - src.stream_manager - INFO - 流监控线程启动
2025-11-09 17:22:42,944 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-09 17:22:42,944 - __main__ - INFO - 初始化场景管理组件...
2025-11-09 17:22:42,944 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-09 17:22:42,945 - src.device_platform_client - INFO - 设备平台客户端初始化: http://127.0.0.1:8081
2025-11-09 17:22:42,945 - __main__ - INFO - 初始化报警系统...
2025-11-09 17:22:42,948 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-09 17:22:42,948 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-09 17:22:42,948 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-09 17:22:42,948 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-09 17:22:42,949 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-09 17:22:42,949 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-09 17:22:42,949 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:22:42,949 - __main__ - INFO - 初始化API服务器...
2025-11-09 17:22:42,958 - src.api_server - INFO - API服务器初始化完成
2025-11-09 17:22:42,958 - __main__ - INFO - 系统组件初始化完成
2025-11-09 17:22:42,959 - __main__ - INFO - 启动实时视频检测系统...
2025-11-09 17:22:42,959 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-09 17:22:42,961 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-09 17:22:56,291 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}, {"deviceGbCode": "31011500001320000002", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00);(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}], "scene": "安全帽检测", "algorithm": "安全帽检测", "endDate": "2026-11-09 16:12:00"}
2025-11-09 17:22:56,291 - src.scene_manager - INFO - 开始部署场景: 安全帽检测, 算法: 安全帽检测, 设备数: 2
2025-11-09 17:22:56,291 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-09 17:22:56,291 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-09 17:22:56,302 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://localhost:8554/stream1
2025-11-09 17:22:56,302 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:22:57,378 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 帧率设置: fps_limit=0.2, frame_interval=5.0
2025-11-09 17:22:57,378 - src.detection_engine - INFO - 视频流检测启动成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:22:57,379 - src.stream_manager - INFO - 视频流启动成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:22:57,379 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程启动
2025-11-09 17:22:57,380 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已启动
2025-11-09 17:22:57,381 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-09 17:22:57,382 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000002 (尝试 1/3)
2025-11-09 17:22:57,393 - src.device_platform_client - INFO - 成功获取设备 31011500001320000002 的流地址: rtsp://localhost:8554/stream2
2025-11-09 17:22:57,393 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:23:02,505 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 视频设置:
2025-11-09 17:23:02,505 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-09 17:23:02,505 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-09 17:23:02,505 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-09 17:23:02,506 - src.detection_engine - INFO - 开始处理视频流: scene_安全帽检测_31011500001320000001
2025-11-09 17:23:03,313 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 帧率设置: fps_limit=0.2, frame_interval=5.0
2025-11-09 17:23:03,313 - src.detection_engine - INFO - 视频流检测启动成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:23:03,313 - src.stream_manager - INFO - 视频流启动成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:23:03,314 - src.heartbeat_manager - INFO - 设备 31011500001320000002 心跳工作线程启动
2025-11-09 17:23:03,314 - src.heartbeat_manager - INFO - 设备 31011500001320000002 心跳线程已启动
2025-11-09 17:23:03,315 - src.scene_manager - INFO - 设备 31011500001320000002 部署成功
2025-11-09 17:23:03,316 - src.scene_manager - INFO - 场景部署完成: 成功2个, 失败0个
2025-11-09 17:23:03,316 - src.api_server - INFO - 场景下发成功: scene=安全帽检测, algorithm=安全帽检测
2025-11-09 17:23:04,117 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 视频设置:
2025-11-09 17:23:04,118 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-09 17:23:04,118 - src.detection_engine - INFO -   - 分辨率: 1920x1080
2025-11-09 17:23:04,118 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-09 17:23:04,118 - src.detection_engine - INFO - 开始处理视频流: scene_安全帽检测_31011500001320000002
2025-11-09 17:23:12,698 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.94
2025-11-09 17:23:42,902 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.95
2025-11-09 17:23:47,838 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 10 帧, 检测耗时: 0.046s
2025-11-09 17:23:49,330 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 10 帧, 检测耗时: 0.031s
2025-11-09 17:24:12,994 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.94
2025-11-09 17:24:12,994 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_安全帽检测_31011500001320000001, 类别=head, 置信度=0.94
2025-11-09 17:24:12,995 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_安全帽检测_31011500001320000001 | 类别: head | 置信度: 0.94 | 级别: high | 连续帧数: 6
2025-11-09 17:24:12,999 - src.device_platform_client - INFO - 告警发送成功: 31011500001320000001, 类型: head
2025-11-09 17:24:12,999 - src.alarm_system - INFO - 告警回调发送成功: 31011500001320000001, 类型: head
2025-11-09 17:24:38,131 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 20 帧, 检测耗时: 0.075s, 实际帧间隔: 5.027s
2025-11-09 17:24:39,515 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 20 帧, 检测耗时: 0.035s, 实际帧间隔: 5.019s
2025-11-09 17:24:43,126 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-09 17:25:13,408 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.87
2025-11-09 17:25:28,749 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 30 帧, 检测耗时: 0.437s, 实际帧间隔: 5.026s
2025-11-09 17:25:29,713 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 30 帧, 检测耗时: 0.032s, 实际帧间隔: 5.019s
2025-11-09 17:25:43,708 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.90
2025-11-09 17:25:43,708 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_安全帽检测_31011500001320000001, 类别=head, 置信度=0.90
2025-11-09 17:25:43,709 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_安全帽检测_31011500001320000001 | 类别: head | 置信度: 0.90 | 级别: high | 连续帧数: 6
2025-11-09 17:25:43,720 - src.device_platform_client - INFO - 告警发送成功: 31011500001320000001, 类型: head
2025-11-09 17:25:43,720 - src.alarm_system - INFO - 告警回调发送成功: 31011500001320000001, 类型: head
2025-11-09 17:26:13,773 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.94
2025-11-09 17:26:18,926 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 40 帧, 检测耗时: 0.185s, 实际帧间隔: 5.040s
2025-11-09 17:26:19,998 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 40 帧, 检测耗时: 0.044s, 实际帧间隔: 5.027s
2025-11-09 17:26:43,976 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-09 17:27:07,511 - __main__ - INFO - 接收到信号 2，正在关闭系统...
2025-11-09 17:27:07,512 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-09 17:27:07,512 - src.api_server - INFO - 正在停止API服务器...
2025-11-09 17:27:09,036 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 50 帧, 检测耗时: 0.160s, 实际帧间隔: 5.017s
2025-11-09 17:27:10,165 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 50 帧, 检测耗时: 0.036s, 实际帧间隔: 5.019s
2025-11-09 17:27:12,517 - src.api_server - INFO - API服务器已停止
2025-11-09 17:27:13,004 - src.scene_manager - INFO - 场景管理器已停止
2025-11-09 17:27:13,005 - __main__ - ERROR - 系统关闭时发生错误: 'HeartbeatManager' object has no attribute 'stop'
2025-11-09 17:27:15,488 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-09 17:27:15,488 - src.config_manager - INFO - 重新加载配置文件
2025-11-09 17:27:15,511 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-09 17:27:15,511 - __main__ - INFO - 正在初始化系统组件...
2025-11-09 17:27:15,511 - __main__ - INFO - 预加载AI模型...
2025-11-09 17:27:15,511 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-09 17:27:15,659 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:27:15,659 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-09 17:27:15,780 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: mps
2025-11-09 17:27:15,780 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-09 17:27:15,902 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:27:15,902 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-09 17:27:16,095 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:27:16,095 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:27:16,359 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: mps
2025-11-09 17:27:16,359 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-09 17:27:16,359 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-09 17:27:16,360 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-09 17:27:16,360 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-09 17:27:16,360 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-09 17:27:16,360 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:27:16,360 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-09 17:27:16,360 - __main__ - INFO - 初始化检测引擎...
2025-11-09 17:27:16,360 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:27:16,442 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-09 17:27:16,442 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8080
2025-11-09 17:27:16,442 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-09 17:27:16,442 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-09 17:27:16,442 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-09 17:27:16,442 - __main__ - INFO - 初始化流管理器...
2025-11-09 17:27:16,443 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-09 17:27:16,443 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:27:16,443 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-09 17:27:16,443 - src.stream_manager - INFO - 流监控线程启动
2025-11-09 17:27:16,443 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-09 17:27:16,443 - __main__ - INFO - 初始化场景管理组件...
2025-11-09 17:27:16,444 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-09 17:27:16,444 - src.device_platform_client - INFO - 设备平台客户端初始化: http://127.0.0.1:8081
2025-11-09 17:27:16,444 - __main__ - INFO - 初始化报警系统...
2025-11-09 17:27:16,445 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-09 17:27:16,446 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-09 17:27:16,446 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-09 17:27:16,446 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-09 17:27:16,449 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-09 17:27:16,449 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-09 17:27:16,449 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:27:16,449 - __main__ - INFO - 初始化API服务器...
2025-11-09 17:27:16,458 - src.api_server - INFO - API服务器初始化完成
2025-11-09 17:27:16,458 - __main__ - INFO - 系统组件初始化完成
2025-11-09 17:27:16,459 - __main__ - INFO - 启动实时视频检测系统...
2025-11-09 17:27:16,459 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-09 17:27:16,460 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-09 17:27:26,116 - __main__ - INFO - 接收到信号 2，正在关闭系统...
2025-11-09 17:27:26,117 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-09 17:27:26,117 - src.api_server - INFO - 正在停止API服务器...
2025-11-09 17:27:56,353 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-09 17:27:56,353 - src.config_manager - INFO - 重新加载配置文件
2025-11-09 17:27:56,376 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-09 17:27:56,377 - __main__ - INFO - 正在初始化系统组件...
2025-11-09 17:27:56,377 - __main__ - INFO - 预加载AI模型...
2025-11-09 17:27:56,377 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-09 17:27:56,537 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:27:56,537 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-09 17:27:56,651 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: mps
2025-11-09 17:27:56,651 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-09 17:27:56,753 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:27:56,753 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-09 17:27:56,877 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:27:56,877 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:27:57,088 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: mps
2025-11-09 17:27:57,088 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-09 17:27:57,089 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-09 17:27:57,089 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-09 17:27:57,089 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-09 17:27:57,089 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-09 17:27:57,089 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:27:57,089 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-09 17:27:57,089 - __main__ - INFO - 初始化检测引擎...
2025-11-09 17:27:57,089 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:27:57,166 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-09 17:27:57,166 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8080
2025-11-09 17:27:57,166 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-09 17:27:57,166 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-09 17:27:57,166 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-09 17:27:57,166 - __main__ - INFO - 初始化流管理器...
2025-11-09 17:27:57,166 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-09 17:27:57,166 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:27:57,166 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-09 17:27:57,167 - src.stream_manager - INFO - 流监控线程启动
2025-11-09 17:27:57,169 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-09 17:27:57,169 - __main__ - INFO - 初始化场景管理组件...
2025-11-09 17:27:57,169 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-09 17:27:57,169 - src.device_platform_client - INFO - 设备平台客户端初始化: http://127.0.0.1:8081
2025-11-09 17:27:57,169 - __main__ - INFO - 初始化报警系统...
2025-11-09 17:27:57,171 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-09 17:27:57,172 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-09 17:27:57,172 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-09 17:27:57,172 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-09 17:27:57,172 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-09 17:27:57,172 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-09 17:27:57,172 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:27:57,173 - __main__ - INFO - 初始化API服务器...
2025-11-09 17:27:57,182 - src.api_server - INFO - API服务器初始化完成
2025-11-09 17:27:57,182 - __main__ - INFO - 系统组件初始化完成
2025-11-09 17:27:57,183 - __main__ - INFO - 启动实时视频检测系统...
2025-11-09 17:27:57,183 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-09 17:27:57,185 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-09 17:28:02,276 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}, {"deviceGbCode": "31011500001320000002", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00);(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}], "scene": "安全帽检测", "algorithm": "安全帽检测", "endDate": "2026-11-09 16:12:00"}
2025-11-09 17:28:02,276 - src.scene_manager - INFO - 开始部署场景: 安全帽检测, 算法: 安全帽检测, 设备数: 2
2025-11-09 17:28:02,277 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-09 17:28:02,277 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-09 17:28:02,294 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://localhost:8554/stream1
2025-11-09 17:28:02,295 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:28:06,018 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-09 17:28:06,018 - src.detection_engine - INFO - 视频流检测启动成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:28:06,018 - src.stream_manager - INFO - 视频流启动成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:28:06,019 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程启动
2025-11-09 17:28:06,019 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已启动
2025-11-09 17:28:06,020 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-09 17:28:06,020 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000002 (尝试 1/3)
2025-11-09 17:28:06,028 - src.device_platform_client - INFO - 成功获取设备 31011500001320000002 的流地址: rtsp://localhost:8554/stream2
2025-11-09 17:28:06,028 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:28:11,120 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 视频设置:
2025-11-09 17:28:11,121 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-09 17:28:11,121 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-09 17:28:11,121 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-09 17:28:11,121 - src.detection_engine - INFO - 开始处理视频流: scene_安全帽检测_31011500001320000001
2025-11-09 17:28:11,948 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-09 17:28:11,949 - src.detection_engine - INFO - 视频流检测启动成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:28:11,949 - src.stream_manager - INFO - 视频流启动成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:28:11,950 - src.heartbeat_manager - INFO - 设备 31011500001320000002 心跳工作线程启动
2025-11-09 17:28:11,950 - src.heartbeat_manager - INFO - 设备 31011500001320000002 心跳线程已启动
2025-11-09 17:28:11,951 - src.scene_manager - INFO - 设备 31011500001320000002 部署成功
2025-11-09 17:28:11,951 - src.scene_manager - INFO - 场景部署完成: 成功2个, 失败0个
2025-11-09 17:28:11,952 - src.api_server - INFO - 场景下发成功: scene=安全帽检测, algorithm=安全帽检测
2025-11-09 17:28:12,805 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 视频设置:
2025-11-09 17:28:12,807 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-09 17:28:12,807 - src.detection_engine - INFO -   - 分辨率: 1920x1080
2025-11-09 17:28:12,808 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-09 17:28:12,808 - src.detection_engine - INFO - 开始处理视频流: scene_安全帽检测_31011500001320000002
2025-11-09 17:28:16,321 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.95
2025-11-09 17:28:23,451 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 10 帧, 检测耗时: 0.030s
2025-11-09 17:28:24,666 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 10 帧, 检测耗时: 0.022s
2025-11-09 17:28:33,711 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 20 帧, 检测耗时: 0.029s, 实际帧间隔: 1.023s
2025-11-09 17:28:34,855 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 20 帧, 检测耗时: 0.020s, 实际帧间隔: 1.019s
2025-11-09 17:28:43,901 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 30 帧, 检测耗时: 0.032s, 实际帧间隔: 1.022s
2025-11-09 17:28:45,109 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 30 帧, 检测耗时: 0.029s, 实际帧间隔: 1.024s
2025-11-09 17:28:46,992 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.94
2025-11-09 17:28:54,048 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 40 帧, 检测耗时: 0.030s, 实际帧间隔: 1.015s
2025-11-09 17:28:55,366 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 40 帧, 检测耗时: 0.022s, 实际帧间隔: 1.027s
2025-11-09 17:29:04,195 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 50 帧, 检测耗时: 0.031s, 实际帧间隔: 1.016s
2025-11-09 17:29:05,602 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 50 帧, 检测耗时: 0.022s, 实际帧间隔: 1.025s
2025-11-09 17:29:14,487 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 60 帧, 检测耗时: 0.067s, 实际帧间隔: 1.022s
2025-11-09 17:29:15,841 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 60 帧, 检测耗时: 0.023s, 实际帧间隔: 1.020s
2025-11-09 17:29:17,690 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-09 17:29:17,691 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_安全帽检测_31011500001320000001, 类别=head, 置信度=0.93
2025-11-09 17:29:17,693 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_安全帽检测_31011500001320000001 | 类别: head | 置信度: 0.93 | 级别: high | 连续帧数: 30
2025-11-09 17:29:17,727 - src.device_platform_client - INFO - 告警发送成功: 31011500001320000001, 类型: head
2025-11-09 17:29:17,727 - src.alarm_system - INFO - 告警回调发送成功: 31011500001320000001, 类型: head
2025-11-09 17:29:24,739 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 70 帧, 检测耗时: 0.062s, 实际帧间隔: 1.026s
2025-11-09 17:29:26,127 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 70 帧, 检测耗时: 0.023s, 实际帧间隔: 1.031s
2025-11-09 17:29:34,932 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 80 帧, 检测耗时: 0.029s, 实际帧间隔: 1.024s
2025-11-09 17:29:36,352 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 80 帧, 检测耗时: 0.024s, 实际帧间隔: 1.019s
2025-11-09 17:29:45,126 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 90 帧, 检测耗时: 0.029s, 实际帧间隔: 1.020s
2025-11-09 17:29:46,611 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 90 帧, 检测耗时: 0.022s, 实际帧间隔: 1.026s
2025-11-09 17:29:48,175 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.83
2025-11-09 17:29:55,621 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 100 帧, 检测耗时: 0.106s, 实际帧间隔: 1.022s
2025-11-09 17:29:56,810 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 100 帧, 检测耗时: 0.054s, 实际帧间隔: 1.017s
2025-11-09 17:30:05,513 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 110 帧, 检测耗时: 0.032s, 实际帧间隔: 1.015s
2025-11-09 17:30:07,006 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 110 帧, 检测耗时: 0.027s, 实际帧间隔: 1.024s
2025-11-09 17:30:15,665 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 120 帧, 检测耗时: 0.045s, 实际帧间隔: 1.012s
2025-11-09 17:30:17,223 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 120 帧, 检测耗时: 0.033s, 实际帧间隔: 1.022s
2025-11-09 17:30:18,767 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.80
2025-11-09 17:30:25,821 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 130 帧, 检测耗时: 0.030s, 实际帧间隔: 1.020s
2025-11-09 17:30:27,511 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 130 帧, 检测耗时: 0.041s, 实际帧间隔: 1.025s
2025-11-09 17:30:35,959 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 140 帧, 检测耗时: 0.028s, 实际帧间隔: 1.017s
2025-11-09 17:30:37,653 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 140 帧, 检测耗时: 0.027s, 实际帧间隔: 1.018s
2025-11-09 17:30:46,287 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 150 帧, 检测耗时: 0.039s, 实际帧间隔: 1.027s
2025-11-09 17:30:47,843 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 150 帧, 检测耗时: 0.024s, 实际帧间隔: 1.020s
2025-11-09 17:30:49,354 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.90
2025-11-09 17:30:49,355 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_安全帽检测_31011500001320000001, 类别=head, 置信度=0.90
2025-11-09 17:30:49,355 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_安全帽检测_31011500001320000001 | 类别: head | 置信度: 0.90 | 级别: high | 连续帧数: 30
2025-11-09 17:30:49,359 - src.device_platform_client - INFO - 告警发送成功: 31011500001320000001, 类型: head
2025-11-09 17:30:49,359 - src.alarm_system - INFO - 告警回调发送成功: 31011500001320000001, 类型: head
2025-11-09 17:30:56,740 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 160 帧, 检测耗时: 0.198s, 实际帧间隔: 1.032s
2025-11-09 17:30:58,078 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 160 帧, 检测耗时: 0.023s, 实际帧间隔: 1.023s
2025-11-09 17:31:06,837 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 170 帧, 检测耗时: 0.031s, 实际帧间隔: 1.028s
2025-11-09 17:31:08,233 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 170 帧, 检测耗时: 0.024s, 实际帧间隔: 1.013s
2025-11-09 17:31:17,008 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 180 帧, 检测耗时: 0.023s, 实际帧间隔: 1.024s
2025-11-09 17:31:18,340 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 180 帧, 检测耗时: 0.025s, 实际帧间隔: 1.009s
2025-11-09 17:31:20,172 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.76
2025-11-09 17:31:27,267 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 190 帧, 检测耗时: 0.028s, 实际帧间隔: 1.019s
2025-11-09 17:31:28,600 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 190 帧, 检测耗时: 0.030s, 实际帧间隔: 1.026s
2025-11-09 17:31:37,482 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 200 帧, 检测耗时: 0.030s, 实际帧间隔: 1.019s
2025-11-09 17:31:38,855 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 200 帧, 检测耗时: 0.023s, 实际帧间隔: 1.026s
2025-11-09 17:31:47,661 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 210 帧, 检测耗时: 0.043s, 实际帧间隔: 1.012s
2025-11-09 17:31:49,353 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 210 帧, 检测耗时: 0.284s, 实际帧间隔: 1.026s
2025-11-09 17:31:50,589 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.94
2025-11-09 17:31:57,863 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 220 帧, 检测耗时: 0.044s, 实际帧间隔: 1.022s
2025-11-09 17:31:59,349 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 220 帧, 检测耗时: 0.045s, 实际帧间隔: 1.022s
2025-11-09 17:32:08,049 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 230 帧, 检测耗时: 0.036s, 实际帧间隔: 1.024s
2025-11-09 17:32:09,620 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 230 帧, 检测耗时: 0.031s, 实际帧间隔: 1.018s
2025-11-09 17:32:18,297 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 240 帧, 检测耗时: 0.034s, 实际帧间隔: 1.026s
2025-11-09 17:32:19,684 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 240 帧, 检测耗时: 0.026s, 实际帧间隔: 1.017s
2025-11-09 17:32:21,370 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.87
2025-11-09 17:32:21,371 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_安全帽检测_31011500001320000001, 类别=head, 置信度=0.87
2025-11-09 17:32:21,371 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_安全帽检测_31011500001320000001 | 类别: head | 置信度: 0.87 | 级别: high | 连续帧数: 30
2025-11-09 17:32:21,385 - src.device_platform_client - INFO - 告警发送成功: 31011500001320000001, 类型: head
2025-11-09 17:32:21,385 - src.alarm_system - INFO - 告警回调发送成功: 31011500001320000001, 类型: head
2025-11-09 17:32:28,486 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 250 帧, 检测耗时: 0.029s, 实际帧间隔: 1.018s
2025-11-09 17:32:29,865 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 250 帧, 检测耗时: 0.020s, 实际帧间隔: 1.019s
2025-11-09 17:32:32,744 - __main__ - INFO - 接收到信号 2，正在关闭系统...
2025-11-09 17:32:32,744 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-09 17:32:32,744 - src.api_server - INFO - 正在停止API服务器...
2025-11-09 17:32:37,749 - src.api_server - INFO - API服务器已停止
2025-11-09 17:32:38,660 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 260 帧, 检测耗时: 0.033s, 实际帧间隔: 1.015s
2025-11-09 17:32:40,111 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 260 帧, 检测耗时: 0.023s, 实际帧间隔: 1.024s
2025-11-09 17:32:42,754 - src.scene_manager - INFO - 场景管理器已停止
2025-11-09 17:32:42,754 - __main__ - ERROR - 系统关闭时发生错误: 'HeartbeatManager' object has no attribute 'stop'
2025-11-09 17:32:45,043 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-09 17:32:45,043 - src.config_manager - INFO - 重新加载配置文件
2025-11-09 17:32:45,065 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-09 17:32:45,065 - __main__ - INFO - 正在初始化系统组件...
2025-11-09 17:32:45,065 - __main__ - INFO - 预加载AI模型...
2025-11-09 17:32:45,066 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-09 17:32:45,208 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:32:45,208 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-09 17:32:45,372 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:32:45,372 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-09 17:32:45,506 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:32:45,506 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:32:45,743 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: mps
2025-11-09 17:32:45,743 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-09 17:32:45,861 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: mps
2025-11-09 17:32:45,862 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-09 17:32:45,862 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-09 17:32:45,862 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-09 17:32:45,862 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-09 17:32:45,862 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-09 17:32:45,862 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:32:45,862 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-09 17:32:45,862 - __main__ - INFO - 初始化检测引擎...
2025-11-09 17:32:45,862 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:32:45,939 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-09 17:32:45,939 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8080
2025-11-09 17:32:45,939 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-09 17:32:45,939 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-09 17:32:45,939 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-09 17:32:45,939 - __main__ - INFO - 初始化流管理器...
2025-11-09 17:32:45,939 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-09 17:32:45,939 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:32:45,939 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-09 17:32:45,940 - src.stream_manager - INFO - 流监控线程启动
2025-11-09 17:32:45,940 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-09 17:32:45,940 - __main__ - INFO - 初始化场景管理组件...
2025-11-09 17:32:45,940 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-09 17:32:45,940 - src.device_platform_client - INFO - 设备平台客户端初始化: http://127.0.0.1:8081
2025-11-09 17:32:45,940 - __main__ - INFO - 初始化报警系统...
2025-11-09 17:32:45,943 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-09 17:32:45,943 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-09 17:32:45,943 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-09 17:32:45,943 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-09 17:32:45,944 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-09 17:32:45,945 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-09 17:32:45,945 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:32:45,945 - __main__ - INFO - 初始化API服务器...
2025-11-09 17:32:45,956 - src.api_server - INFO - API服务器初始化完成
2025-11-09 17:32:45,956 - __main__ - INFO - 系统组件初始化完成
2025-11-09 17:32:45,957 - __main__ - INFO - 启动实时视频检测系统...
2025-11-09 17:32:45,957 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-09 17:32:45,958 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-09 17:32:51,938 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}, {"deviceGbCode": "31011500001320000002", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00);(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}], "scene": "安全帽检测", "algorithm": "安全帽检测", "endDate": "2026-11-09 16:12:00"}
2025-11-09 17:32:51,938 - src.scene_manager - INFO - 开始部署场景: 安全帽检测, 算法: 安全帽检测, 设备数: 2
2025-11-09 17:32:51,938 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-09 17:32:51,938 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-09 17:32:51,956 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://localhost:8554/stream1
2025-11-09 17:32:51,956 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:32:57,073 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-09 17:32:57,074 - src.detection_engine - INFO - 视频流检测启动成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:32:57,074 - src.stream_manager - INFO - 视频流启动成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:32:57,074 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程启动
2025-11-09 17:32:57,075 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已启动
2025-11-09 17:32:57,075 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-09 17:32:57,075 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000002 (尝试 1/3)
2025-11-09 17:32:57,082 - src.device_platform_client - INFO - 成功获取设备 31011500001320000002 的流地址: rtsp://localhost:8554/stream2
2025-11-09 17:32:57,083 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:33:02,209 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 视频设置:
2025-11-09 17:33:02,210 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-09 17:33:02,210 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-09 17:33:02,215 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-09 17:33:02,215 - src.detection_engine - INFO - 开始处理视频流: scene_安全帽检测_31011500001320000001
2025-11-09 17:33:03,012 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-09 17:33:03,012 - src.detection_engine - INFO - 视频流检测启动成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:33:03,012 - src.stream_manager - INFO - 视频流启动成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:33:03,013 - src.heartbeat_manager - INFO - 设备 31011500001320000002 心跳工作线程启动
2025-11-09 17:33:03,014 - src.heartbeat_manager - INFO - 设备 31011500001320000002 心跳线程已启动
2025-11-09 17:33:03,014 - src.scene_manager - INFO - 设备 31011500001320000002 部署成功
2025-11-09 17:33:03,015 - src.scene_manager - INFO - 场景部署完成: 成功2个, 失败0个
2025-11-09 17:33:03,015 - src.api_server - INFO - 场景下发成功: scene=安全帽检测, algorithm=安全帽检测
2025-11-09 17:33:03,817 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 视频设置:
2025-11-09 17:33:03,817 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-09 17:33:03,817 - src.detection_engine - INFO -   - 分辨率: 1920x1080
2025-11-09 17:33:03,817 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-09 17:33:03,817 - src.detection_engine - INFO - 开始处理视频流: scene_安全帽检测_31011500001320000002
2025-11-09 17:33:08,084 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_安全帽检测_31011500001320000001, image_url=http://localhost:8080/results/2025-11-09/scene_安全帽检测_31011500001320000001/17-33-08-007_frame_2/annotated.png
2025-11-09 17:33:08,084 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.85
2025-11-09 17:33:15,124 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 10 帧, 检测耗时: 0.024s
2025-11-09 17:33:16,801 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 10 帧, 检测耗时: 0.021s
2025-11-09 17:33:25,413 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 20 帧, 检测耗时: 0.032s, 实际帧间隔: 1.028s
2025-11-09 17:33:27,059 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 20 帧, 检测耗时: 0.022s, 实际帧间隔: 1.024s
2025-11-09 17:33:35,656 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 30 帧, 检测耗时: 0.026s, 实际帧间隔: 1.024s
2025-11-09 17:33:37,282 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 30 帧, 检测耗时: 0.019s, 实际帧间隔: 1.019s
2025-11-09 17:33:38,716 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_安全帽检测_31011500001320000001, image_url=http://localhost:8080/results/2025-11-09/scene_安全帽检测_31011500001320000001/17-33-38-645_frame_32/annotated.png
2025-11-09 17:33:38,717 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.90
2025-11-09 17:33:45,891 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 40 帧, 检测耗时: 0.026s, 实际帧间隔: 1.024s
2025-11-09 17:33:47,491 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 40 帧, 检测耗时: 0.024s, 实际帧间隔: 1.026s
2025-11-09 17:33:49,963 - __main__ - INFO - 接收到信号 2，正在关闭系统...
2025-11-09 17:33:49,963 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-09 17:33:49,963 - src.api_server - INFO - 正在停止API服务器...
2025-11-09 17:33:54,968 - src.api_server - INFO - API服务器已停止
2025-11-09 17:54:37,488 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-09 17:54:37,488 - src.config_manager - INFO - 重新加载配置文件
2025-11-09 17:54:37,510 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-09 17:54:37,510 - __main__ - INFO - 正在初始化系统组件...
2025-11-09 17:54:37,510 - __main__ - INFO - 预加载AI模型...
2025-11-09 17:54:37,510 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-09 17:54:37,645 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:54:37,645 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-09 17:54:37,789 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:54:37,789 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-09 17:54:37,900 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: mps
2025-11-09 17:54:37,900 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:54:38,109 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: mps
2025-11-09 17:54:38,110 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-09 17:54:38,213 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:54:38,213 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-09 17:54:38,213 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-09 17:54:38,213 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-09 17:54:38,213 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-09 17:54:38,213 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-09 17:54:38,214 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:54:38,214 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-09 17:54:38,214 - __main__ - INFO - 初始化检测引擎...
2025-11-09 17:54:38,214 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:54:38,294 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-09 17:54:38,294 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8080
2025-11-09 17:54:38,294 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-09 17:54:38,294 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-09 17:54:38,294 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-09 17:54:38,294 - __main__ - INFO - 初始化流管理器...
2025-11-09 17:54:38,294 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-09 17:54:38,294 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:54:38,294 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-09 17:54:38,295 - src.stream_manager - INFO - 流监控线程启动
2025-11-09 17:54:38,295 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-09 17:54:38,295 - __main__ - INFO - 初始化场景管理组件...
2025-11-09 17:54:38,295 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-09 17:54:38,295 - src.device_platform_client - INFO - 设备平台客户端初始化: http://127.0.0.1:8081
2025-11-09 17:54:38,295 - __main__ - INFO - 初始化报警系统...
2025-11-09 17:54:38,295 - src.kafka_publisher - INFO - 初始化Kafka生产者: 127.0.0.1:9092, topic: event-alarm
2025-11-09 17:54:38,296 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: connecting to 127.0.0.1:9092 [('127.0.0.1', 9092) IPv4]
2025-11-09 17:54:38,297 - kafka.conn - INFO - Probing node bootstrap-0 broker version
2025-11-09 17:54:38,297 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]> returned error 61. Disconnecting.
2025-11-09 17:54:38,297 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: Closing connection. KafkaConnectionError: 61 ECONNREFUSED
2025-11-09 17:54:38,346 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: connecting to 127.0.0.1:9092 [('127.0.0.1', 9092) IPv4]
2025-11-09 17:54:38,347 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]> returned error 61. Disconnecting.
2025-11-09 17:54:38,347 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: Closing connection. KafkaConnectionError: 61 ECONNREFUSED
2025-11-09 17:54:38,347 - src.kafka_publisher - ERROR - Kafka生产者初始化失败: NoBrokersAvailable
2025-11-09 17:54:38,347 - src.alarm_system - INFO - Kafka推送器初始化成功
2025-11-09 17:54:38,347 - src.alarm_system - INFO - 告警通知方式: http
2025-11-09 17:54:38,349 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-09 17:54:38,349 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-09 17:54:38,349 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-09 17:54:38,349 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-09 17:54:38,350 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-09 17:54:38,351 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-09 17:54:38,351 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:54:38,352 - __main__ - INFO - 初始化API服务器...
2025-11-09 17:54:38,362 - src.api_server - INFO - API服务器初始化完成
2025-11-09 17:54:38,362 - __main__ - INFO - 系统组件初始化完成
2025-11-09 17:54:38,362 - __main__ - INFO - 启动实时视频检测系统...
2025-11-09 17:54:38,362 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-09 17:54:38,365 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-09 17:54:46,141 - __main__ - INFO - 接收到信号 2，正在关闭系统...
2025-11-09 17:54:46,142 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-09 17:54:46,142 - src.api_server - INFO - 正在停止API服务器...
2025-11-09 17:54:51,147 - src.api_server - INFO - API服务器已停止
2025-11-09 17:54:56,154 - src.scene_manager - INFO - 场景管理器已停止
2025-11-09 17:54:56,154 - __main__ - ERROR - 系统关闭时发生错误: 'HeartbeatManager' object has no attribute 'stop'
2025-11-09 17:54:58,503 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-09 17:54:58,503 - src.config_manager - INFO - 重新加载配置文件
2025-11-09 17:54:58,525 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-09 17:54:58,525 - __main__ - INFO - 正在初始化系统组件...
2025-11-09 17:54:58,525 - __main__ - INFO - 预加载AI模型...
2025-11-09 17:54:58,525 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-09 17:54:58,655 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:54:58,655 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-09 17:54:58,822 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: mps
2025-11-09 17:54:58,822 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-09 17:54:58,968 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:54:58,969 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:54:59,213 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: mps
2025-11-09 17:54:59,213 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-09 17:54:59,355 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:54:59,355 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-09 17:54:59,355 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-09 17:54:59,355 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-09 17:54:59,355 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-09 17:54:59,355 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-09 17:54:59,355 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:54:59,355 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-09 17:54:59,355 - __main__ - INFO - 初始化检测引擎...
2025-11-09 17:54:59,355 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:54:59,432 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-09 17:54:59,433 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8080
2025-11-09 17:54:59,434 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-09 17:54:59,434 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-09 17:54:59,435 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-09 17:54:59,435 - __main__ - INFO - 初始化流管理器...
2025-11-09 17:54:59,435 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-09 17:54:59,435 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:54:59,436 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-09 17:54:59,438 - src.stream_manager - INFO - 流监控线程启动
2025-11-09 17:54:59,439 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-09 17:54:59,439 - __main__ - INFO - 初始化场景管理组件...
2025-11-09 17:54:59,439 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-09 17:54:59,440 - src.device_platform_client - INFO - 设备平台客户端初始化: http://127.0.0.1:8081
2025-11-09 17:54:59,440 - __main__ - INFO - 初始化报警系统...
2025-11-09 17:54:59,440 - src.kafka_publisher - INFO - 初始化Kafka生产者: 127.0.0.1:9092, topic: event-alarm
2025-11-09 17:54:59,442 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: connecting to 127.0.0.1:9092 [('127.0.0.1', 9092) IPv4]
2025-11-09 17:54:59,442 - kafka.conn - INFO - Probing node bootstrap-0 broker version
2025-11-09 17:54:59,443 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]> returned error 61. Disconnecting.
2025-11-09 17:54:59,443 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: Closing connection. KafkaConnectionError: 61 ECONNREFUSED
2025-11-09 17:54:59,492 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: connecting to 127.0.0.1:9092 [('127.0.0.1', 9092) IPv4]
2025-11-09 17:54:59,492 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]> returned error 61. Disconnecting.
2025-11-09 17:54:59,492 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: Closing connection. KafkaConnectionError: 61 ECONNREFUSED
2025-11-09 17:54:59,492 - src.kafka_publisher - ERROR - Kafka生产者初始化失败: NoBrokersAvailable
2025-11-09 17:54:59,492 - src.alarm_system - INFO - Kafka推送器初始化成功
2025-11-09 17:54:59,492 - src.alarm_system - INFO - 告警通知方式: http
2025-11-09 17:54:59,494 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-09 17:54:59,494 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-09 17:54:59,495 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-09 17:54:59,495 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-09 17:54:59,495 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-09 17:54:59,495 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-09 17:54:59,496 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:54:59,496 - __main__ - INFO - 初始化API服务器...
2025-11-09 17:54:59,505 - src.api_server - INFO - API服务器初始化完成
2025-11-09 17:54:59,505 - __main__ - INFO - 系统组件初始化完成
2025-11-09 17:54:59,505 - __main__ - INFO - 启动实时视频检测系统...
2025-11-09 17:54:59,505 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-09 17:54:59,506 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-09 17:55:22,203 - __main__ - INFO - 接收到信号 2，正在关闭系统...
2025-11-09 17:55:22,203 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-09 17:55:22,203 - src.api_server - INFO - 正在停止API服务器...
2025-11-09 17:55:27,415 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-09 17:55:27,415 - src.config_manager - INFO - 重新加载配置文件
2025-11-09 17:55:27,435 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-09 17:55:27,436 - __main__ - INFO - 正在初始化系统组件...
2025-11-09 17:55:27,436 - __main__ - INFO - 预加载AI模型...
2025-11-09 17:55:27,436 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-09 17:55:27,563 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: mps
2025-11-09 17:55:27,563 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-09 17:55:27,724 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:55:27,725 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-09 17:55:27,834 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:55:27,834 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:55:28,043 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: mps
2025-11-09 17:55:28,044 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-09 17:55:28,161 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:55:28,161 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-09 17:55:28,161 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-09 17:55:28,161 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-09 17:55:28,161 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-09 17:55:28,161 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-09 17:55:28,161 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:55:28,161 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-09 17:55:28,161 - __main__ - INFO - 初始化检测引擎...
2025-11-09 17:55:28,161 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:55:28,236 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-09 17:55:28,237 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8080
2025-11-09 17:55:28,237 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-09 17:55:28,237 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-09 17:55:28,237 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-09 17:55:28,237 - __main__ - INFO - 初始化流管理器...
2025-11-09 17:55:28,238 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-09 17:55:28,238 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:55:28,238 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-09 17:55:28,239 - src.stream_manager - INFO - 流监控线程启动
2025-11-09 17:55:28,239 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-09 17:55:28,239 - __main__ - INFO - 初始化场景管理组件...
2025-11-09 17:55:28,239 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-09 17:55:28,239 - src.device_platform_client - INFO - 设备平台客户端初始化: http://127.0.0.1:8081
2025-11-09 17:55:28,239 - __main__ - INFO - 初始化报警系统...
2025-11-09 17:55:28,240 - src.kafka_publisher - INFO - 初始化Kafka生产者: 127.0.0.1:9092, topic: event-alarm
2025-11-09 17:55:28,241 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: connecting to 127.0.0.1:9092 [('127.0.0.1', 9092) IPv4]
2025-11-09 17:55:28,242 - kafka.conn - INFO - Probing node bootstrap-0 broker version
2025-11-09 17:55:28,243 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]> returned error 61. Disconnecting.
2025-11-09 17:55:28,243 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: Closing connection. KafkaConnectionError: 61 ECONNREFUSED
2025-11-09 17:55:28,291 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: connecting to 127.0.0.1:9092 [('127.0.0.1', 9092) IPv4]
2025-11-09 17:55:28,292 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]> returned error 61. Disconnecting.
2025-11-09 17:55:28,292 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: Closing connection. KafkaConnectionError: 61 ECONNREFUSED
2025-11-09 17:55:28,292 - src.kafka_publisher - ERROR - Kafka生产者初始化失败: NoBrokersAvailable
2025-11-09 17:55:28,292 - src.alarm_system - INFO - Kafka推送器初始化成功
2025-11-09 17:55:28,292 - src.alarm_system - INFO - 告警通知方式: http
2025-11-09 17:55:28,294 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-09 17:55:28,294 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-09 17:55:28,294 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-09 17:55:28,294 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-09 17:55:28,294 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-09 17:55:28,294 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-09 17:55:28,295 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:55:28,295 - __main__ - INFO - 初始化API服务器...
2025-11-09 17:55:28,304 - src.api_server - INFO - API服务器初始化完成
2025-11-09 17:55:28,304 - __main__ - INFO - 系统组件初始化完成
2025-11-09 17:55:28,305 - __main__ - INFO - 启动实时视频检测系统...
2025-11-09 17:55:28,305 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-09 17:55:28,307 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-09 17:55:30,680 - __main__ - INFO - 接收到信号 2，正在关闭系统...
2025-11-09 17:55:30,680 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-09 17:55:30,680 - src.api_server - INFO - 正在停止API服务器...
2025-11-09 17:55:35,688 - src.api_server - INFO - API服务器已停止
2025-11-09 17:55:40,695 - src.scene_manager - INFO - 场景管理器已停止
2025-11-09 17:55:40,696 - __main__ - ERROR - 系统关闭时发生错误: 'HeartbeatManager' object has no attribute 'stop'
2025-11-09 17:55:44,044 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-09 17:55:44,044 - src.config_manager - INFO - 重新加载配置文件
2025-11-09 17:55:44,065 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-09 17:55:44,065 - __main__ - INFO - 正在初始化系统组件...
2025-11-09 17:55:44,065 - __main__ - INFO - 预加载AI模型...
2025-11-09 17:55:44,065 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:55:44,244 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: mps
2025-11-09 17:55:44,244 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-09 17:55:44,354 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:55:44,354 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-09 17:55:44,505 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: mps
2025-11-09 17:55:44,506 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-09 17:55:44,659 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:55:44,660 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-09 17:55:44,783 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: mps
2025-11-09 17:55:44,783 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-09 17:55:44,783 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-09 17:55:44,783 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-09 17:55:44,783 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-09 17:55:44,783 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-09 17:55:44,783 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:55:44,783 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-09 17:55:44,783 - __main__ - INFO - 初始化检测引擎...
2025-11-09 17:55:44,783 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-09 17:55:44,861 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-09 17:55:44,861 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8080
2025-11-09 17:55:44,862 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-09 17:55:44,862 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-09 17:55:44,862 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-09 17:55:44,862 - __main__ - INFO - 初始化流管理器...
2025-11-09 17:55:44,862 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-09 17:55:44,862 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:55:44,862 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-09 17:55:44,863 - src.stream_manager - INFO - 流监控线程启动
2025-11-09 17:55:44,863 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-09 17:55:44,863 - __main__ - INFO - 初始化场景管理组件...
2025-11-09 17:55:44,864 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-09 17:55:44,864 - src.device_platform_client - INFO - 设备平台客户端初始化: http://127.0.0.1:8081
2025-11-09 17:55:44,864 - __main__ - INFO - 初始化报警系统...
2025-11-09 17:55:44,864 - src.kafka_publisher - INFO - 初始化Kafka生产者: 127.0.0.1:9092, topic: event-alarm
2025-11-09 17:55:44,866 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: connecting to 127.0.0.1:9092 [('127.0.0.1', 9092) IPv4]
2025-11-09 17:55:44,866 - kafka.conn - INFO - Probing node bootstrap-0 broker version
2025-11-09 17:55:44,867 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]> returned error 61. Disconnecting.
2025-11-09 17:55:44,867 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: Closing connection. KafkaConnectionError: 61 ECONNREFUSED
2025-11-09 17:55:44,916 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: connecting to 127.0.0.1:9092 [('127.0.0.1', 9092) IPv4]
2025-11-09 17:55:44,916 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]> returned error 61. Disconnecting.
2025-11-09 17:55:44,917 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: Closing connection. KafkaConnectionError: 61 ECONNREFUSED
2025-11-09 17:55:44,917 - src.kafka_publisher - ERROR - Kafka生产者初始化失败: NoBrokersAvailable
2025-11-09 17:55:44,917 - src.alarm_system - INFO - Kafka推送器初始化成功
2025-11-09 17:55:44,917 - src.alarm_system - INFO - 告警通知方式: http
2025-11-09 17:55:44,919 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-09 17:55:44,920 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-09 17:55:44,920 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-09 17:55:44,920 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-09 17:55:44,921 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-09 17:55:44,921 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-09 17:55:44,921 - src.detection_engine - INFO - 添加报警回调函数
2025-11-09 17:55:44,921 - __main__ - INFO - 初始化API服务器...
2025-11-09 17:55:44,930 - src.api_server - INFO - API服务器初始化完成
2025-11-09 17:55:44,930 - __main__ - INFO - 系统组件初始化完成
2025-11-09 17:55:44,930 - __main__ - INFO - 启动实时视频检测系统...
2025-11-09 17:55:44,931 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-09 17:55:44,932 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-09 17:55:50,140 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}, {"deviceGbCode": "31011500001320000002", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00);(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}], "scene": "安全帽检测", "algorithm": "安全帽检测", "endDate": "2026-11-09 16:12:00"}
2025-11-09 17:55:50,141 - src.scene_manager - INFO - 开始部署场景: 安全帽检测, 算法: 安全帽检测, 设备数: 2
2025-11-09 17:55:50,141 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-09 17:55:50,142 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-09 17:55:50,162 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://localhost:8554/stream1
2025-11-09 17:55:50,163 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:55:51,275 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-09 17:55:51,276 - src.detection_engine - INFO - 视频流检测启动成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:55:51,276 - src.stream_manager - INFO - 视频流启动成功: scene_安全帽检测_31011500001320000001
2025-11-09 17:55:51,277 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程启动
2025-11-09 17:55:51,278 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已启动
2025-11-09 17:55:51,278 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-09 17:55:51,278 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000002 (尝试 1/3)
2025-11-09 17:55:51,290 - src.device_platform_client - INFO - 成功获取设备 31011500001320000002 的流地址: rtsp://localhost:8554/stream2
2025-11-09 17:55:51,290 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:55:56,324 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 视频设置:
2025-11-09 17:55:56,325 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-09 17:55:56,325 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-09 17:55:56,325 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-09 17:55:56,325 - src.detection_engine - INFO - 开始处理视频流: scene_安全帽检测_31011500001320000001
2025-11-09 17:55:57,139 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-09 17:55:57,140 - src.detection_engine - INFO - 视频流检测启动成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:55:57,140 - src.stream_manager - INFO - 视频流启动成功: scene_安全帽检测_31011500001320000002
2025-11-09 17:55:57,140 - src.heartbeat_manager - INFO - 设备 31011500001320000002 心跳工作线程启动
2025-11-09 17:55:57,140 - src.heartbeat_manager - INFO - 设备 31011500001320000002 心跳线程已启动
2025-11-09 17:55:57,142 - src.scene_manager - INFO - 设备 31011500001320000002 部署成功
2025-11-09 17:55:57,142 - src.scene_manager - INFO - 场景部署完成: 成功2个, 失败0个
2025-11-09 17:55:57,142 - src.api_server - INFO - 场景下发成功: scene=安全帽检测, algorithm=安全帽检测
2025-11-09 17:55:57,927 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 视频设置:
2025-11-09 17:55:57,928 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-09 17:55:57,928 - src.detection_engine - INFO -   - 分辨率: 1920x1080
2025-11-09 17:55:57,928 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-09 17:55:57,928 - src.detection_engine - INFO - 开始处理视频流: scene_安全帽检测_31011500001320000002
2025-11-09 17:56:01,416 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_安全帽检测_31011500001320000001, image_url=http://localhost:8080/results/2025-11-09/scene_安全帽检测_31011500001320000001/17-56-01-346_frame_2/annotated.png
2025-11-09 17:56:01,416 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.96
2025-11-09 17:56:08,402 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 10 帧, 检测耗时: 0.022s
2025-11-09 17:56:08,501 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 10 帧, 检测耗时: 0.044s
2025-11-09 17:56:18,633 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 20 帧, 检测耗时: 0.040s, 实际帧间隔: 1.018s
2025-11-09 17:56:18,689 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 20 帧, 检测耗时: 0.033s, 实际帧间隔: 1.021s
2025-11-09 17:56:28,811 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 30 帧, 检测耗时: 0.026s, 实际帧间隔: 1.021s
2025-11-09 17:56:28,869 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 30 帧, 检测耗时: 0.029s, 实际帧间隔: 1.018s
2025-11-09 17:56:31,961 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_安全帽检测_31011500001320000001, image_url=http://localhost:8080/results/2025-11-09/scene_安全帽检测_31011500001320000001/17-56-31-887_frame_32/annotated.png
2025-11-09 17:56:31,961 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.96
2025-11-09 17:56:39,003 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 40 帧, 检测耗时: 0.023s, 实际帧间隔: 1.020s
2025-11-09 17:56:39,121 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 40 帧, 检测耗时: 0.026s, 实际帧间隔: 1.021s
2025-11-09 17:56:49,248 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 50 帧, 检测耗时: 0.027s, 实际帧间隔: 1.022s
2025-11-09 17:56:49,298 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 50 帧, 检测耗时: 0.032s, 实际帧间隔: 1.022s
2025-11-09 17:56:59,441 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 60 帧, 检测耗时: 0.024s, 实际帧间隔: 1.022s
2025-11-09 17:56:59,544 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 60 帧, 检测耗时: 0.041s, 实际帧间隔: 1.019s
2025-11-09 17:57:02,612 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_安全帽检测_31011500001320000001, image_url=http://localhost:8080/results/2025-11-09/scene_安全帽检测_31011500001320000001/17-57-02-536_frame_62/annotated.png
2025-11-09 17:57:02,612 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.96
2025-11-09 17:57:02,612 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_安全帽检测_31011500001320000001, 类别=head, 置信度=0.96
2025-11-09 17:57:02,613 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_安全帽检测_31011500001320000001 | 类别: head | 置信度: 0.96 | 级别: high | 连续帧数: 30
2025-11-09 17:57:02,620 - src.device_platform_client - INFO - 告警发送成功: 31011500001320000001, 类型: head
2025-11-09 17:57:02,620 - src.alarm_system - INFO - 告警HTTP回调成功: 31011500001320000001, 类型: head
2025-11-09 17:57:09,652 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 70 帧, 检测耗时: 0.020s, 实际帧间隔: 1.023s
2025-11-09 17:57:09,755 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 70 帧, 检测耗时: 0.022s, 实际帧间隔: 1.024s
2025-11-09 17:57:19,956 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000002 已处理 80 帧, 检测耗时: 0.081s, 实际帧间隔: 1.020s
2025-11-09 17:57:20,023 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 80 帧, 检测耗时: 0.061s, 实际帧间隔: 1.019s
2025-11-09 17:57:28,540 - __main__ - INFO - 接收到信号 2，正在关闭系统...
2025-11-09 17:57:28,540 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-09 17:57:28,540 - src.api_server - INFO - 正在停止API服务器...
2025-11-15 15:58:52,349 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-15 15:58:52,349 - src.config_manager - INFO - 重新加载配置文件
2025-11-15 15:58:52,356 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-15 15:58:52,356 - __main__ - INFO - 正在初始化系统组件...
2025-11-15 15:58:52,356 - __main__ - INFO - 预加载AI模型...
2025-11-15 15:58:52,357 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-15 15:58:52,400 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 15:58:52,400 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 15:58:52,617 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: cpu
2025-11-15 15:58:52,618 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-15 15:58:52,704 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 15:58:52,705 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-15 15:58:52,745 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 15:58:52,745 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-15 15:58:52,816 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: cpu
2025-11-15 15:58:52,816 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-15 15:58:52,816 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-15 15:58:52,816 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-15 15:58:52,817 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-15 15:58:52,817 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-15 15:58:52,817 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 15:58:52,817 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-15 15:58:52,817 - __main__ - INFO - 初始化检测引擎...
2025-11-15 15:58:52,817 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 15:58:53,008 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-15 15:58:53,008 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8080
2025-11-15 15:58:53,008 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-15 15:58:53,008 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-15 15:58:53,008 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-15 15:58:53,009 - __main__ - INFO - 初始化流管理器...
2025-11-15 15:58:53,009 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-15 15:58:53,009 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 15:58:53,009 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-15 15:58:53,009 - src.stream_manager - INFO - 流监控线程启动
2025-11-15 15:58:53,009 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-15 15:58:53,009 - __main__ - INFO - 初始化场景管理组件...
2025-11-15 15:58:53,010 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-15 15:58:53,010 - src.device_platform_client - INFO - 设备平台客户端初始化: http://127.0.0.1:8081
2025-11-15 15:58:53,010 - __main__ - INFO - 初始化报警系统...
2025-11-15 15:58:53,010 - src.kafka_publisher - INFO - 初始化Kafka生产者: 127.0.0.1:9092, topic: event-alarm
2025-11-15 15:58:53,011 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: connecting to 127.0.0.1:9092 [('127.0.0.1', 9092) IPv4]
2025-11-15 15:58:53,011 - kafka.conn - INFO - Probing node bootstrap-0 broker version
2025-11-15 15:58:53,011 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]> returned error 111. Disconnecting.
2025-11-15 15:58:53,011 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 15:58:53,061 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: connecting to 127.0.0.1:9092 [('127.0.0.1', 9092) IPv4]
2025-11-15 15:58:53,061 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]> returned error 111. Disconnecting.
2025-11-15 15:58:53,061 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=127.0.0.1:9092 <connecting> [IPv4 ('127.0.0.1', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 15:58:53,062 - src.kafka_publisher - ERROR - Kafka生产者初始化失败: NoBrokersAvailable
2025-11-15 15:58:53,062 - src.alarm_system - INFO - Kafka推送器初始化成功
2025-11-15 15:58:53,062 - src.alarm_system - INFO - 告警通知方式: http, 格式版本: v2
2025-11-15 15:58:53,063 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-15 15:58:53,063 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-15 15:58:53,063 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-15 15:58:53,063 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-15 15:58:53,064 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-15 15:58:53,064 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-15 15:58:53,064 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 15:58:53,064 - __main__ - INFO - 初始化API服务器...
2025-11-15 15:58:53,068 - src.api_server - INFO - API服务器初始化完成
2025-11-15 15:58:53,069 - __main__ - INFO - 系统组件初始化完成
2025-11-15 15:58:53,069 - __main__ - INFO - 启动实时视频检测系统...
2025-11-15 15:58:53,069 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-15 15:58:53,069 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-15 16:00:33,028 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}, {"deviceGbCode": "31011500001320000002", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00);(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}], "scene": "安全帽检测", "algorithm": "安全帽检测", "endDate": "2026-11-09 16:12:00"}
2025-11-15 16:00:33,029 - src.scene_manager - INFO - 开始部署场景: 安全帽检测, 算法: 安全帽检测, 设备数: 2, 时间类型: 1
2025-11-15 16:00:33,029 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-15 16:00:33,030 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 16:00:33,038 - src.device_platform_client - ERROR - 获取播放地址请求失败: HTTPConnectionPool(host='127.0.0.1', port=8081): Max retries exceeded with url: /device/getPlayUrl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff6bcc6d40>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-11-15 16:00:34,040 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 2/3)
2025-11-15 16:00:34,044 - src.device_platform_client - ERROR - 获取播放地址请求失败: HTTPConnectionPool(host='127.0.0.1', port=8081): Max retries exceeded with url: /device/getPlayUrl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff6c020220>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-11-15 16:00:35,053 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 3/3)
2025-11-15 16:00:35,058 - src.device_platform_client - ERROR - 获取播放地址请求失败: HTTPConnectionPool(host='127.0.0.1', port=8081): Max retries exceeded with url: /device/getPlayUrl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff6c022c80>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-11-15 16:00:35,058 - src.device_platform_client - ERROR - 获取设备 31011500001320000001 播放地址失败，已重试3次
2025-11-15 16:00:35,058 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000002 (尝试 1/3)
2025-11-15 16:00:35,059 - src.device_platform_client - ERROR - 获取播放地址请求失败: HTTPConnectionPool(host='127.0.0.1', port=8081): Max retries exceeded with url: /device/getPlayUrl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff6bcc6b90>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-11-15 16:00:36,066 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000002 (尝试 2/3)
2025-11-15 16:00:36,070 - src.device_platform_client - ERROR - 获取播放地址请求失败: HTTPConnectionPool(host='127.0.0.1', port=8081): Max retries exceeded with url: /device/getPlayUrl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff6c020f70>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-11-15 16:00:37,075 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000002 (尝试 3/3)
2025-11-15 16:00:37,078 - src.device_platform_client - ERROR - 获取播放地址请求失败: HTTPConnectionPool(host='127.0.0.1', port=8081): Max retries exceeded with url: /device/getPlayUrl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff6bd28640>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-11-15 16:00:37,079 - src.device_platform_client - ERROR - 获取设备 31011500001320000002 播放地址失败，已重试3次
2025-11-15 16:00:37,080 - src.scene_manager - INFO - 场景部署完成: 成功0个, 失败2个
2025-11-15 16:00:37,080 - src.api_server - WARNING - 场景下发失败: 场景部署失败
2025-11-15 16:08:13,038 - __main__ - INFO - 接收到信号 15，正在关闭系统...
2025-11-15 16:08:13,042 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-15 16:08:13,042 - src.api_server - INFO - 正在停止API服务器...
2025-11-15 16:08:15,927 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-15 16:08:15,927 - src.config_manager - INFO - 重新加载配置文件
2025-11-15 16:08:15,935 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-15 16:08:15,936 - __main__ - INFO - 正在初始化系统组件...
2025-11-15 16:08:15,936 - __main__ - INFO - 预加载AI模型...
2025-11-15 16:08:15,936 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-15 16:08:16,080 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:08:16,081 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-15 16:08:16,140 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:08:16,141 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-15 16:08:16,190 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:08:16,190 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-15 16:08:16,284 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: cpu
2025-11-15 16:08:16,285 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:08:16,615 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: cpu
2025-11-15 16:08:16,615 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-15 16:08:16,616 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-15 16:08:16,616 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-15 16:08:16,616 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-15 16:08:16,617 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-15 16:08:16,617 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:08:16,617 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-15 16:08:16,618 - __main__ - INFO - 初始化检测引擎...
2025-11-15 16:08:16,618 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:08:16,835 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-15 16:08:16,836 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8081
2025-11-15 16:08:16,836 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-15 16:08:16,836 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-15 16:08:16,837 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-15 16:08:16,837 - __main__ - INFO - 初始化流管理器...
2025-11-15 16:08:16,837 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-15 16:08:16,837 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 16:08:16,837 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-15 16:08:16,838 - src.stream_manager - INFO - 流监控线程启动
2025-11-15 16:08:16,838 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-15 16:08:16,838 - __main__ - INFO - 初始化场景管理组件...
2025-11-15 16:08:16,838 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-15 16:08:16,838 - src.device_platform_client - INFO - 设备平台客户端初始化: http://host.docker.internal:8081
2025-11-15 16:08:16,839 - __main__ - INFO - 初始化报警系统...
2025-11-15 16:08:16,839 - src.kafka_publisher - INFO - 初始化Kafka生产者: host.docker.internal:9092, topic: event-alarm
2025-11-15 16:08:16,843 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 16:08:16,844 - kafka.conn - INFO - Probing node bootstrap-0 broker version
2025-11-15 16:08:16,849 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 16:08:16,849 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 16:08:16,890 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 16:08:16,892 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 16:08:16,892 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 16:08:16,893 - src.kafka_publisher - ERROR - Kafka生产者初始化失败: NoBrokersAvailable
2025-11-15 16:08:16,893 - src.alarm_system - INFO - Kafka推送器初始化成功
2025-11-15 16:08:16,893 - src.alarm_system - INFO - 告警通知方式: http, 格式版本: v2
2025-11-15 16:08:16,894 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-15 16:08:16,894 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-15 16:08:16,894 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-15 16:08:16,895 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-15 16:08:16,895 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-15 16:08:16,895 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-15 16:08:16,895 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 16:08:16,895 - __main__ - INFO - 初始化API服务器...
2025-11-15 16:08:16,900 - src.api_server - INFO - API服务器初始化完成
2025-11-15 16:08:16,900 - __main__ - INFO - 系统组件初始化完成
2025-11-15 16:08:16,900 - __main__ - INFO - 启动实时视频检测系统...
2025-11-15 16:08:16,900 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-15 16:08:16,902 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-15 16:08:48,352 - __main__ - INFO - 接收到信号 15，正在关闭系统...
2025-11-15 16:08:48,357 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-15 16:08:48,358 - src.api_server - INFO - 正在停止API服务器...
2025-11-15 16:08:52,767 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-15 16:08:52,768 - src.config_manager - INFO - 重新加载配置文件
2025-11-15 16:08:52,774 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-15 16:08:52,774 - __main__ - INFO - 正在初始化系统组件...
2025-11-15 16:08:52,774 - __main__ - INFO - 预加载AI模型...
2025-11-15 16:08:52,775 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-15 16:08:52,824 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:08:52,825 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-15 16:08:52,895 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:08:52,895 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:08:53,068 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: cpu
2025-11-15 16:08:53,069 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-15 16:08:53,131 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: cpu
2025-11-15 16:08:53,133 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-15 16:08:53,171 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:08:53,171 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-15 16:08:53,171 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-15 16:08:53,171 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-15 16:08:53,172 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-15 16:08:53,172 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-15 16:08:53,172 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:08:53,172 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-15 16:08:53,172 - __main__ - INFO - 初始化检测引擎...
2025-11-15 16:08:53,172 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:08:53,360 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-15 16:08:53,360 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8081
2025-11-15 16:08:53,360 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-15 16:08:53,361 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-15 16:08:53,362 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-15 16:08:53,362 - __main__ - INFO - 初始化流管理器...
2025-11-15 16:08:53,362 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-15 16:08:53,362 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 16:08:53,362 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-15 16:08:53,363 - src.stream_manager - INFO - 流监控线程启动
2025-11-15 16:08:53,363 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-15 16:08:53,363 - __main__ - INFO - 初始化场景管理组件...
2025-11-15 16:08:53,363 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-15 16:08:53,363 - src.device_platform_client - INFO - 设备平台客户端初始化: http://host.docker.internal:8081
2025-11-15 16:08:53,364 - __main__ - INFO - 初始化报警系统...
2025-11-15 16:08:53,364 - src.kafka_publisher - INFO - 初始化Kafka生产者: host.docker.internal:9092, topic: event-alarm
2025-11-15 16:08:53,367 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 16:08:53,367 - kafka.conn - INFO - Probing node bootstrap-0 broker version
2025-11-15 16:08:53,370 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 16:08:53,370 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 16:08:53,415 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 16:08:53,416 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 16:08:53,416 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 16:08:53,416 - src.kafka_publisher - ERROR - Kafka生产者初始化失败: NoBrokersAvailable
2025-11-15 16:08:53,416 - src.alarm_system - INFO - Kafka推送器初始化成功
2025-11-15 16:08:53,417 - src.alarm_system - INFO - 告警通知方式: http, 格式版本: v2
2025-11-15 16:08:53,417 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-15 16:08:53,418 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-15 16:08:53,418 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-15 16:08:53,418 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-15 16:08:53,418 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-15 16:08:53,418 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-15 16:08:53,418 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 16:08:53,419 - __main__ - INFO - 初始化API服务器...
2025-11-15 16:08:53,424 - src.api_server - INFO - API服务器初始化完成
2025-11-15 16:08:53,424 - __main__ - INFO - 系统组件初始化完成
2025-11-15 16:08:53,424 - __main__ - INFO - 启动实时视频检测系统...
2025-11-15 16:08:53,424 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-15 16:08:53,425 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-15 16:09:02,490 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}, {"deviceGbCode": "31011500001320000002", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00);(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}], "scene": "安全帽检测", "algorithm": "安全帽检测", "endDate": "2026-11-09 16:12:00"}
2025-11-15 16:09:02,491 - src.scene_manager - INFO - 开始部署场景: 安全帽检测, 算法: 安全帽检测, 设备数: 2, 时间类型: 1
2025-11-15 16:09:02,491 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-15 16:09:02,492 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 16:09:02,528 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://localhost:8554/stream1
2025-11-15 16:09:02,529 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000001
2025-11-15 16:09:02,537 - src.detection_engine - ERROR - 无法打开视频源: rtsp://localhost:8554/stream1
2025-11-15 16:09:02,537 - src.detection_engine - WARNING - 视频流不存在: scene_安全帽检测_31011500001320000001
2025-11-15 16:09:02,538 - src.stream_manager - INFO - 视频流注销成功: scene_安全帽检测_31011500001320000001
2025-11-15 16:09:02,538 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000002 (尝试 1/3)
2025-11-15 16:09:02,547 - src.device_platform_client - INFO - 成功获取设备 31011500001320000002 的流地址: rtsp://localhost:8554/stream2
2025-11-15 16:09:02,547 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000002
2025-11-15 16:09:02,547 - src.detection_engine - ERROR - 无法打开视频源: rtsp://localhost:8554/stream2
2025-11-15 16:09:02,547 - src.detection_engine - WARNING - 视频流不存在: scene_安全帽检测_31011500001320000002
2025-11-15 16:09:02,548 - src.stream_manager - INFO - 视频流注销成功: scene_安全帽检测_31011500001320000002
2025-11-15 16:09:02,548 - src.scene_manager - INFO - 场景部署完成: 成功0个, 失败2个
2025-11-15 16:09:02,548 - src.api_server - WARNING - 场景下发失败: 场景部署失败
2025-11-15 16:10:36,444 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}, {"deviceGbCode": "31011500001320000002", "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00);(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"}], "scene": "安全帽检测", "algorithm": "安全帽检测", "endDate": "2026-11-09 16:12:00"}
2025-11-15 16:10:36,446 - src.scene_manager - INFO - 开始部署场景: 安全帽检测, 算法: 安全帽检测, 设备数: 2, 时间类型: 1
2025-11-15 16:10:36,446 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-15 16:10:36,447 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 16:10:36,480 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://host.docker.internal:8554/stream1
2025-11-15 16:10:36,481 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000001
2025-11-15 16:10:41,656 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-15 16:10:41,656 - src.detection_engine - INFO - 视频流检测启动成功: scene_安全帽检测_31011500001320000001
2025-11-15 16:10:41,657 - src.stream_manager - INFO - 视频流启动成功: scene_安全帽检测_31011500001320000001
2025-11-15 16:10:41,658 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程启动
2025-11-15 16:10:41,658 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已启动
2025-11-15 16:10:41,660 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-15 16:10:41,660 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000002 (尝试 1/3)
2025-11-15 16:10:41,667 - src.device_platform_client - INFO - 成功获取设备 31011500001320000002 的流地址: rtsp://host.docker.internal:8554/stream2
2025-11-15 16:10:41,667 - src.stream_manager - INFO - 视频流注册成功: scene_安全帽检测_31011500001320000002
2025-11-15 16:10:42,813 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 视频设置:
2025-11-15 16:10:42,814 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-15 16:10:42,814 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-15 16:10:42,815 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-15 16:10:42,815 - src.detection_engine - INFO - 开始处理视频流: scene_安全帽检测_31011500001320000001
2025-11-15 16:10:42,821 - src.detection_engine - ERROR - 无法打开视频源: rtsp://host.docker.internal:8554/stream2
2025-11-15 16:10:42,821 - src.detection_engine - WARNING - 视频流不存在: scene_安全帽检测_31011500001320000002
2025-11-15 16:10:42,822 - src.stream_manager - INFO - 视频流注销成功: scene_安全帽检测_31011500001320000002
2025-11-15 16:10:42,823 - src.scene_manager - INFO - 场景部署完成: 成功1个, 失败1个
2025-11-15 16:10:42,824 - src.api_server - INFO - 场景下发成功: scene=安全帽检测, algorithm=安全帽检测
2025-11-15 16:10:45,255 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_安全帽检测_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_安全帽检测_31011500001320000001/16-10-45-132_frame_2/annotated.png
2025-11-15 16:10:45,255 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.72
2025-11-15 16:10:52,495 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 10 帧, 检测耗时: 0.462s
2025-11-15 16:11:02,458 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 20 帧, 检测耗时: 0.231s, 实际帧间隔: 1.023s
2025-11-15 16:11:12,658 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 30 帧, 检测耗时: 0.244s, 实际帧间隔: 1.016s
2025-11-15 16:11:17,931 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_安全帽检测_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_安全帽检测_31011500001320000001/16-11-17-815_frame_34/annotated.png
2025-11-15 16:11:17,931 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=medium, 目标=head, 置信度=0.64
2025-11-15 16:11:22,922 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 40 帧, 检测耗时: 0.219s, 实际帧间隔: 1.030s
2025-11-15 16:11:33,224 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 50 帧, 检测耗时: 0.222s, 实际帧间隔: 1.021s
2025-11-15 16:11:43,393 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 60 帧, 检测耗时: 0.265s, 实际帧间隔: 1.019s
2025-11-15 16:11:48,657 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_安全帽检测_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_安全帽检测_31011500001320000001/16-11-48-480_frame_64/annotated.png
2025-11-15 16:11:48,659 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=medium, 目标=head, 置信度=0.68
2025-11-15 16:11:48,659 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_安全帽检测_31011500001320000001, 类别=head, 置信度=0.68
2025-11-15 16:11:48,660 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_安全帽检测_31011500001320000001 | 类别: head | 置信度: 0.68 | 级别: medium | 连续帧数: 3
2025-11-15 16:11:48,662 - src.alarm_system - ERROR - 转换告警数据格式失败: 'list' object has no attribute 'items'
2025-11-15 16:11:48,663 - src.alarm_system - ERROR - 转换到v2格式失败
2025-11-15 16:11:48,663 - src.alarm_system - INFO - 告警HTTP回调失败: 31011500001320000001, 类型: head
2025-11-15 16:11:53,605 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 70 帧, 检测耗时: 0.238s, 实际帧间隔: 1.015s
2025-11-15 16:12:03,810 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 80 帧, 检测耗时: 0.221s, 实际帧间隔: 1.023s
2025-11-15 16:12:14,109 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 90 帧, 检测耗时: 0.284s, 实际帧间隔: 1.014s
2025-11-15 16:12:24,271 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 100 帧, 检测耗时: 0.223s, 实际帧间隔: 1.044s
2025-11-15 16:12:34,521 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 110 帧, 检测耗时: 0.214s, 实际帧间隔: 1.022s
2025-11-15 16:12:44,765 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 120 帧, 检测耗时: 0.227s, 实际帧间隔: 1.027s
2025-11-15 16:12:55,012 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 130 帧, 检测耗时: 0.229s, 实际帧间隔: 1.021s
2025-11-15 16:13:05,339 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 140 帧, 检测耗时: 0.359s, 实际帧间隔: 1.021s
2025-11-15 16:13:15,331 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 150 帧, 检测耗时: 0.228s, 实际帧间隔: 1.016s
2025-11-15 16:13:25,519 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 160 帧, 检测耗时: 0.222s, 实际帧间隔: 1.016s
2025-11-15 16:13:35,719 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 170 帧, 检测耗时: 0.226s, 实际帧间隔: 1.022s
2025-11-15 16:13:45,992 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 180 帧, 检测耗时: 0.229s, 实际帧间隔: 1.028s
2025-11-15 16:13:56,134 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 190 帧, 检测耗时: 0.222s, 实际帧间隔: 1.016s
2025-11-15 16:14:02,407 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_安全帽检测_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_安全帽检测_31011500001320000001/16-14-02-283_frame_195/annotated.png
2025-11-15 16:14:02,407 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=medium, 目标=head, 置信度=0.58
2025-11-15 16:14:06,394 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 200 帧, 检测耗时: 0.222s, 实际帧间隔: 1.023s
2025-11-15 16:14:16,880 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 210 帧, 检测耗时: 0.311s, 实际帧间隔: 1.029s
2025-11-15 16:14:26,992 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 220 帧, 检测耗时: 0.225s, 实际帧间隔: 1.017s
2025-11-15 16:14:32,970 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_安全帽检测_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_安全帽检测_31011500001320000001/16-14-32-304_frame_224/annotated.png
2025-11-15 16:14:32,971 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=high, 目标=head, 置信度=0.88
2025-11-15 16:14:37,370 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 230 帧, 检测耗时: 0.257s, 实际帧间隔: 1.051s
2025-11-15 16:14:47,814 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 240 帧, 检测耗时: 0.259s, 实际帧间隔: 1.020s
2025-11-15 16:14:57,761 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 250 帧, 检测耗时: 0.330s, 实际帧间隔: 1.011s
2025-11-15 16:15:08,028 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_安全帽检测_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_安全帽检测_31011500001320000001/16-15-07-881_frame_259/annotated.png
2025-11-15 16:15:08,029 - src.stream_manager - WARNING - 报警事件: 流ID=scene_安全帽检测_31011500001320000001, 类型=medium, 目标=head, 置信度=0.69
2025-11-15 16:15:08,029 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_安全帽检测_31011500001320000001, 类别=head, 置信度=0.69
2025-11-15 16:15:08,030 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 260 帧, 检测耗时: 0.226s, 实际帧间隔: 1.022s
2025-11-15 16:15:08,030 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_安全帽检测_31011500001320000001 | 类别: head | 置信度: 0.69 | 级别: medium | 连续帧数: 3
2025-11-15 16:15:08,030 - src.alarm_system - ERROR - 转换告警数据格式失败: 'list' object has no attribute 'items'
2025-11-15 16:15:08,039 - src.alarm_system - ERROR - 转换到v2格式失败
2025-11-15 16:15:08,040 - src.alarm_system - INFO - 告警HTTP回调失败: 31011500001320000001, 类型: head
2025-11-15 16:15:18,764 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 270 帧, 检测耗时: 0.352s, 实际帧间隔: 1.058s
2025-11-15 16:15:28,902 - src.detection_engine - INFO - 流 scene_安全帽检测_31011500001320000001 已处理 280 帧, 检测耗时: 0.275s, 实际帧间隔: 1.021s
2025-11-15 16:15:31,228 - __main__ - INFO - 接收到信号 15，正在关闭系统...
2025-11-15 16:15:31,243 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-15 16:15:31,244 - src.api_server - INFO - 正在停止API服务器...
2025-11-15 16:15:35,253 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-15 16:15:35,254 - src.config_manager - INFO - 重新加载配置文件
2025-11-15 16:15:35,264 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-15 16:15:35,265 - __main__ - INFO - 正在初始化系统组件...
2025-11-15 16:15:35,265 - __main__ - INFO - 预加载AI模型...
2025-11-15 16:15:35,266 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-15 16:15:35,321 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:15:35,321 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:15:35,586 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: cpu
2025-11-15 16:15:35,587 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-15 16:15:35,641 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:15:35,642 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-15 16:15:35,741 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:15:35,743 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-15 16:15:35,858 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: cpu
2025-11-15 16:15:35,859 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-15 16:15:35,860 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-15 16:15:35,860 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-15 16:15:35,862 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-15 16:15:35,863 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-15 16:15:35,864 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:15:35,864 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-15 16:15:35,865 - __main__ - INFO - 初始化检测引擎...
2025-11-15 16:15:35,867 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:15:36,189 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-15 16:15:36,190 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8081
2025-11-15 16:15:36,191 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-15 16:15:36,191 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-15 16:15:36,193 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-15 16:15:36,193 - __main__ - INFO - 初始化流管理器...
2025-11-15 16:15:36,193 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-15 16:15:36,193 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 16:15:36,194 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-15 16:15:36,195 - src.stream_manager - INFO - 流监控线程启动
2025-11-15 16:15:36,196 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-15 16:15:36,196 - __main__ - INFO - 初始化场景管理组件...
2025-11-15 16:15:36,197 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-15 16:15:36,197 - src.device_platform_client - INFO - 设备平台客户端初始化: http://host.docker.internal:8081
2025-11-15 16:15:36,198 - __main__ - INFO - 初始化报警系统...
2025-11-15 16:15:36,199 - src.kafka_publisher - INFO - 初始化Kafka生产者: host.docker.internal:9092, topic: event-alarm
2025-11-15 16:15:36,207 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 16:15:36,207 - kafka.conn - INFO - Probing node bootstrap-0 broker version
2025-11-15 16:15:36,212 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 16:15:36,212 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 16:15:36,251 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 16:15:36,253 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 16:15:36,254 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 16:15:36,255 - src.kafka_publisher - ERROR - Kafka生产者初始化失败: NoBrokersAvailable
2025-11-15 16:15:36,256 - src.alarm_system - INFO - Kafka推送器初始化成功
2025-11-15 16:15:36,257 - src.alarm_system - INFO - 告警通知方式: http, 格式版本: v2
2025-11-15 16:15:36,260 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-15 16:15:36,260 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-15 16:15:36,260 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-15 16:15:36,261 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-15 16:15:36,263 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-15 16:15:36,264 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-15 16:15:36,264 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 16:15:36,266 - __main__ - INFO - 初始化API服务器...
2025-11-15 16:15:36,276 - src.api_server - INFO - API服务器初始化完成
2025-11-15 16:15:36,276 - __main__ - INFO - 系统组件初始化完成
2025-11-15 16:15:36,276 - __main__ - INFO - 启动实时视频检测系统...
2025-11-15 16:15:36,276 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-15 16:15:36,279 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-15 16:18:17,336 - __main__ - INFO - 接收到信号 15，正在关闭系统...
2025-11-15 16:18:17,338 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-15 16:18:17,338 - src.api_server - INFO - 正在停止API服务器...
2025-11-15 16:34:33,644 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-15 16:34:33,644 - src.config_manager - INFO - 重新加载配置文件
2025-11-15 16:34:33,650 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-15 16:34:33,650 - __main__ - INFO - 正在初始化系统组件...
2025-11-15 16:34:33,651 - __main__ - INFO - 预加载AI模型...
2025-11-15 16:34:33,651 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-15 16:34:33,701 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:34:33,702 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-15 16:34:33,743 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:34:33,744 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-15 16:34:33,808 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: cpu
2025-11-15 16:34:33,808 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:34:33,984 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: cpu
2025-11-15 16:34:33,985 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-15 16:34:34,047 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:34:34,047 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-15 16:34:34,048 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-15 16:34:34,048 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-15 16:34:34,048 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-15 16:34:34,048 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-15 16:34:34,048 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:34:34,048 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-15 16:34:34,048 - __main__ - INFO - 初始化检测引擎...
2025-11-15 16:34:34,048 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:34:34,228 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-15 16:34:34,228 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8081
2025-11-15 16:34:34,228 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-15 16:34:34,228 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-15 16:34:34,229 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-15 16:34:34,229 - __main__ - INFO - 初始化流管理器...
2025-11-15 16:34:34,229 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-15 16:34:34,229 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 16:34:34,229 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-15 16:34:34,230 - src.stream_manager - INFO - 流监控线程启动
2025-11-15 16:34:34,230 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-15 16:34:34,230 - __main__ - INFO - 初始化场景管理组件...
2025-11-15 16:34:34,230 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-15 16:34:34,230 - src.device_platform_client - INFO - 设备平台客户端初始化: http://host.docker.internal:8081
2025-11-15 16:34:34,230 - __main__ - INFO - 初始化报警系统...
2025-11-15 16:34:34,230 - src.kafka_publisher - INFO - 初始化Kafka生产者: host.docker.internal:9092, topic: event-alarm
2025-11-15 16:34:34,232 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 16:34:34,233 - kafka.conn - INFO - Probing node bootstrap-0 broker version
2025-11-15 16:34:34,234 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 16:34:34,234 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 16:34:34,281 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 16:34:34,282 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 16:34:34,282 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 16:34:34,282 - src.kafka_publisher - ERROR - Kafka生产者初始化失败: NoBrokersAvailable
2025-11-15 16:34:34,282 - src.alarm_system - INFO - Kafka推送器初始化成功
2025-11-15 16:34:34,282 - src.alarm_system - INFO - 告警通知方式: http, 格式版本: v2
2025-11-15 16:34:34,283 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-15 16:34:34,283 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-15 16:34:34,283 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-15 16:34:34,283 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-15 16:34:34,283 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-15 16:34:34,283 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-15 16:34:34,284 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 16:34:34,284 - __main__ - INFO - 初始化API服务器...
2025-11-15 16:34:34,288 - src.api_server - INFO - API服务器初始化完成
2025-11-15 16:34:34,288 - __main__ - INFO - 系统组件初始化完成
2025-11-15 16:34:34,288 - __main__ - INFO - 启动实时视频检测系统...
2025-11-15 16:34:34,288 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-15 16:34:34,289 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-15 16:39:58,879 - __main__ - INFO - 接收到信号 15，正在关闭系统...
2025-11-15 16:39:58,882 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-15 16:39:58,882 - src.api_server - INFO - 正在停止API服务器...
2025-11-15 16:40:01,432 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-15 16:40:01,432 - src.config_manager - INFO - 重新加载配置文件
2025-11-15 16:40:01,440 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-15 16:40:01,440 - __main__ - INFO - 正在初始化系统组件...
2025-11-15 16:40:01,441 - __main__ - INFO - 预加载AI模型...
2025-11-15 16:40:01,442 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-15 16:40:01,508 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:40:01,509 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-15 16:40:01,597 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: cpu
2025-11-15 16:40:01,598 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-15 16:40:01,643 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:40:01,644 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-15 16:40:01,727 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:40:01,727 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:40:01,953 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: cpu
2025-11-15 16:40:01,954 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-15 16:40:01,954 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-15 16:40:01,955 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-15 16:40:01,955 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-15 16:40:01,955 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-15 16:40:01,955 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:40:01,955 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-15 16:40:01,955 - __main__ - INFO - 初始化检测引擎...
2025-11-15 16:40:01,956 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:40:02,192 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-15 16:40:02,192 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8081
2025-11-15 16:40:02,192 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-15 16:40:02,193 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-15 16:40:02,193 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-15 16:40:02,193 - __main__ - INFO - 初始化流管理器...
2025-11-15 16:40:02,193 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-15 16:40:02,193 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 16:40:02,193 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-15 16:40:02,194 - src.stream_manager - INFO - 流监控线程启动
2025-11-15 16:40:02,194 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-15 16:40:02,194 - __main__ - INFO - 初始化场景管理组件...
2025-11-15 16:40:02,194 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-15 16:40:02,194 - src.device_platform_client - INFO - 设备平台客户端初始化: http://host.docker.internal:8081
2025-11-15 16:40:02,194 - __main__ - INFO - 初始化报警系统...
2025-11-15 16:40:02,194 - src.kafka_publisher - INFO - 初始化Kafka生产者: host.docker.internal:9092, topic: event-alarm
2025-11-15 16:40:02,197 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 16:40:02,198 - kafka.conn - INFO - Probing node bootstrap-0 broker version
2025-11-15 16:40:02,200 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 16:40:02,200 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 16:40:02,245 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 16:40:02,246 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 16:40:02,246 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 16:40:02,246 - src.kafka_publisher - ERROR - Kafka生产者初始化失败: NoBrokersAvailable
2025-11-15 16:40:02,247 - src.alarm_system - INFO - Kafka推送器初始化成功
2025-11-15 16:40:02,247 - src.alarm_system - INFO - 告警通知方式: http, 格式版本: v2
2025-11-15 16:40:02,248 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-15 16:40:02,248 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-15 16:40:02,248 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-15 16:40:02,248 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-15 16:40:02,248 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-15 16:40:02,249 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-15 16:40:02,249 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 16:40:02,249 - __main__ - INFO - 初始化API服务器...
2025-11-15 16:40:02,251 - src.api_server - INFO - API服务器初始化完成
2025-11-15 16:40:02,251 - __main__ - INFO - 系统组件初始化完成
2025-11-15 16:40:02,251 - __main__ - INFO - 启动实时视频检测系统...
2025-11-15 16:40:02,251 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-15 16:40:02,252 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-15 16:45:08,638 - __main__ - INFO - 接收到信号 15，正在关闭系统...
2025-11-15 16:45:08,641 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-15 16:45:08,642 - src.api_server - INFO - 正在停止API服务器...
2025-11-15 16:45:11,249 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-15 16:45:11,249 - src.config_manager - INFO - 重新加载配置文件
2025-11-15 16:45:11,256 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-15 16:45:11,256 - __main__ - INFO - 正在初始化系统组件...
2025-11-15 16:45:11,256 - __main__ - INFO - 预加载AI模型...
2025-11-15 16:45:11,256 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:45:11,446 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: cpu
2025-11-15 16:45:11,447 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-15 16:45:11,525 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: cpu
2025-11-15 16:45:11,527 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-15 16:45:11,565 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:45:11,566 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-15 16:45:11,602 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:45:11,603 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-15 16:45:11,679 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:45:11,680 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-15 16:45:11,680 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-15 16:45:11,680 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-15 16:45:11,680 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-15 16:45:11,680 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-15 16:45:11,680 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:45:11,680 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-15 16:45:11,680 - __main__ - INFO - 初始化检测引擎...
2025-11-15 16:45:11,681 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:45:11,854 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-15 16:45:11,855 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8081
2025-11-15 16:45:11,855 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-15 16:45:11,855 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-15 16:45:11,855 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-15 16:45:11,855 - __main__ - INFO - 初始化流管理器...
2025-11-15 16:45:11,855 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-15 16:45:11,855 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 16:45:11,855 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-15 16:45:11,856 - src.stream_manager - INFO - 流监控线程启动
2025-11-15 16:45:11,856 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-15 16:45:11,856 - __main__ - INFO - 初始化场景管理组件...
2025-11-15 16:45:11,856 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-15 16:45:11,856 - src.device_platform_client - INFO - 设备平台客户端初始化: http://host.docker.internal:8081
2025-11-15 16:45:11,856 - __main__ - INFO - 初始化报警系统...
2025-11-15 16:45:11,856 - src.kafka_publisher - INFO - 初始化Kafka生产者: host.docker.internal:9092, topic: event-alarm
2025-11-15 16:45:11,859 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 16:45:11,860 - kafka.conn - INFO - Probing node bootstrap-0 broker version
2025-11-15 16:45:11,862 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 16:45:11,862 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 16:45:11,907 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 16:45:11,908 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 16:45:11,908 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 16:45:11,908 - src.kafka_publisher - ERROR - Kafka生产者初始化失败: NoBrokersAvailable
2025-11-15 16:45:11,908 - src.alarm_system - INFO - Kafka推送器初始化成功
2025-11-15 16:45:11,908 - src.alarm_system - INFO - 告警通知方式: http, 格式版本: v2
2025-11-15 16:45:11,909 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-15 16:45:11,909 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-15 16:45:11,909 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-15 16:45:11,910 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-15 16:45:11,910 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-15 16:45:11,910 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-15 16:45:11,910 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 16:45:11,910 - __main__ - INFO - 初始化API服务器...
2025-11-15 16:45:11,912 - src.api_server - INFO - API服务器初始化完成
2025-11-15 16:45:11,912 - __main__ - INFO - 系统组件初始化完成
2025-11-15 16:45:11,912 - __main__ - INFO - 启动实时视频检测系统...
2025-11-15 16:45:11,912 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-15 16:45:11,912 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-15 16:47:23,547 - src.api_server - ERROR - 场景下发异常: 415 Unsupported Media Type: Did not attempt to load JSON data because the request Content-Type was not 'application/json'.
Traceback (most recent call last):
  File "/app/src/api_server.py", line 125, in scene_issue
    data = request.get_json()
  File "/usr/local/lib/python3.10/site-packages/werkzeug/wrappers/request.py", line 604, in get_json
    return self.on_json_loading_failed(None)
  File "/usr/local/lib/python3.10/site-packages/flask/wrappers.py", line 130, in on_json_loading_failed
    return super().on_json_loading_failed(e)
  File "/usr/local/lib/python3.10/site-packages/werkzeug/wrappers/request.py", line 647, in on_json_loading_failed
    raise UnsupportedMediaType(
werkzeug.exceptions.UnsupportedMediaType: 415 Unsupported Media Type: Did not attempt to load JSON data because the request Content-Type was not 'application/json'.
2025-11-15 16:48:50,470 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001"}], "sceneId": 123, "algorithmCode": "fire", "type": "3", "start": "00:00:00", "end": "23:59:59", "strategyTime": 15, "strategyCount": 10}
2025-11-15 16:48:50,472 - src.scene_manager - INFO - 开始部署场景v2: sceneId=123, algorithmCode=fire, type=3
2025-11-15 16:48:50,472 - src.scene_manager - INFO - Type 3: 每日时间段=00:00:00-23:59:59, 永久有效
2025-11-15 16:48:50,472 - src.scene_manager - INFO - 开始部署场景: scene_123, 算法: fire, 设备数: 1, 时间类型: 3
2025-11-15 16:48:50,472 - src.scene_mapper - WARNING - 未找到算法 'fire' 的配置，请检查 model.algorithm_models
2025-11-15 16:48:50,473 - src.api_server - WARNING - 场景下发失败: 未找到算法 "fire" 对应的模型
2025-11-15 16:49:23,929 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001"}], "sceneId": 123, "algorithmCode": "安全帽检测", "type": "3", "start": "00:00:00", "end": "23:59:59", "strategyTime": 15, "strategyCount": 10}
2025-11-15 16:49:23,930 - src.scene_manager - INFO - 开始部署场景v2: sceneId=123, algorithmCode=安全帽检测, type=3
2025-11-15 16:49:23,931 - src.scene_manager - INFO - Type 3: 每日时间段=00:00:00-23:59:59, 永久有效
2025-11-15 16:49:23,931 - src.scene_manager - INFO - 开始部署场景: scene_123, 算法: 安全帽检测, 设备数: 1, 时间类型: 3
2025-11-15 16:49:23,931 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-15 16:49:23,931 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 16:49:23,961 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://host.docker.internal:8554/stream1
2025-11-15 16:49:23,962 - src.stream_manager - INFO - 视频流注册成功: scene_scene_123_31011500001320000001
2025-11-15 16:49:23,995 - src.detection_engine - ERROR - 无法打开视频源: rtsp://host.docker.internal:8554/stream1
2025-11-15 16:49:23,995 - src.detection_engine - WARNING - 视频流不存在: scene_scene_123_31011500001320000001
2025-11-15 16:49:23,995 - src.stream_manager - INFO - 视频流注销成功: scene_scene_123_31011500001320000001
2025-11-15 16:49:23,995 - src.scene_manager - INFO - 场景部署完成: 成功0个, 失败1个
2025-11-15 16:49:23,996 - src.api_server - WARNING - 场景下发失败: 场景部署失败
2025-11-15 16:49:45,647 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001"}], "sceneId": 123, "algorithmCode": "安全帽检测", "type": "3", "start": "00:00:00", "end": "23:59:59", "strategyTime": 15, "strategyCount": 10}
2025-11-15 16:49:45,647 - src.scene_manager - INFO - 开始部署场景v2: sceneId=123, algorithmCode=安全帽检测, type=3
2025-11-15 16:49:45,647 - src.scene_manager - INFO - Type 3: 每日时间段=00:00:00-23:59:59, 永久有效
2025-11-15 16:49:45,648 - src.scene_manager - INFO - 开始部署场景: scene_123, 算法: 安全帽检测, 设备数: 1, 时间类型: 3
2025-11-15 16:49:45,648 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-15 16:49:45,648 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 16:49:45,655 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://host.docker.internal:8554/stream1
2025-11-15 16:49:45,655 - src.stream_manager - INFO - 视频流注册成功: scene_scene_123_31011500001320000001
2025-11-15 16:49:50,788 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-15 16:49:50,789 - src.detection_engine - INFO - 视频流检测启动成功: scene_scene_123_31011500001320000001
2025-11-15 16:49:50,790 - src.stream_manager - INFO - 视频流启动成功: scene_scene_123_31011500001320000001
2025-11-15 16:49:50,793 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程启动
2025-11-15 16:49:50,793 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已启动
2025-11-15 16:49:50,796 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-15 16:49:50,796 - src.scene_manager - INFO - 场景部署完成: 成功1个, 失败0个
2025-11-15 16:49:50,797 - src.scene_manager - INFO - 场景部署成功: sceneId=123, type=3, months=None, daily=00:00:00-23:59:59
2025-11-15 16:49:50,797 - src.api_server - INFO - 场景下发成功: sceneId=123, algorithmCode=安全帽检测
2025-11-15 16:49:55,953 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 视频设置:
2025-11-15 16:49:55,954 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-15 16:49:55,954 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-15 16:49:55,955 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-15 16:49:55,955 - src.detection_engine - INFO - 开始处理视频流: scene_scene_123_31011500001320000001
2025-11-15 16:50:01,080 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/16-50-00-972_frame_2/annotated.png
2025-11-15 16:50:01,081 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=head, 置信度=0.82
2025-11-15 16:50:08,241 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 10 帧, 检测耗时: 0.273s
2025-11-15 16:50:18,443 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 20 帧, 检测耗时: 0.331s, 实际帧间隔: 1.016s
2025-11-15 16:50:28,620 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 30 帧, 检测耗时: 0.229s, 实际帧间隔: 1.024s
2025-11-15 16:50:31,614 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/16-50-31-495_frame_32/annotated.png
2025-11-15 16:50:31,614 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=head, 置信度=0.72
2025-11-15 16:50:38,809 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 40 帧, 检测耗时: 0.229s, 实际帧间隔: 1.027s
2025-11-15 16:50:42,740 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001"}], "sceneId": 12453, "algorithmCode": "安全帽检测", "type": "3", "start": "00:00:00", "end": "23:59:59", "strategyTime": 15, "strategyCount": 10}
2025-11-15 16:50:42,741 - src.scene_manager - INFO - 开始部署场景v2: sceneId=12453, algorithmCode=安全帽检测, type=3
2025-11-15 16:50:42,741 - src.scene_manager - INFO - Type 3: 每日时间段=00:00:00-23:59:59, 永久有效
2025-11-15 16:50:42,741 - src.scene_manager - INFO - 开始部署场景: scene_12453, 算法: 安全帽检测, 设备数: 1, 时间类型: 3
2025-11-15 16:50:42,741 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-15 16:50:42,742 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 16:50:42,748 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://host.docker.internal:8554/stream1
2025-11-15 16:50:42,748 - src.stream_manager - INFO - 视频流注册成功: scene_scene_12453_31011500001320000001
2025-11-15 16:50:47,892 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-15 16:50:47,892 - src.detection_engine - INFO - 视频流检测启动成功: scene_scene_12453_31011500001320000001
2025-11-15 16:50:47,892 - src.stream_manager - INFO - 视频流启动成功: scene_scene_12453_31011500001320000001
2025-11-15 16:50:47,893 - src.heartbeat_manager - WARNING - 设备 31011500001320000001 心跳已在运行
2025-11-15 16:50:47,893 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-15 16:50:47,893 - src.scene_manager - INFO - 场景部署完成: 成功1个, 失败0个
2025-11-15 16:50:47,893 - src.scene_manager - INFO - 场景部署成功: sceneId=12453, type=3, months=None, daily=00:00:00-23:59:59
2025-11-15 16:50:47,893 - src.api_server - INFO - 场景下发成功: sceneId=12453, algorithmCode=安全帽检测
2025-11-15 16:50:49,082 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 50 帧, 检测耗时: 0.227s, 实际帧间隔: 1.025s
2025-11-15 16:50:49,980 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 视频设置:
2025-11-15 16:50:49,981 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-15 16:50:49,983 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-15 16:50:49,983 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-15 16:50:49,985 - src.detection_engine - INFO - 开始处理视频流: scene_scene_12453_31011500001320000001
2025-11-15 16:50:50,790 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001"}], "sceneId": 12453, "algorithmCode": "安全帽检测", "type": "3", "start": "00:00:00", "end": "23:59:59", "strategyTime": 15, "strategyCount": 10}
2025-11-15 16:50:50,790 - src.scene_manager - INFO - 开始部署场景v2: sceneId=12453, algorithmCode=安全帽检测, type=3
2025-11-15 16:50:50,791 - src.scene_manager - INFO - 检测到场景 12453 已存在，先停止旧场景
2025-11-15 16:50:50,819 - src.detection_engine - INFO - 检测线程结束: scene_scene_12453_31011500001320000001
2025-11-15 16:50:50,819 - src.stream_manager - INFO - 流 scene_scene_12453_31011500001320000001 已断开: 检测线程结束
2025-11-15 16:50:50,820 - src.detection_engine - INFO - 视频流检测停止成功: scene_scene_12453_31011500001320000001
2025-11-15 16:50:50,820 - src.stream_manager - INFO - 视频流停止成功: scene_scene_12453_31011500001320000001
2025-11-15 16:50:50,821 - src.detection_engine - WARNING - 视频流不存在: scene_scene_12453_31011500001320000001
2025-11-15 16:50:50,821 - src.stream_manager - INFO - 视频流注销成功: scene_scene_12453_31011500001320000001
2025-11-15 16:50:50,821 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程结束
2025-11-15 16:50:50,821 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已停止
2025-11-15 16:50:50,821 - src.scene_manager - INFO - 部署 12453 已停止
2025-11-15 16:50:50,822 - src.scene_manager - INFO - Type 3: 每日时间段=00:00:00-23:59:59, 永久有效
2025-11-15 16:50:50,822 - src.scene_manager - INFO - 开始部署场景: scene_12453, 算法: 安全帽检测, 设备数: 1, 时间类型: 3
2025-11-15 16:50:50,822 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-15 16:50:50,822 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 16:50:50,828 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://host.docker.internal:8554/stream1
2025-11-15 16:50:50,828 - src.stream_manager - INFO - 视频流注册成功: scene_scene_12453_31011500001320000001
2025-11-15 16:50:55,954 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-15 16:50:55,955 - src.detection_engine - INFO - 视频流检测启动成功: scene_scene_12453_31011500001320000001
2025-11-15 16:50:55,959 - src.stream_manager - INFO - 视频流启动成功: scene_scene_12453_31011500001320000001
2025-11-15 16:50:55,959 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程启动
2025-11-15 16:50:55,960 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已启动
2025-11-15 16:50:55,976 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-15 16:50:55,977 - src.scene_manager - INFO - 场景部署完成: 成功1个, 失败0个
2025-11-15 16:50:55,978 - src.scene_manager - INFO - 场景部署成功: sceneId=12453, type=3, months=None, daily=00:00:00-23:59:59
2025-11-15 16:50:55,979 - src.api_server - INFO - 场景下发成功: sceneId=12453, algorithmCode=安全帽检测
2025-11-15 16:50:58,295 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 视频设置:
2025-11-15 16:50:58,296 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-15 16:50:58,297 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-15 16:50:58,297 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-15 16:50:58,297 - src.detection_engine - INFO - 开始处理视频流: scene_scene_12453_31011500001320000001
2025-11-15 16:50:59,290 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 60 帧, 检测耗时: 0.271s, 实际帧间隔: 1.017s
2025-11-15 16:51:00,743 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/16-51-00-623_frame_2/annotated.png
2025-11-15 16:51:00,743 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.88
2025-11-15 16:51:02,313 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/16-51-02-199_frame_62/annotated.png
2025-11-15 16:51:02,313 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=head, 置信度=0.87
2025-11-15 16:51:02,313 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_123_31011500001320000001, 类别=head, 置信度=0.87
2025-11-15 16:51:02,314 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_123_31011500001320000001 | 类别: head | 置信度: 0.87 | 级别: high | 连续帧数: 30
2025-11-15 16:51:02,314 - src.alarm_system - ERROR - 转换告警数据格式失败: 'SceneManager' object has no attribute 'get_all_deployments'
2025-11-15 16:51:02,317 - src.alarm_system - ERROR - 转换到v2格式失败
2025-11-15 16:51:02,317 - src.alarm_system - INFO - 告警HTTP回调失败: 31011500001320000001, 类型: head
2025-11-15 16:51:08,011 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 10 帧, 检测耗时: 0.354s
2025-11-15 16:51:09,538 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 70 帧, 检测耗时: 0.227s, 实际帧间隔: 1.028s
2025-11-15 16:51:18,657 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 20 帧, 检测耗时: 0.691s, 实际帧间隔: 1.016s
2025-11-15 16:51:19,883 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 80 帧, 检测耗时: 0.225s, 实际帧间隔: 1.029s
2025-11-15 16:51:28,535 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 30 帧, 检测耗时: 0.511s, 实际帧间隔: 1.017s
2025-11-15 16:51:30,131 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 90 帧, 检测耗时: 0.217s, 实际帧间隔: 1.025s
2025-11-15 16:51:31,381 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/16-51-31-277_frame_32/annotated.png
2025-11-15 16:51:31,382 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.81
2025-11-15 16:51:33,141 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/16-51-32-985_frame_92/annotated.png
2025-11-15 16:51:33,142 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=head, 置信度=0.82
2025-11-15 16:51:38,439 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 40 帧, 检测耗时: 0.336s, 实际帧间隔: 1.019s
2025-11-15 16:51:40,303 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 100 帧, 检测耗时: 0.225s, 实际帧间隔: 1.022s
2025-11-15 16:51:48,782 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 50 帧, 检测耗时: 0.435s, 实际帧间隔: 1.018s
2025-11-15 16:51:50,659 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 110 帧, 检测耗时: 0.263s, 实际帧间隔: 1.022s
2025-11-15 16:51:58,907 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 60 帧, 检测耗时: 0.394s, 实际帧间隔: 1.021s
2025-11-15 16:52:00,810 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 120 帧, 检测耗时: 0.277s, 实际帧间隔: 1.018s
2025-11-15 16:52:02,112 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/16-52-01-971_frame_62/annotated.png
2025-11-15 16:52:02,112 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.81
2025-11-15 16:52:02,112 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.81
2025-11-15 16:52:02,113 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.81 | 级别: high | 连续帧数: 30
2025-11-15 16:52:02,113 - src.alarm_system - ERROR - 转换告警数据格式失败: 'SceneManager' object has no attribute 'get_all_deployments'
2025-11-15 16:52:02,117 - src.alarm_system - ERROR - 转换到v2格式失败
2025-11-15 16:52:02,117 - src.alarm_system - INFO - 告警HTTP回调失败: 31011500001320000001, 类型: head
2025-11-15 16:52:03,937 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/16-52-03-707_frame_122/annotated.png
2025-11-15 16:52:03,937 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=head, 置信度=0.88
2025-11-15 16:52:09,144 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 70 帧, 检测耗时: 0.305s, 实际帧间隔: 1.018s
2025-11-15 16:52:11,309 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 130 帧, 检测耗时: 0.525s, 实际帧间隔: 1.033s
2025-11-15 16:52:19,617 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 80 帧, 检测耗时: 0.331s, 实际帧间隔: 1.050s
2025-11-15 16:52:21,823 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 140 帧, 检测耗时: 0.241s, 实际帧间隔: 1.076s
2025-11-15 16:52:29,652 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 90 帧, 检测耗时: 0.221s, 实际帧间隔: 1.024s
2025-11-15 16:52:32,067 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 150 帧, 检测耗时: 0.219s, 实际帧间隔: 1.030s
2025-11-15 16:52:32,698 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/16-52-32-603_frame_92/annotated.png
2025-11-15 16:52:32,698 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.89
2025-11-15 16:52:34,109 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/16-52-34-003_frame_151/annotated.png
2025-11-15 16:52:34,109 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=head, 置信度=0.88
2025-11-15 16:52:34,109 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_123_31011500001320000001, 类别=head, 置信度=0.88
2025-11-15 16:52:34,109 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_123_31011500001320000001 | 类别: head | 置信度: 0.88 | 级别: high | 连续帧数: 29
2025-11-15 16:52:34,110 - src.alarm_system - ERROR - 转换告警数据格式失败: 'SceneManager' object has no attribute 'get_all_deployments'
2025-11-15 16:52:34,114 - src.alarm_system - ERROR - 转换到v2格式失败
2025-11-15 16:52:34,114 - src.alarm_system - INFO - 告警HTTP回调失败: 31011500001320000001, 类型: head
2025-11-15 16:52:39,885 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 100 帧, 检测耗时: 0.268s, 实际帧间隔: 1.019s
2025-11-15 16:52:42,387 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 160 帧, 检测耗时: 0.263s, 实际帧间隔: 1.017s
2025-11-15 16:52:50,048 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 110 帧, 检测耗时: 0.226s, 实际帧间隔: 1.018s
2025-11-15 16:52:52,532 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 170 帧, 检测耗时: 0.218s, 实际帧间隔: 1.030s
2025-11-15 16:53:00,515 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 120 帧, 检测耗时: 0.250s, 实际帧间隔: 1.028s
2025-11-15 16:53:02,865 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 180 帧, 检测耗时: 0.386s, 实际帧间隔: 1.014s
2025-11-15 16:53:03,539 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/16-53-03-350_frame_122/annotated.png
2025-11-15 16:53:03,540 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.85
2025-11-15 16:53:04,752 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/16-53-04-646_frame_181/annotated.png
2025-11-15 16:53:04,752 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=head, 置信度=0.86
2025-11-15 16:53:09,148 - src.api_server - ERROR - 场景启停异常: 415 Unsupported Media Type: Did not attempt to load JSON data because the request Content-Type was not 'application/json'.
Traceback (most recent call last):
  File "/app/src/api_server.py", line 211, in scene_start_stop
    data = request.get_json()
  File "/usr/local/lib/python3.10/site-packages/werkzeug/wrappers/request.py", line 604, in get_json
    return self.on_json_loading_failed(None)
  File "/usr/local/lib/python3.10/site-packages/flask/wrappers.py", line 130, in on_json_loading_failed
    return super().on_json_loading_failed(e)
  File "/usr/local/lib/python3.10/site-packages/werkzeug/wrappers/request.py", line 647, in on_json_loading_failed
    raise UnsupportedMediaType(
werkzeug.exceptions.UnsupportedMediaType: 415 Unsupported Media Type: Did not attempt to load JSON data because the request Content-Type was not 'application/json'.
2025-11-15 16:53:10,644 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 130 帧, 检测耗时: 0.281s, 实际帧间隔: 1.020s
2025-11-15 16:53:12,934 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 190 帧, 检测耗时: 0.220s, 实际帧间隔: 1.024s
2025-11-15 16:53:20,807 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 140 帧, 检测耗时: 0.211s, 实际帧间隔: 1.024s
2025-11-15 16:53:23,390 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 200 帧, 检测耗时: 0.224s, 实际帧间隔: 1.045s
2025-11-15 16:53:31,108 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 150 帧, 检测耗时: 0.241s, 实际帧间隔: 1.031s
2025-11-15 16:53:33,604 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 210 帧, 检测耗时: 0.218s, 实际帧间隔: 1.023s
2025-11-15 16:53:34,144 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/16-53-34-024_frame_152/annotated.png
2025-11-15 16:53:34,144 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.89
2025-11-15 16:53:34,144 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.89
2025-11-15 16:53:34,145 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.89 | 级别: high | 连续帧数: 30
2025-11-15 16:53:34,145 - src.alarm_system - ERROR - 转换告警数据格式失败: 'SceneManager' object has no attribute 'get_all_deployments'
2025-11-15 16:53:34,150 - src.alarm_system - ERROR - 转换到v2格式失败
2025-11-15 16:53:34,151 - src.alarm_system - INFO - 告警HTTP回调失败: 31011500001320000001, 类型: head
2025-11-15 16:53:36,339 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/16-53-36-056_frame_211/annotated.png
2025-11-15 16:53:36,340 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=head, 置信度=0.90
2025-11-15 16:53:41,901 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 160 帧, 检测耗时: 0.639s, 实际帧间隔: 1.027s
2025-11-15 16:53:43,992 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 220 帧, 检测耗时: 0.264s, 实际帧间隔: 1.024s
2025-11-15 16:53:51,554 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 170 帧, 检测耗时: 0.220s, 实际帧间隔: 1.024s
2025-11-15 16:53:53,131 - src.api_server - INFO - 收到场景启停请求: sceneId=1234, status=0
2025-11-15 16:53:54,116 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 230 帧, 检测耗时: 0.221s, 实际帧间隔: 1.026s
2025-11-15 16:54:01,840 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 180 帧, 检测耗时: 0.267s, 实际帧间隔: 1.022s
2025-11-15 16:54:04,901 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 240 帧, 检测耗时: 0.812s, 实际帧间隔: 1.013s
2025-11-15 16:54:05,157 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/16-54-04-988_frame_182/annotated.png
2025-11-15 16:54:05,157 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.86
2025-11-15 16:54:06,277 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/16-54-06-165_frame_241/annotated.png
2025-11-15 16:54:06,277 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=head, 置信度=0.87
2025-11-15 16:54:06,278 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_123_31011500001320000001, 类别=head, 置信度=0.87
2025-11-15 16:54:06,278 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_123_31011500001320000001 | 类别: head | 置信度: 0.87 | 级别: high | 连续帧数: 30
2025-11-15 16:54:06,278 - src.alarm_system - ERROR - 转换告警数据格式失败: 'SceneManager' object has no attribute 'get_all_deployments'
2025-11-15 16:54:06,283 - src.alarm_system - ERROR - 转换到v2格式失败
2025-11-15 16:54:06,284 - src.alarm_system - INFO - 告警HTTP回调失败: 31011500001320000001, 类型: head
2025-11-15 16:54:12,118 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 190 帧, 检测耗时: 0.282s, 实际帧间隔: 1.023s
2025-11-15 16:54:14,520 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 250 帧, 检测耗时: 0.252s, 实际帧间隔: 1.018s
2025-11-15 16:54:14,862 - src.api_server - INFO - 收到场景启停请求: sceneId=123, status=0
2025-11-15 16:54:14,868 - src.detection_engine - INFO - 检测线程结束: scene_scene_123_31011500001320000001
2025-11-15 16:54:14,869 - src.stream_manager - INFO - 流 scene_scene_123_31011500001320000001 已断开: 检测线程结束
2025-11-15 16:54:14,869 - src.detection_engine - INFO - 视频流检测停止成功: scene_scene_123_31011500001320000001
2025-11-15 16:54:14,870 - src.stream_manager - INFO - 视频流停止成功: scene_scene_123_31011500001320000001
2025-11-15 16:54:14,870 - src.detection_engine - WARNING - 视频流不存在: scene_scene_123_31011500001320000001
2025-11-15 16:54:14,870 - src.stream_manager - INFO - 视频流注销成功: scene_scene_123_31011500001320000001
2025-11-15 16:54:14,871 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程结束
2025-11-15 16:54:14,871 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已停止
2025-11-15 16:54:14,871 - src.scene_manager - INFO - 部署 123 已停止
2025-11-15 16:54:14,871 - src.scene_manager - INFO - 场景 123 停止成功
2025-11-15 16:54:14,871 - src.api_server - INFO - 场景停止成功: sceneId=123
2025-11-15 16:54:17,580 - src.api_server - INFO - 收到场景启停请求: sceneId=123, status=0
2025-11-15 16:54:22,175 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 200 帧, 检测耗时: 0.235s, 实际帧间隔: 1.015s
2025-11-15 16:54:32,580 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 210 帧, 检测耗时: 0.349s, 实际帧间隔: 1.027s
2025-11-15 16:54:35,541 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/16-54-35-440_frame_212/annotated.png
2025-11-15 16:54:35,542 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.90
2025-11-15 16:54:42,746 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 220 帧, 检测耗时: 0.264s, 实际帧间隔: 1.022s
2025-11-15 16:54:52,886 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 230 帧, 检测耗时: 0.244s, 实际帧间隔: 1.019s
2025-11-15 16:55:03,271 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 240 帧, 检测耗时: 0.268s, 实际帧间隔: 1.034s
2025-11-15 16:55:06,402 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/16-55-06-267_frame_242/annotated.png
2025-11-15 16:55:06,403 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.92
2025-11-15 16:55:06,403 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.92
2025-11-15 16:55:06,404 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.92 | 级别: high | 连续帧数: 30
2025-11-15 16:55:06,404 - src.alarm_system - ERROR - 转换告警数据格式失败: 'SceneManager' object has no attribute 'get_all_deployments'
2025-11-15 16:55:06,406 - src.alarm_system - ERROR - 转换到v2格式失败
2025-11-15 16:55:06,406 - src.alarm_system - INFO - 告警HTTP回调失败: 31011500001320000001, 类型: head
2025-11-15 16:55:15,305 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 250 帧, 检测耗时: 0.489s, 实际帧间隔: 1.100s
2025-11-15 16:55:25,606 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 260 帧, 检测耗时: 0.309s, 实际帧间隔: 1.130s
2025-11-15 16:55:35,696 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 270 帧, 检测耗时: 0.229s, 实际帧间隔: 1.019s
2025-11-15 16:55:36,718 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/16-55-36-602_frame_270/annotated.png
2025-11-15 16:55:36,718 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-15 16:55:45,925 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 280 帧, 检测耗时: 0.235s, 实际帧间隔: 1.022s
2025-11-15 16:55:56,244 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 290 帧, 检测耗时: 0.296s, 实际帧间隔: 1.020s
2025-11-15 16:56:06,288 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 300 帧, 检测耗时: 0.234s, 实际帧间隔: 1.017s
2025-11-15 16:56:07,721 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/16-56-07-602_frame_300/annotated.png
2025-11-15 16:56:07,721 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.95
2025-11-15 16:56:16,861 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 310 帧, 检测耗时: 0.229s, 实际帧间隔: 1.058s
2025-11-15 16:56:27,273 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 320 帧, 检测耗时: 0.323s, 实际帧间隔: 1.029s
2025-11-15 16:56:38,156 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/16-56-38-033_frame_329/annotated.png
2025-11-15 16:56:38,159 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.86
2025-11-15 16:56:38,159 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.86
2025-11-15 16:56:38,160 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 330 帧, 检测耗时: 0.264s, 实际帧间隔: 1.093s
2025-11-15 16:56:38,160 - src.alarm_system - ERROR - 转换告警数据格式失败: 'SceneManager' object has no attribute 'get_all_deployments'
2025-11-15 16:56:38,160 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.86 | 级别: high | 连续帧数: 24
2025-11-15 16:56:38,164 - src.alarm_system - ERROR - 转换到v2格式失败
2025-11-15 16:56:38,166 - src.alarm_system - INFO - 告警HTTP回调失败: 31011500001320000001, 类型: head
2025-11-15 16:56:48,531 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 340 帧, 检测耗时: 0.251s, 实际帧间隔: 1.053s
2025-11-15 16:56:58,710 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 350 帧, 检测耗时: 0.230s, 实际帧间隔: 1.019s
2025-11-15 16:57:09,057 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/16-57-08-963_frame_359/annotated.png
2025-11-15 16:57:09,057 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.97
2025-11-15 16:57:09,058 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 360 帧, 检测耗时: 0.237s, 实际帧间隔: 1.023s
2025-11-15 16:57:19,231 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 370 帧, 检测耗时: 0.248s, 实际帧间隔: 1.015s
2025-11-15 16:57:27,304 - __main__ - INFO - 接收到信号 15，正在关闭系统...
2025-11-15 16:57:27,306 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-15 16:57:27,307 - src.api_server - INFO - 正在停止API服务器...
2025-11-15 16:57:30,814 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-15 16:57:30,815 - src.config_manager - INFO - 重新加载配置文件
2025-11-15 16:57:30,827 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-15 16:57:30,828 - __main__ - INFO - 正在初始化系统组件...
2025-11-15 16:57:30,829 - __main__ - INFO - 预加载AI模型...
2025-11-15 16:57:30,830 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-15 16:57:31,011 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: cpu
2025-11-15 16:57:31,018 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-15 16:57:31,222 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:57:31,222 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:57:31,712 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: cpu
2025-11-15 16:57:31,714 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-15 16:57:31,780 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:57:31,781 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-15 16:57:31,855 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 16:57:31,855 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-15 16:57:31,856 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-15 16:57:31,856 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-15 16:57:31,856 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-15 16:57:31,856 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-15 16:57:31,856 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:57:31,856 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-15 16:57:31,857 - __main__ - INFO - 初始化检测引擎...
2025-11-15 16:57:31,857 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 16:57:32,261 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-15 16:57:32,262 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8081
2025-11-15 16:57:32,262 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-15 16:57:32,262 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-15 16:57:32,264 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-15 16:57:32,264 - __main__ - INFO - 初始化流管理器...
2025-11-15 16:57:32,264 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-15 16:57:32,264 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 16:57:32,264 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-15 16:57:32,268 - src.stream_manager - INFO - 流监控线程启动
2025-11-15 16:57:32,269 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-15 16:57:32,269 - __main__ - INFO - 初始化场景管理组件...
2025-11-15 16:57:32,270 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-15 16:57:32,270 - src.device_platform_client - INFO - 设备平台客户端初始化: http://host.docker.internal:8081
2025-11-15 16:57:32,270 - __main__ - INFO - 初始化报警系统...
2025-11-15 16:57:32,270 - src.kafka_publisher - INFO - 初始化Kafka生产者: host.docker.internal:9092, topic: event-alarm
2025-11-15 16:57:32,291 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 16:57:32,293 - kafka.conn - INFO - Probing node bootstrap-0 broker version
2025-11-15 16:57:32,305 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 16:57:32,306 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 16:57:32,326 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 16:57:32,328 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 16:57:32,328 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 16:57:32,329 - src.kafka_publisher - ERROR - Kafka生产者初始化失败: NoBrokersAvailable
2025-11-15 16:57:32,329 - src.alarm_system - INFO - Kafka推送器初始化成功
2025-11-15 16:57:32,329 - src.alarm_system - INFO - 告警通知方式: http, 格式版本: v2
2025-11-15 16:57:32,331 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-15 16:57:32,331 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-15 16:57:32,331 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-15 16:57:32,331 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-15 16:57:32,331 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-15 16:57:32,331 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-15 16:57:32,332 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 16:57:32,332 - __main__ - INFO - 初始化API服务器...
2025-11-15 16:57:32,334 - src.api_server - INFO - API服务器初始化完成
2025-11-15 16:57:32,335 - __main__ - INFO - 系统组件初始化完成
2025-11-15 16:57:32,335 - __main__ - INFO - 启动实时视频检测系统...
2025-11-15 16:57:32,335 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-15 16:57:32,337 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-15 17:03:13,353 - src.api_server - INFO - 收到场景启停请求: sceneId=123, status=0
2025-11-15 17:03:14,410 - src.api_server - INFO - 收到场景启停请求: sceneId=123, status=0
2025-11-15 17:38:31,806 - __main__ - INFO - 接收到信号 15，正在关闭系统...
2025-11-15 17:38:31,807 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-15 17:38:31,808 - src.api_server - INFO - 正在停止API服务器...
2025-11-15 17:38:34,317 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-15 17:38:34,317 - src.config_manager - INFO - 重新加载配置文件
2025-11-15 17:38:34,324 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-15 17:38:34,324 - __main__ - INFO - 正在初始化系统组件...
2025-11-15 17:38:34,324 - __main__ - INFO - 预加载AI模型...
2025-11-15 17:38:34,325 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-15 17:38:34,371 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 17:38:34,371 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 17:38:34,572 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: cpu
2025-11-15 17:38:34,573 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-15 17:38:34,654 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: cpu
2025-11-15 17:38:34,655 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-15 17:38:34,700 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 17:38:34,701 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-15 17:38:34,771 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 17:38:34,771 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-15 17:38:34,771 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-15 17:38:34,771 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-15 17:38:34,772 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-15 17:38:34,772 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-15 17:38:34,772 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 17:38:34,772 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-15 17:38:34,772 - __main__ - INFO - 初始化检测引擎...
2025-11-15 17:38:34,772 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 17:38:34,945 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-15 17:38:34,945 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8081
2025-11-15 17:38:34,945 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-15 17:38:34,946 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-15 17:38:34,946 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-15 17:38:34,946 - __main__ - INFO - 初始化流管理器...
2025-11-15 17:38:34,946 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-15 17:38:34,947 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 17:38:34,947 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-15 17:38:34,947 - src.stream_manager - INFO - 流监控线程启动
2025-11-15 17:38:34,947 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-15 17:38:34,947 - __main__ - INFO - 初始化场景管理组件...
2025-11-15 17:38:34,947 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-15 17:38:34,947 - src.device_platform_client - INFO - 设备平台客户端初始化: http://host.docker.internal:8081
2025-11-15 17:38:34,947 - __main__ - INFO - 初始化报警系统...
2025-11-15 17:38:34,948 - src.kafka_publisher - INFO - 初始化Kafka生产者: host.docker.internal:9092, topic: event-alarm
2025-11-15 17:38:34,951 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 17:38:34,951 - kafka.conn - INFO - Probing node bootstrap-0 broker version
2025-11-15 17:38:34,956 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 17:38:34,956 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 17:38:34,998 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 17:38:35,000 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 17:38:35,000 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 17:38:35,000 - src.kafka_publisher - ERROR - Kafka生产者初始化失败: NoBrokersAvailable
2025-11-15 17:38:35,000 - src.alarm_system - INFO - Kafka推送器初始化成功
2025-11-15 17:38:35,001 - src.alarm_system - INFO - 告警通知方式: http, 格式: v2 (sceneId, deviceGbCode, alarmTime, path)
2025-11-15 17:38:35,002 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-15 17:38:35,002 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-15 17:38:35,002 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-15 17:38:35,003 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-15 17:38:35,003 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-15 17:38:35,003 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-15 17:38:35,004 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 17:38:35,004 - __main__ - INFO - 初始化API服务器...
2025-11-15 17:38:35,006 - src.api_server - INFO - API服务器初始化完成
2025-11-15 17:38:35,007 - __main__ - INFO - 系统组件初始化完成
2025-11-15 17:38:35,007 - __main__ - INFO - 启动实时视频检测系统...
2025-11-15 17:38:35,007 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-15 17:38:35,011 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-15 17:38:54,483 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001"}], "sceneId": 12453, "algorithmCode": "安全帽检测", "type": "3", "start": "00:00:00", "end": "23:59:59", "strategyTime": 15, "strategyCount": 10}
2025-11-15 17:38:54,485 - src.scene_manager - INFO - 开始部署场景v2: sceneId=12453, algorithmCode=安全帽检测, type=3
2025-11-15 17:38:54,486 - src.scene_manager - INFO - Type 3: 每日时间段=00:00:00-23:59:59, 永久有效
2025-11-15 17:38:54,486 - src.scene_manager - INFO - 开始部署场景: scene_12453, 算法: 安全帽检测, 设备数: 1, 时间类型: 3
2025-11-15 17:38:54,487 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-15 17:38:54,487 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 17:38:54,542 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://host.docker.internal:8554/stream1
2025-11-15 17:38:54,543 - src.stream_manager - INFO - 视频流注册成功: scene_scene_12453_31011500001320000001
2025-11-15 17:38:55,567 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-15 17:38:55,567 - src.detection_engine - INFO - 视频流检测启动成功: scene_scene_12453_31011500001320000001
2025-11-15 17:38:55,568 - src.stream_manager - INFO - 视频流启动成功: scene_scene_12453_31011500001320000001
2025-11-15 17:38:55,569 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程启动
2025-11-15 17:38:55,569 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已启动
2025-11-15 17:38:55,571 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-15 17:38:55,571 - src.scene_manager - INFO - 场景部署完成: 成功1个, 失败0个
2025-11-15 17:38:55,571 - src.scene_manager - INFO - 场景部署成功: sceneId=12453, type=3, months=None, daily=00:00:00-23:59:59
2025-11-15 17:38:55,571 - src.api_server - INFO - 场景下发成功: sceneId=12453, algorithmCode=安全帽检测
2025-11-15 17:39:00,708 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 视频设置:
2025-11-15 17:39:00,708 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-15 17:39:00,709 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-15 17:39:00,709 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-15 17:39:00,710 - src.detection_engine - INFO - 开始处理视频流: scene_scene_12453_31011500001320000001
2025-11-15 17:39:04,913 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-39-04-820_frame_2/annotated.png
2025-11-15 17:39:04,914 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.87
2025-11-15 17:39:12,064 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 10 帧, 检测耗时: 0.227s
2025-11-15 17:39:22,241 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 20 帧, 检测耗时: 0.237s, 实际帧间隔: 1.014s
2025-11-15 17:39:32,517 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 30 帧, 检测耗时: 0.256s, 实际帧间隔: 1.023s
2025-11-15 17:39:35,647 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-39-35-475_frame_32/annotated.png
2025-11-15 17:39:35,648 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.92
2025-11-15 17:39:42,662 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 40 帧, 检测耗时: 0.228s, 实际帧间隔: 1.023s
2025-11-15 17:39:52,918 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 50 帧, 检测耗时: 0.238s, 实际帧间隔: 1.023s
2025-11-15 17:40:03,042 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 60 帧, 检测耗时: 0.231s, 实际帧间隔: 1.012s
2025-11-15 17:40:06,125 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-40-06-025_frame_62/annotated.png
2025-11-15 17:40:06,126 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.88
2025-11-15 17:40:06,126 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.88
2025-11-15 17:40:06,126 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.88 | 级别: high | 连续帧数: 30
2025-11-15 17:40:06,130 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 17:40:06,152 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763199606.png
2025-11-15 17:40:06,153 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763199606.png
2025-11-15 17:40:06,158 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 17:40:06,158 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 17:40:13,243 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 70 帧, 检测耗时: 0.228s, 实际帧间隔: 1.022s
2025-11-15 17:40:23,429 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 80 帧, 检测耗时: 0.230s, 实际帧间隔: 1.019s
2025-11-15 17:40:33,797 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 90 帧, 检测耗时: 0.295s, 实际帧间隔: 1.027s
2025-11-15 17:40:36,827 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-40-36-698_frame_92/annotated.png
2025-11-15 17:40:36,828 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.88
2025-11-15 17:40:43,922 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 100 帧, 检测耗时: 0.231s, 实际帧间隔: 1.022s
2025-11-15 17:40:54,166 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 110 帧, 检测耗时: 0.234s, 实际帧间隔: 1.025s
2025-11-15 17:41:04,373 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 120 帧, 检测耗时: 0.252s, 实际帧间隔: 1.016s
2025-11-15 17:41:07,019 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-41-06-791_frame_121/annotated.png
2025-11-15 17:41:07,020 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.88
2025-11-15 17:41:14,784 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 130 帧, 检测耗时: 0.373s, 实际帧间隔: 1.025s
2025-11-15 17:41:25,008 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 140 帧, 检测耗时: 0.322s, 实际帧间隔: 1.031s
2025-11-15 17:41:35,139 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 150 帧, 检测耗时: 0.230s, 实际帧间隔: 1.023s
2025-11-15 17:41:37,163 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-41-37-055_frame_151/annotated.png
2025-11-15 17:41:37,163 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-15 17:41:37,163 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.93
2025-11-15 17:41:37,164 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.93 | 级别: high | 连续帧数: 30
2025-11-15 17:41:37,167 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 17:41:37,190 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763199697.png
2025-11-15 17:41:37,191 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763199697.png
2025-11-15 17:41:37,196 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 17:41:37,196 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 17:41:45,387 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 160 帧, 检测耗时: 0.237s, 实际帧间隔: 1.019s
2025-11-15 17:41:55,613 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 170 帧, 检测耗时: 0.261s, 实际帧间隔: 1.024s
2025-11-15 17:42:05,756 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 180 帧, 检测耗时: 0.241s, 实际帧间隔: 1.018s
2025-11-15 17:42:07,784 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-42-07-677_frame_181/annotated.png
2025-11-15 17:42:07,785 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.84
2025-11-15 17:42:15,947 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 190 帧, 检测耗时: 0.231s, 实际帧间隔: 1.023s
2025-11-15 17:42:19,027 - src.detection_engine - ERROR - 保存检测结果失败: [Errno 2] No such file or directory: 'results/2025-11-15/scene_scene_12453_31011500001320000001/17-42-19-021_frame_192'
2025-11-15 17:42:26,420 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 200 帧, 检测耗时: 0.241s, 实际帧间隔: 1.042s
2025-11-15 17:42:36,589 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 210 帧, 检测耗时: 0.227s, 实际帧间隔: 1.024s
2025-11-15 17:42:38,637 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-42-38-548_frame_211/annotated.png
2025-11-15 17:42:38,638 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.83
2025-11-15 17:42:46,924 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 220 帧, 检测耗时: 0.228s, 实际帧间隔: 1.030s
2025-11-15 17:42:57,040 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 230 帧, 检测耗时: 0.226s, 实际帧间隔: 1.012s
2025-11-15 17:43:07,273 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 240 帧, 检测耗时: 0.224s, 实际帧间隔: 1.027s
2025-11-15 17:43:09,337 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-43-09-245_frame_241/annotated.png
2025-11-15 17:43:09,338 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.90
2025-11-15 17:43:09,338 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.90
2025-11-15 17:43:09,339 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.90 | 级别: high | 连续帧数: 30
2025-11-15 17:43:09,343 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 17:43:09,359 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763199789.png
2025-11-15 17:43:09,359 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763199789.png
2025-11-15 17:43:09,364 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 17:43:09,364 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 17:43:17,488 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 250 帧, 检测耗时: 0.232s, 实际帧间隔: 1.019s
2025-11-15 17:43:27,754 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 260 帧, 检测耗时: 0.226s, 实际帧间隔: 1.026s
2025-11-15 17:43:37,933 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 270 帧, 检测耗时: 0.224s, 实际帧间隔: 1.021s
2025-11-15 17:43:39,993 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-43-39-903_frame_271/annotated.png
2025-11-15 17:43:39,993 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.91
2025-11-15 17:43:48,172 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 280 帧, 检测耗时: 0.224s, 实际帧间隔: 1.021s
2025-11-15 17:43:58,349 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 290 帧, 检测耗时: 0.234s, 实际帧间隔: 1.020s
2025-11-15 17:44:08,523 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 300 帧, 检测耗时: 0.223s, 实际帧间隔: 1.028s
2025-11-15 17:44:18,664 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 310 帧, 检测耗时: 0.225s, 实际帧间隔: 1.012s
2025-11-15 17:44:28,880 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 320 帧, 检测耗时: 0.227s, 实际帧间隔: 1.023s
2025-11-15 17:44:39,117 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 330 帧, 检测耗时: 0.227s, 实际帧间隔: 1.024s
2025-11-15 17:44:49,362 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 340 帧, 检测耗时: 0.228s, 实际帧间隔: 1.022s
2025-11-15 17:44:58,613 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-44-58-508_frame_348/annotated.png
2025-11-15 17:44:58,613 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.92
2025-11-15 17:44:59,926 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 350 帧, 检测耗时: 0.331s, 实际帧间隔: 1.022s
2025-11-15 17:45:09,923 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 360 帧, 检测耗时: 0.234s, 实际帧间隔: 1.022s
2025-11-15 17:45:20,308 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 370 帧, 检测耗时: 0.315s, 实际帧间隔: 1.024s
2025-11-15 17:45:30,374 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 380 帧, 检测耗时: 0.227s, 实际帧间隔: 1.035s
2025-11-15 17:45:40,617 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 390 帧, 检测耗时: 0.224s, 实际帧间隔: 1.021s
2025-11-15 17:45:50,770 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 400 帧, 检测耗时: 0.225s, 实际帧间隔: 1.015s
2025-11-15 17:46:00,991 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 410 帧, 检测耗时: 0.224s, 实际帧间隔: 1.022s
2025-11-15 17:46:11,143 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 420 帧, 检测耗时: 0.223s, 实际帧间隔: 1.020s
2025-11-15 17:46:21,417 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 430 帧, 检测耗时: 0.227s, 实际帧间隔: 1.026s
2025-11-15 17:46:31,617 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 440 帧, 检测耗时: 0.228s, 实际帧间隔: 1.021s
2025-11-15 17:46:41,923 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 450 帧, 检测耗时: 0.219s, 实际帧间隔: 1.029s
2025-11-15 17:46:52,167 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 460 帧, 检测耗时: 0.230s, 实际帧间隔: 1.025s
2025-11-15 17:47:02,398 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 470 帧, 检测耗时: 0.224s, 实际帧间隔: 1.024s
2025-11-15 17:47:08,626 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-47-08-523_frame_475/annotated.png
2025-11-15 17:47:08,626 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-15 17:47:08,627 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.93
2025-11-15 17:47:08,627 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.93 | 级别: high | 连续帧数: 3
2025-11-15 17:47:08,631 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 17:47:08,647 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200028.png
2025-11-15 17:47:08,647 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200028.png
2025-11-15 17:47:08,653 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 17:47:08,653 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 17:47:12,760 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 480 帧, 检测耗时: 0.232s, 实际帧间隔: 1.020s
2025-11-15 17:47:22,964 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 490 帧, 检测耗时: 0.238s, 实际帧间隔: 1.025s
2025-11-15 17:47:33,167 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 500 帧, 检测耗时: 0.236s, 实际帧间隔: 1.017s
2025-11-15 17:47:39,275 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-47-39-172_frame_505/annotated.png
2025-11-15 17:47:39,275 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.92
2025-11-15 17:47:43,371 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 510 帧, 检测耗时: 0.203s, 实际帧间隔: 1.025s
2025-11-15 17:47:53,613 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 520 帧, 检测耗时: 0.230s, 实际帧间隔: 1.017s
2025-11-15 17:48:03,802 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 530 帧, 检测耗时: 0.229s, 实际帧间隔: 1.024s
2025-11-15 17:48:09,958 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-48-09-860_frame_535/annotated.png
2025-11-15 17:48:09,959 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-15 17:48:13,942 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 540 帧, 检测耗时: 0.217s, 实际帧间隔: 1.018s
2025-11-15 17:48:24,363 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 550 帧, 检测耗时: 0.279s, 实际帧间隔: 1.029s
2025-11-15 17:48:34,417 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 560 帧, 检测耗时: 0.224s, 实际帧间隔: 1.016s
2025-11-15 17:48:41,662 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-48-41-560_frame_566/annotated.png
2025-11-15 17:48:41,663 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.90
2025-11-15 17:48:41,663 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.90
2025-11-15 17:48:41,663 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.90 | 级别: high | 连续帧数: 3
2025-11-15 17:48:41,666 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 17:48:41,681 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200121.png
2025-11-15 17:48:41,682 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200121.png
2025-11-15 17:48:41,690 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 17:48:41,691 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 17:48:44,706 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 570 帧, 检测耗时: 0.228s, 实际帧间隔: 1.024s
2025-11-15 17:48:54,842 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 580 帧, 检测耗时: 0.224s, 实际帧间隔: 1.018s
2025-11-15 17:49:05,145 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 590 帧, 检测耗时: 0.227s, 实际帧间隔: 1.030s
2025-11-15 17:49:12,298 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-49-12-200_frame_596/annotated.png
2025-11-15 17:49:12,298 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-15 17:49:15,345 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 600 帧, 检测耗时: 0.225s, 实际帧间隔: 1.021s
2025-11-15 17:49:25,619 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 610 帧, 检测耗时: 0.220s, 实际帧间隔: 1.022s
2025-11-15 17:49:35,818 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 620 帧, 检测耗时: 0.232s, 实际帧间隔: 1.019s
2025-11-15 17:49:43,213 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-49-43-086_frame_626/annotated.png
2025-11-15 17:49:43,214 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.91
2025-11-15 17:49:46,236 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 630 帧, 检测耗时: 0.229s, 实际帧间隔: 1.044s
2025-11-15 17:49:56,437 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 640 帧, 检测耗时: 0.256s, 实际帧间隔: 1.018s
2025-11-15 17:50:06,636 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 650 帧, 检测耗时: 0.267s, 实际帧间隔: 1.018s
2025-11-15 17:50:14,245 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-50-14-112_frame_654/annotated.png
2025-11-15 17:50:14,247 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.91
2025-11-15 17:50:14,247 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.91
2025-11-15 17:50:14,249 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.91 | 级别: high | 连续帧数: 28
2025-11-15 17:50:14,260 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 17:50:14,355 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200214.png
2025-11-15 17:50:14,356 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200214.png
2025-11-15 17:50:14,403 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 17:50:14,405 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 17:50:19,090 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 660 帧, 检测耗时: 0.253s, 实际帧间隔: 1.248s
2025-11-15 17:50:29,223 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 670 帧, 检测耗时: 0.255s, 实际帧间隔: 1.012s
2025-11-15 17:50:39,298 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 680 帧, 检测耗时: 0.300s, 实际帧间隔: 1.015s
2025-11-15 17:50:44,492 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-50-44-383_frame_684/annotated.png
2025-11-15 17:50:44,493 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.81
2025-11-15 17:50:49,563 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 690 帧, 检测耗时: 0.247s, 实际帧间隔: 1.028s
2025-11-15 17:50:59,857 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 700 帧, 检测耗时: 0.221s, 实际帧间隔: 1.024s
2025-11-15 17:51:10,252 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 710 帧, 检测耗时: 0.280s, 实际帧间隔: 1.036s
2025-11-15 17:51:15,635 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-51-15-500_frame_714/annotated.png
2025-11-15 17:51:15,636 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-15 17:51:20,703 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 720 帧, 检测耗时: 0.263s, 实际帧间隔: 1.032s
2025-11-15 17:51:31,056 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 730 帧, 检测耗时: 0.315s, 实际帧间隔: 1.033s
2025-11-15 17:51:41,441 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 740 帧, 检测耗时: 0.270s, 实际帧间隔: 1.051s
2025-11-15 17:51:46,537 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-51-46-422_frame_744/annotated.png
2025-11-15 17:51:46,538 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.95
2025-11-15 17:51:46,538 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.95
2025-11-15 17:51:46,539 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.95 | 级别: high | 连续帧数: 30
2025-11-15 17:51:46,543 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 17:51:46,632 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200306.png
2025-11-15 17:51:46,633 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200306.png
2025-11-15 17:51:46,641 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 17:51:46,641 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 17:51:51,569 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 750 帧, 检测耗时: 0.228s, 实际帧间隔: 1.018s
2025-11-15 17:52:02,244 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 760 帧, 检测耗时: 0.259s, 实际帧间隔: 1.061s
2025-11-15 17:52:12,787 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 770 帧, 检测耗时: 0.298s, 实际帧间隔: 1.048s
2025-11-15 17:52:16,795 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-52-16-677_frame_773/annotated.png
2025-11-15 17:52:16,797 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.95
2025-11-15 17:52:22,900 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 780 帧, 检测耗时: 0.245s, 实际帧间隔: 1.022s
2025-11-15 17:52:36,728 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 790 帧, 检测耗时: 0.278s, 实际帧间隔: 1.375s
2025-11-15 17:52:46,824 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-52-46-703_frame_799/annotated.png
2025-11-15 17:52:46,825 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.91
2025-11-15 17:52:46,825 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 800 帧, 检测耗时: 0.277s, 实际帧间隔: 1.013s
2025-11-15 17:52:56,980 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 810 帧, 检测耗时: 0.222s, 实际帧间隔: 1.022s
2025-11-15 17:53:07,973 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 820 帧, 检测耗时: 0.315s, 实际帧间隔: 1.082s
2025-11-15 17:53:18,149 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 830 帧, 检测耗时: 0.255s, 实际帧间隔: 1.033s
2025-11-15 17:53:20,200 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-53-20-073_frame_831/annotated.png
2025-11-15 17:53:20,200 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.94
2025-11-15 17:53:20,200 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.94
2025-11-15 17:53:20,201 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.94 | 级别: high | 连续帧数: 3
2025-11-15 17:53:20,204 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 17:53:20,284 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200400.png
2025-11-15 17:53:20,285 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200400.png
2025-11-15 17:53:20,291 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 17:53:20,291 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 17:53:28,273 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 840 帧, 检测耗时: 0.231s, 实际帧间隔: 1.017s
2025-11-15 17:53:39,071 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 850 帧, 检测耗时: 0.227s, 实际帧间隔: 1.023s
2025-11-15 17:53:48,814 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 860 帧, 检测耗时: 0.287s, 实际帧间隔: 1.023s
2025-11-15 17:53:51,273 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-53-50-994_frame_861/annotated.png
2025-11-15 17:53:51,278 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.91
2025-11-15 17:53:59,196 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 870 帧, 检测耗时: 0.245s, 实际帧间隔: 1.041s
2025-11-15 17:54:09,428 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 880 帧, 检测耗时: 0.282s, 实际帧间隔: 1.021s
2025-11-15 17:54:19,556 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 890 帧, 检测耗时: 0.240s, 实际帧间隔: 1.018s
2025-11-15 17:54:21,667 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-54-21-533_frame_891/annotated.png
2025-11-15 17:54:21,667 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.91
2025-11-15 17:54:29,733 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 900 帧, 检测耗时: 0.221s, 实际帧间隔: 1.018s
2025-11-15 17:54:40,094 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 910 帧, 检测耗时: 0.245s, 实际帧间隔: 1.034s
2025-11-15 17:54:50,330 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 920 帧, 检测耗时: 0.291s, 实际帧间隔: 1.017s
2025-11-15 17:54:52,406 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-54-52-266_frame_921/annotated.png
2025-11-15 17:54:52,408 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.87
2025-11-15 17:54:52,408 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.87
2025-11-15 17:54:52,409 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.87 | 级别: high | 连续帧数: 30
2025-11-15 17:54:52,414 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 17:54:52,497 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200492.png
2025-11-15 17:54:52,498 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200492.png
2025-11-15 17:54:52,507 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 17:54:52,507 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 17:55:00,487 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 930 帧, 检测耗时: 0.244s, 实际帧间隔: 1.021s
2025-11-15 17:55:10,992 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 940 帧, 检测耗时: 0.243s, 实际帧间隔: 1.053s
2025-11-15 17:55:21,495 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 950 帧, 检测耗时: 0.308s, 实际帧间隔: 1.040s
2025-11-15 17:55:22,470 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-55-22-347_frame_950/annotated.png
2025-11-15 17:55:22,470 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.91
2025-11-15 17:55:32,256 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 960 帧, 检测耗时: 0.328s, 实际帧间隔: 1.049s
2025-11-15 17:55:42,856 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 970 帧, 检测耗时: 0.983s, 实际帧间隔: 1.023s
2025-11-15 17:55:52,488 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-55-52-371_frame_979/annotated.png
2025-11-15 17:55:52,489 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.87
2025-11-15 17:55:52,489 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 980 帧, 检测耗时: 0.254s, 实际帧间隔: 1.034s
2025-11-15 17:56:03,259 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 990 帧, 检测耗时: 0.411s, 实际帧间隔: 1.054s
2025-11-15 17:56:13,200 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1000 帧, 检测耗时: 0.224s, 实际帧间隔: 1.023s
2025-11-15 17:56:24,566 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-56-22-809_frame_1008/annotated.png
2025-11-15 17:56:24,581 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.86
2025-11-15 17:56:24,587 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.86
2025-11-15 17:56:24,600 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.86 | 级别: high | 连续帧数: 29
2025-11-15 17:56:24,664 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 17:56:25,123 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200585.png
2025-11-15 17:56:25,129 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200585.png
2025-11-15 17:56:25,218 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 17:56:25,222 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 17:56:28,295 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1010 帧, 检测耗时: 3.087s, 实际帧间隔: 1.175s
2025-11-15 17:56:37,870 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1020 帧, 检测耗时: 0.241s, 实际帧间隔: 1.289s
2025-11-15 17:56:48,427 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1030 帧, 检测耗时: 0.231s, 实际帧间隔: 1.056s
2025-11-15 17:56:53,593 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-56-53-447_frame_1034/annotated.png
2025-11-15 17:56:53,593 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.87
2025-11-15 17:56:58,639 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1040 帧, 检测耗时: 0.257s, 实际帧间隔: 1.016s
2025-11-15 17:57:09,082 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1050 帧, 检测耗时: 0.514s, 实际帧间隔: 1.023s
2025-11-15 17:57:19,038 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1060 帧, 检测耗时: 0.227s, 实际帧间隔: 1.025s
2025-11-15 17:57:24,162 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-57-24-049_frame_1064/annotated.png
2025-11-15 17:57:24,162 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-15 17:57:30,022 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1070 帧, 检测耗时: 0.274s, 实际帧间隔: 1.088s
2025-11-15 17:57:41,016 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1080 帧, 检测耗时: 0.264s, 实际帧间隔: 1.026s
2025-11-15 17:57:50,569 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1090 帧, 检测耗时: 0.238s, 实际帧间隔: 1.036s
2025-11-15 17:57:55,183 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-57-55-036_frame_1093/annotated.png
2025-11-15 17:57:55,184 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.91
2025-11-15 17:58:01,392 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1100 帧, 检测耗时: 0.351s, 实际帧间隔: 1.065s
2025-11-15 17:58:12,385 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1110 帧, 检测耗时: 0.394s, 实际帧间隔: 1.099s
2025-11-15 17:58:22,390 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1120 帧, 检测耗时: 0.224s, 实际帧间隔: 1.022s
2025-11-15 17:58:25,588 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-58-25-367_frame_1122/annotated.png
2025-11-15 17:58:25,592 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.92
2025-11-15 17:58:25,593 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.92
2025-11-15 17:58:25,594 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.92 | 级别: high | 连续帧数: 29
2025-11-15 17:58:25,596 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 17:58:25,657 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200705.png
2025-11-15 17:58:25,658 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200705.png
2025-11-15 17:58:25,684 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 17:58:25,687 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 17:58:33,216 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1130 帧, 检测耗时: 0.272s, 实际帧间隔: 1.070s
2025-11-15 17:58:43,586 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1140 帧, 检测耗时: 0.401s, 实际帧间隔: 1.021s
2025-11-15 17:58:53,825 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1150 帧, 检测耗时: 0.248s, 实际帧间隔: 1.051s
2025-11-15 17:58:56,673 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-58-56-008_frame_1151/annotated.png
2025-11-15 17:58:56,681 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-15 17:59:07,320 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1160 帧, 检测耗时: 2.130s, 实际帧间隔: 1.038s
2025-11-15 17:59:19,640 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1170 帧, 检测耗时: 0.295s, 实际帧间隔: 1.502s
2025-11-15 17:59:27,023 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-59-26-534_frame_1176/annotated.png
2025-11-15 17:59:27,073 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.94
2025-11-15 17:59:30,999 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1180 帧, 检测耗时: 0.352s, 实际帧间隔: 1.155s
2025-11-15 17:59:41,524 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1190 帧, 检测耗时: 0.403s, 实际帧间隔: 1.029s
2025-11-15 17:59:51,555 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1200 帧, 检测耗时: 0.232s, 实际帧间隔: 1.046s
2025-11-15 17:59:57,082 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/17-59-56-697_frame_1204/annotated.png
2025-11-15 17:59:57,084 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.91
2025-11-15 17:59:57,084 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.91
2025-11-15 17:59:57,087 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.91 | 级别: high | 连续帧数: 28
2025-11-15 17:59:57,098 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 17:59:57,247 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200797.png
2025-11-15 17:59:57,249 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200797.png
2025-11-15 17:59:57,266 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 17:59:57,269 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 18:00:01,936 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1210 帧, 检测耗时: 0.244s, 实际帧间隔: 1.036s
2025-11-15 18:00:12,296 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1220 帧, 检测耗时: 0.325s, 实际帧间隔: 1.028s
2025-11-15 18:00:23,061 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1230 帧, 检测耗时: 0.290s, 实际帧间隔: 1.054s
2025-11-15 18:00:27,330 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-00-27-143_frame_1233/annotated.png
2025-11-15 18:00:27,331 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.87
2025-11-15 18:00:34,046 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1240 帧, 检测耗时: 0.262s, 实际帧间隔: 1.122s
2025-11-15 18:00:44,368 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1250 帧, 检测耗时: 0.293s, 实际帧间隔: 1.035s
2025-11-15 18:00:54,419 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1260 帧, 检测耗时: 0.219s, 实际帧间隔: 1.014s
2025-11-15 18:00:57,978 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-00-57-821_frame_1262/annotated.png
2025-11-15 18:00:57,979 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.94
2025-11-15 18:01:04,760 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1270 帧, 检测耗时: 0.235s, 实际帧间隔: 1.035s
2025-11-15 18:01:14,979 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1280 帧, 检测耗时: 0.244s, 实际帧间隔: 1.017s
2025-11-15 18:01:25,232 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1290 帧, 检测耗时: 0.263s, 实际帧间隔: 1.027s
2025-11-15 18:01:29,039 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-01-28-221_frame_1292/annotated.png
2025-11-15 18:01:29,043 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.91
2025-11-15 18:01:29,044 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.91
2025-11-15 18:01:29,053 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.91 | 级别: high | 连续帧数: 30
2025-11-15 18:01:29,083 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 18:01:29,189 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200889.png
2025-11-15 18:01:29,192 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763200889.png
2025-11-15 18:01:29,210 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 18:01:29,210 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 18:01:35,540 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1300 帧, 检测耗时: 0.222s, 实际帧间隔: 1.034s
2025-11-15 18:01:46,445 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1310 帧, 检测耗时: 0.442s, 实际帧间隔: 1.063s
2025-11-15 18:01:56,388 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1320 帧, 检测耗时: 0.228s, 实际帧间隔: 1.025s
2025-11-15 18:01:58,444 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-01-58-326_frame_1321/annotated.png
2025-11-15 18:01:58,445 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.95
2025-11-15 18:02:06,545 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1330 帧, 检测耗时: 0.293s, 实际帧间隔: 1.020s
2025-11-15 18:02:16,702 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1340 帧, 检测耗时: 0.227s, 实际帧间隔: 1.020s
2025-11-15 18:02:26,909 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1350 帧, 检测耗时: 0.230s, 实际帧间隔: 1.020s
2025-11-15 18:02:37,282 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1360 帧, 检测耗时: 0.231s, 实际帧间隔: 1.039s
2025-11-15 18:02:47,504 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1370 帧, 检测耗时: 0.227s, 实际帧间隔: 1.019s
2025-11-15 18:03:00,944 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1380 帧, 检测耗时: 0.217s, 实际帧间隔: 1.345s
2025-11-15 18:03:11,226 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1390 帧, 检测耗时: 0.217s, 实际帧间隔: 1.028s
2025-11-15 18:03:21,487 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1400 帧, 检测耗时: 0.232s, 实际帧间隔: 1.017s
2025-11-15 18:03:23,566 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-03-23-465_frame_1401/annotated.png
2025-11-15 18:03:23,567 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-15 18:03:32,432 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1410 帧, 检测耗时: 0.294s, 实际帧间隔: 1.079s
2025-11-15 18:03:42,473 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1420 帧, 检测耗时: 0.311s, 实际帧间隔: 1.022s
2025-11-15 18:03:52,796 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1430 帧, 检测耗时: 0.389s, 实际帧间隔: 1.024s
2025-11-15 18:04:02,950 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1440 帧, 检测耗时: 0.313s, 实际帧间隔: 1.022s
2025-11-15 18:04:13,038 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1450 帧, 检测耗时: 0.238s, 实际帧间隔: 1.016s
2025-11-15 18:04:23,455 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1460 帧, 检测耗时: 0.233s, 实际帧间隔: 1.039s
2025-11-15 18:04:31,732 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-04-31-614_frame_1467/annotated.png
2025-11-15 18:04:31,733 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.85
2025-11-15 18:04:33,743 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1470 帧, 检测耗时: 0.242s, 实际帧间隔: 1.021s
2025-11-15 18:04:44,348 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1480 帧, 检测耗时: 0.549s, 实际帧间隔: 1.022s
2025-11-15 18:04:54,318 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1490 帧, 检测耗时: 0.238s, 实际帧间隔: 1.034s
2025-11-15 18:05:03,532 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-05-03-412_frame_1498/annotated.png
2025-11-15 18:05:03,534 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=medium, 目标=head, 置信度=0.66
2025-11-15 18:05:03,535 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.66
2025-11-15 18:05:03,536 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.66 | 级别: medium | 连续帧数: 3
2025-11-15 18:05:03,543 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 18:05:03,643 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763201103.png
2025-11-15 18:05:03,646 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763201103.png
2025-11-15 18:05:03,663 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 18:05:03,665 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 18:05:05,687 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1500 帧, 检测耗时: 1.211s, 实际帧间隔: 1.024s
2025-11-15 18:05:16,472 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1510 帧, 检测耗时: 0.279s, 实际帧间隔: 1.178s
2025-11-15 18:05:26,447 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1520 帧, 检测耗时: 0.235s, 实际帧间隔: 1.012s
2025-11-15 18:05:33,997 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-05-33-860_frame_1526/annotated.png
2025-11-15 18:05:33,998 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.83
2025-11-15 18:05:37,057 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1530 帧, 检测耗时: 0.281s, 实际帧间隔: 1.058s
2025-11-15 18:05:47,253 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1540 帧, 检测耗时: 0.230s, 实际帧间隔: 1.024s
2025-11-15 18:05:57,496 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1550 帧, 检测耗时: 0.235s, 实际帧间隔: 1.025s
2025-11-15 18:06:04,636 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-06-04-538_frame_1556/annotated.png
2025-11-15 18:06:04,637 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.91
2025-11-15 18:06:07,731 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1560 帧, 检测耗时: 0.239s, 实际帧间隔: 1.020s
2025-11-15 18:06:18,591 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1570 帧, 检测耗时: 0.313s, 实际帧间隔: 1.022s
2025-11-15 18:06:28,306 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1580 帧, 检测耗时: 0.268s, 实际帧间隔: 1.019s
2025-11-15 18:06:34,884 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-06-34-772_frame_1585/annotated.png
2025-11-15 18:06:34,885 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-15 18:06:34,885 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.93
2025-11-15 18:06:34,886 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.93 | 级别: high | 连续帧数: 24
2025-11-15 18:06:34,890 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 18:06:34,953 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763201194.png
2025-11-15 18:06:34,955 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763201194.png
2025-11-15 18:06:34,965 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 18:06:34,966 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 18:06:39,125 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1590 帧, 检测耗时: 0.298s, 实际帧间隔: 1.082s
2025-11-15 18:06:49,368 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1600 帧, 检测耗时: 0.299s, 实际帧间隔: 1.033s
2025-11-15 18:06:59,610 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1610 帧, 检测耗时: 0.298s, 实际帧间隔: 1.022s
2025-11-15 18:07:05,751 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-07-05-628_frame_1615/annotated.png
2025-11-15 18:07:05,752 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.91
2025-11-15 18:07:09,777 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1620 帧, 检测耗时: 0.223s, 实际帧间隔: 1.030s
2025-11-15 18:07:20,260 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1630 帧, 检测耗时: 0.429s, 实际帧间隔: 1.013s
2025-11-15 18:07:32,190 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1640 帧, 检测耗时: 0.524s, 实际帧间隔: 1.131s
2025-11-15 18:07:36,293 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-07-36-110_frame_1643/annotated.png
2025-11-15 18:07:36,294 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.83
2025-11-15 18:07:42,004 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1650 帧, 检测耗时: 0.231s, 实际帧间隔: 1.079s
2025-11-15 18:07:52,407 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1660 帧, 检测耗时: 0.303s, 实际帧间隔: 1.027s
2025-11-15 18:08:02,915 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1670 帧, 检测耗时: 0.231s, 实际帧间隔: 1.065s
2025-11-15 18:08:06,962 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-08-06-876_frame_1673/annotated.png
2025-11-15 18:08:06,962 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.92
2025-11-15 18:08:06,962 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.92
2025-11-15 18:08:06,963 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.92 | 级别: high | 连续帧数: 30
2025-11-15 18:08:06,964 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 18:08:06,982 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763201286.png
2025-11-15 18:08:06,982 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763201286.png
2025-11-15 18:08:06,987 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 18:08:06,988 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 18:08:13,136 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1680 帧, 检测耗时: 0.230s, 实际帧间隔: 1.020s
2025-11-15 18:08:23,348 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1690 帧, 检测耗时: 0.221s, 实际帧间隔: 1.024s
2025-11-15 18:08:33,799 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1700 帧, 检测耗时: 0.377s, 实际帧间隔: 1.022s
2025-11-15 18:08:37,710 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-08-37-571_frame_1703/annotated.png
2025-11-15 18:08:37,711 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.88
2025-11-15 18:08:44,567 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1710 帧, 检测耗时: 0.366s, 实际帧间隔: 1.018s
2025-11-15 18:08:54,448 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1720 帧, 检测耗时: 0.336s, 实际帧间隔: 1.053s
2025-11-15 18:09:04,951 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1730 帧, 检测耗时: 0.290s, 实际帧间隔: 1.055s
2025-11-15 18:09:09,433 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-09-09-311_frame_1733/annotated.png
2025-11-15 18:09:09,434 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.87
2025-11-15 18:09:15,181 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1740 帧, 检测耗时: 0.333s, 实际帧间隔: 1.017s
2025-11-15 18:09:25,398 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1750 帧, 检测耗时: 0.301s, 实际帧间隔: 1.025s
2025-11-15 18:09:35,622 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1760 帧, 检测耗时: 0.262s, 实际帧间隔: 1.031s
2025-11-15 18:09:39,678 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-09-39-555_frame_1763/annotated.png
2025-11-15 18:09:39,679 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.95
2025-11-15 18:09:39,679 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.95
2025-11-15 18:09:39,679 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.95 | 级别: high | 连续帧数: 8
2025-11-15 18:09:39,684 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 18:09:39,732 - src.device_platform_client - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763201379.png
2025-11-15 18:09:39,733 - src.alarm_system - INFO - 图片上传成功: /alarm/images/2025-11-15/unknown_1763201379.png
2025-11-15 18:09:39,740 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 18:09:39,740 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 18:09:45,889 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1770 帧, 检测耗时: 0.284s, 实际帧间隔: 1.023s
2025-11-15 18:09:57,737 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1780 帧, 检测耗时: 0.245s, 实际帧间隔: 1.061s
2025-11-15 18:10:09,208 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1790 帧, 检测耗时: 0.757s, 实际帧间隔: 1.212s
2025-11-15 18:10:10,778 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-10-10-655_frame_1791/annotated.png
2025-11-15 18:10:10,778 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.90
2025-11-15 18:10:19,864 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1800 帧, 检测耗时: 1.008s, 实际帧间隔: 1.049s
2025-11-15 18:10:31,298 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1810 帧, 检测耗时: 0.538s, 实际帧间隔: 1.185s
2025-11-15 18:10:34,792 - src.device_platform_client - ERROR - 设备 31011500001320000001 心跳异常: HTTPConnectionPool(host='host.docker.internal', port=8081): Max retries exceeded with url: /device/heartBeat (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff53f4a260>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-11-15 18:10:41,513 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-10-41-395_frame_1819/annotated.png
2025-11-15 18:10:41,514 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-15 18:10:41,514 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1820 帧, 检测耗时: 0.268s, 实际帧间隔: 1.059s
2025-11-15 18:10:45,503 - src.device_platform_client - ERROR - 设备 31011500001320000001 心跳异常: HTTPConnectionPool(host='host.docker.internal', port=8081): Max retries exceeded with url: /device/heartBeat (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff53f4a6e0>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-11-15 18:10:53,074 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1830 帧, 检测耗时: 1.003s, 实际帧间隔: 1.078s
2025-11-15 18:11:03,289 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1840 帧, 检测耗时: 0.334s, 实际帧间隔: 1.088s
2025-11-15 18:11:11,977 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-11-11-793_frame_1846/annotated.png
2025-11-15 18:11:11,979 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.88
2025-11-15 18:11:11,980 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.88
2025-11-15 18:11:11,982 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.88 | 级别: high | 连续帧数: 27
2025-11-15 18:11:11,987 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 18:11:12,076 - src.device_platform_client - INFO - 图片上传成功: http://host.docker.internal:8081/alarm/images/2025-11-15/unknown_1763201472.png
2025-11-15 18:11:12,077 - src.alarm_system - INFO - 图片上传成功: http://host.docker.internal:8081/alarm/images/2025-11-15/unknown_1763201472.png
2025-11-15 18:11:12,108 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 18:11:12,112 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 18:11:15,070 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1850 帧, 检测耗时: 0.501s, 实际帧间隔: 1.161s
2025-11-15 18:11:25,215 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1860 帧, 检测耗时: 0.427s, 实际帧间隔: 1.019s
2025-11-15 18:11:35,262 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1870 帧, 检测耗时: 0.253s, 实际帧间隔: 1.021s
2025-11-15 18:11:42,330 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-11-42-201_frame_1876/annotated.png
2025-11-15 18:11:42,331 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-15 18:11:45,324 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1880 帧, 检测耗时: 0.233s, 实际帧间隔: 1.020s
2025-11-15 18:11:55,854 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1890 帧, 检测耗时: 0.317s, 实际帧间隔: 1.037s
2025-11-15 18:12:06,309 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1900 帧, 检测耗时: 0.243s, 实际帧间隔: 1.058s
2025-11-15 18:12:12,402 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-12-12-301_frame_1905/annotated.png
2025-11-15 18:12:12,403 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.90
2025-11-15 18:12:16,530 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1910 帧, 检测耗时: 0.234s, 实际帧间隔: 1.023s
2025-11-15 18:12:26,599 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1920 帧, 检测耗时: 0.231s, 实际帧间隔: 1.022s
2025-11-15 18:12:36,872 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1930 帧, 检测耗时: 0.353s, 实际帧间隔: 1.014s
2025-11-15 18:12:46,092 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-12-45-992_frame_1938/annotated.png
2025-11-15 18:12:46,093 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.77
2025-11-15 18:12:46,093 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.77
2025-11-15 18:12:46,094 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.77 | 级别: high | 连续帧数: 3
2025-11-15 18:12:46,095 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 18:12:46,121 - src.device_platform_client - INFO - 图片上传成功: http://host.docker.internal:8081/alarm/images/2025-11-15/unknown_1763201566.png
2025-11-15 18:12:46,121 - src.alarm_system - INFO - 图片上传成功: http://host.docker.internal:8081/alarm/images/2025-11-15/unknown_1763201566.png
2025-11-15 18:12:46,126 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 18:12:46,126 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 18:12:47,149 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1940 帧, 检测耗时: 0.246s, 实际帧间隔: 1.030s
2025-11-15 18:12:57,444 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1950 帧, 检测耗时: 0.237s, 实际帧间隔: 1.023s
2025-11-15 18:13:07,596 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1960 帧, 检测耗时: 0.226s, 实际帧间隔: 1.021s
2025-11-15 18:13:16,794 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-13-16-701_frame_1968/annotated.png
2025-11-15 18:13:16,794 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.87
2025-11-15 18:13:17,760 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1970 帧, 检测耗时: 0.226s, 实际帧间隔: 1.019s
2025-11-15 18:13:27,989 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 1980 帧, 检测耗时: 0.245s, 实际帧间隔: 1.014s
2025-11-15 18:13:28,091 - __main__ - INFO - 接收到信号 15，正在关闭系统...
2025-11-15 18:13:28,092 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-15 18:13:28,094 - src.api_server - INFO - 正在停止API服务器...
2025-11-15 18:17:55,973 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-15 18:17:55,973 - src.config_manager - INFO - 重新加载配置文件
2025-11-15 18:17:55,980 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-15 18:17:55,980 - __main__ - INFO - 正在初始化系统组件...
2025-11-15 18:17:55,980 - __main__ - INFO - 预加载AI模型...
2025-11-15 18:17:55,980 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-15 18:17:56,031 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 18:17:56,032 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-15 18:17:56,125 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: cpu
2025-11-15 18:17:56,126 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-15 18:17:56,209 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 18:17:56,209 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 18:17:56,453 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: cpu
2025-11-15 18:17:56,454 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-15 18:17:56,514 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 18:17:56,514 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-15 18:17:56,514 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-15 18:17:56,514 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-15 18:17:56,514 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-15 18:17:56,514 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-15 18:17:56,515 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 18:17:56,515 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-15 18:17:56,515 - __main__ - INFO - 初始化检测引擎...
2025-11-15 18:17:56,515 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 18:17:56,742 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-15 18:17:56,742 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8081
2025-11-15 18:17:56,742 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-15 18:17:56,742 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-15 18:17:56,743 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-15 18:17:56,743 - __main__ - INFO - 初始化流管理器...
2025-11-15 18:17:56,743 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-15 18:17:56,743 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 18:17:56,743 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-15 18:17:56,744 - src.stream_manager - INFO - 流监控线程启动
2025-11-15 18:17:56,744 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-15 18:17:56,744 - __main__ - INFO - 初始化场景管理组件...
2025-11-15 18:17:56,744 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-15 18:17:56,744 - src.device_platform_client - INFO - 设备平台客户端初始化: http://host.docker.internal:8081
2025-11-15 18:17:56,744 - __main__ - INFO - 初始化报警系统...
2025-11-15 18:17:56,744 - src.kafka_publisher - INFO - 初始化Kafka生产者: host.docker.internal:9092, topic: event-alarm
2025-11-15 18:17:56,747 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 18:17:56,747 - kafka.conn - INFO - Probing node bootstrap-0 broker version
2025-11-15 18:17:56,748 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 18:17:56,748 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 18:17:56,795 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 18:17:56,797 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 18:17:56,797 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 18:17:56,797 - src.kafka_publisher - ERROR - Kafka生产者初始化失败: NoBrokersAvailable
2025-11-15 18:17:56,797 - src.alarm_system - INFO - Kafka推送器初始化成功
2025-11-15 18:17:56,797 - src.alarm_system - INFO - 告警通知方式: http, 格式: v2 (sceneId, deviceGbCode, alarmTime, path)
2025-11-15 18:17:56,799 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-15 18:17:56,799 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-15 18:17:56,799 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-15 18:17:56,799 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-15 18:17:56,800 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-15 18:17:56,800 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-15 18:17:56,800 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 18:17:56,800 - __main__ - INFO - 初始化API服务器...
2025-11-15 18:17:56,802 - src.api_server - INFO - API服务器初始化完成
2025-11-15 18:17:56,802 - __main__ - INFO - 系统组件初始化完成
2025-11-15 18:17:56,802 - __main__ - INFO - 启动实时视频检测系统...
2025-11-15 18:17:56,803 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-15 18:17:56,804 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-15 18:18:03,533 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001"}], "sceneId": 12453, "algorithmCode": "安全帽检测", "type": "3", "start": "00:00:00", "end": "23:59:59", "strategyTime": 15, "strategyCount": 10}
2025-11-15 18:18:03,534 - src.scene_manager - INFO - 开始部署场景v2: sceneId=12453, algorithmCode=安全帽检测, type=3
2025-11-15 18:18:03,534 - src.scene_manager - INFO - Type 3: 每日时间段=00:00:00-23:59:59, 永久有效
2025-11-15 18:18:03,534 - src.scene_manager - INFO - 开始部署场景: scene_12453, 算法: 安全帽检测, 设备数: 1, 时间类型: 3
2025-11-15 18:18:03,534 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-15 18:18:03,534 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 18:18:03,539 - src.device_platform_client - ERROR - 获取播放地址请求失败: HTTPConnectionPool(host='host.docker.internal', port=8081): Max retries exceeded with url: /device/getPlayUrl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff4716b5b0>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-11-15 18:18:04,544 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 2/3)
2025-11-15 18:18:04,555 - src.device_platform_client - ERROR - 获取播放地址请求失败: HTTPConnectionPool(host='host.docker.internal', port=8081): Max retries exceeded with url: /device/getPlayUrl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff47061ea0>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-11-15 18:18:05,561 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 3/3)
2025-11-15 18:18:05,569 - src.device_platform_client - ERROR - 获取播放地址请求失败: HTTPConnectionPool(host='host.docker.internal', port=8081): Max retries exceeded with url: /device/getPlayUrl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff47060880>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-11-15 18:18:05,569 - src.device_platform_client - ERROR - 获取设备 31011500001320000001 播放地址失败，已重试3次
2025-11-15 18:18:05,569 - src.scene_manager - INFO - 场景部署完成: 成功0个, 失败1个
2025-11-15 18:18:05,569 - src.api_server - WARNING - 场景下发失败: 场景部署失败
2025-11-15 18:18:16,124 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001"}], "sceneId": 12453, "algorithmCode": "安全帽检测", "type": "3", "start": "00:00:00", "end": "23:59:59", "strategyTime": 15, "strategyCount": 10}
2025-11-15 18:18:16,125 - src.scene_manager - INFO - 开始部署场景v2: sceneId=12453, algorithmCode=安全帽检测, type=3
2025-11-15 18:18:16,126 - src.scene_manager - INFO - Type 3: 每日时间段=00:00:00-23:59:59, 永久有效
2025-11-15 18:18:16,126 - src.scene_manager - INFO - 开始部署场景: scene_12453, 算法: 安全帽检测, 设备数: 1, 时间类型: 3
2025-11-15 18:18:16,126 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-15 18:18:16,127 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 18:18:16,135 - src.device_platform_client - ERROR - 获取播放地址请求失败: HTTPConnectionPool(host='host.docker.internal', port=8081): Max retries exceeded with url: /device/getPlayUrl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff45c4f3a0>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-11-15 18:18:17,138 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 2/3)
2025-11-15 18:18:17,147 - src.device_platform_client - ERROR - 获取播放地址请求失败: HTTPConnectionPool(host='host.docker.internal', port=8081): Max retries exceeded with url: /device/getPlayUrl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff47062b90>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-11-15 18:18:18,152 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 3/3)
2025-11-15 18:18:18,158 - src.device_platform_client - ERROR - 获取播放地址请求失败: HTTPConnectionPool(host='host.docker.internal', port=8081): Max retries exceeded with url: /device/getPlayUrl (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff470611b0>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-11-15 18:18:18,158 - src.device_platform_client - ERROR - 获取设备 31011500001320000001 播放地址失败，已重试3次
2025-11-15 18:18:18,159 - src.scene_manager - INFO - 场景部署完成: 成功0个, 失败1个
2025-11-15 18:18:18,159 - src.api_server - WARNING - 场景下发失败: 场景部署失败
2025-11-15 18:18:36,828 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001"}], "sceneId": 12453, "algorithmCode": "安全帽检测", "type": "3", "start": "00:00:00", "end": "23:59:59", "strategyTime": 15, "strategyCount": 10}
2025-11-15 18:18:36,838 - src.scene_manager - INFO - 开始部署场景v2: sceneId=12453, algorithmCode=安全帽检测, type=3
2025-11-15 18:18:36,839 - src.scene_manager - INFO - Type 3: 每日时间段=00:00:00-23:59:59, 永久有效
2025-11-15 18:18:36,839 - src.scene_manager - INFO - 开始部署场景: scene_12453, 算法: 安全帽检测, 设备数: 1, 时间类型: 3
2025-11-15 18:18:36,840 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-15 18:18:36,840 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 18:18:36,893 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://host.docker.internal:8554/stream1
2025-11-15 18:18:36,895 - src.stream_manager - INFO - 视频流注册成功: scene_scene_12453_31011500001320000001
2025-11-15 18:18:41,376 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-15 18:18:41,377 - src.detection_engine - INFO - 视频流检测启动成功: scene_scene_12453_31011500001320000001
2025-11-15 18:18:41,379 - src.stream_manager - INFO - 视频流启动成功: scene_scene_12453_31011500001320000001
2025-11-15 18:18:41,380 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程启动
2025-11-15 18:18:41,380 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已启动
2025-11-15 18:18:41,390 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-15 18:18:41,392 - src.scene_manager - INFO - 场景部署完成: 成功1个, 失败0个
2025-11-15 18:18:41,392 - src.scene_manager - INFO - 场景部署成功: sceneId=12453, type=3, months=None, daily=00:00:00-23:59:59
2025-11-15 18:18:41,393 - src.api_server - INFO - 场景下发成功: sceneId=12453, algorithmCode=安全帽检测
2025-11-15 18:18:46,508 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 视频设置:
2025-11-15 18:18:46,512 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-15 18:18:46,512 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-15 18:18:46,512 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-15 18:18:46,513 - src.detection_engine - INFO - 开始处理视频流: scene_scene_12453_31011500001320000001
2025-11-15 18:18:50,744 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-18-50-646_frame_2/annotated.png
2025-11-15 18:18:50,744 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.83
2025-11-15 18:18:57,851 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 10 帧, 检测耗时: 0.231s
2025-11-15 18:19:02,563 - src.detection_engine - ERROR - 保存检测结果失败: [Errno 2] No such file or directory: 'results/2025-11-15/scene_scene_12453_31011500001320000001/18-19-02-552_frame_13'
2025-11-15 18:19:03,624 - src.detection_engine - ERROR - 保存检测结果失败: [Errno 2] No such file or directory: 'results/2025-11-15/scene_scene_12453_31011500001320000001/18-19-03-609_frame_14'
2025-11-15 18:19:04,431 - src.detection_engine - ERROR - 保存检测结果失败: [Errno 2] No such file or directory: 'results/2025-11-15/scene_scene_12453_31011500001320000001/18-19-04-408_frame_15'
2025-11-15 18:19:05,555 - src.detection_engine - ERROR - 保存检测结果失败: [Errno 2] No such file or directory: 'results/2025-11-15/scene_scene_12453_31011500001320000001/18-19-05-552_frame_16'
2025-11-15 18:19:08,740 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 20 帧, 检测耗时: 0.346s, 实际帧间隔: 1.071s
2025-11-15 18:19:18,814 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 30 帧, 检测耗时: 0.235s, 实际帧间隔: 1.020s
2025-11-15 18:19:20,788 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-19-20-701_frame_31/annotated.png
2025-11-15 18:19:20,789 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.89
2025-11-15 18:19:29,104 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 40 帧, 检测耗时: 0.300s, 实际帧间隔: 1.019s
2025-11-15 18:19:39,563 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 50 帧, 检测耗时: 0.223s, 实际帧间隔: 1.059s
2025-11-15 18:19:49,861 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 60 帧, 检测耗时: 0.236s, 实际帧间隔: 1.027s
2025-11-15 18:19:50,939 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-19-50-821_frame_60/annotated.png
2025-11-15 18:19:50,939 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.80
2025-11-15 18:19:50,939 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_12453_31011500001320000001, 类别=head, 置信度=0.80
2025-11-15 18:19:50,940 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_12453_31011500001320000001 | 类别: head | 置信度: 0.80 | 级别: high | 连续帧数: 23
2025-11-15 18:19:50,942 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 18:19:50,976 - src.device_platform_client - INFO - 图片上传成功: http://host.docker.internal:8081/alarm/images/2025-11-15/unknown_1763201990.png
2025-11-15 18:19:50,976 - src.alarm_system - INFO - 图片上传成功: http://host.docker.internal:8081/alarm/images/2025-11-15/unknown_1763201990.png
2025-11-15 18:19:50,982 - src.device_platform_client - INFO - 告警发送成功: sceneId=12453, device=31011500001320000001
2025-11-15 18:19:50,983 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=12453, 设备=31011500001320000001, 类型=head
2025-11-15 18:20:00,098 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 70 帧, 检测耗时: 0.244s, 实际帧间隔: 1.018s
2025-11-15 18:20:10,207 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 80 帧, 检测耗时: 0.246s, 实际帧间隔: 1.018s
2025-11-15 18:20:20,617 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 90 帧, 检测耗时: 0.238s, 实际帧间隔: 1.023s
2025-11-15 18:20:21,421 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-20-21-324_frame_90/annotated.png
2025-11-15 18:20:21,422 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.93
2025-11-15 18:20:31,099 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 100 帧, 检测耗时: 0.659s, 实际帧间隔: 1.022s
2025-11-15 18:20:40,790 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 110 帧, 检测耗时: 0.245s, 实际帧间隔: 1.012s
2025-11-15 18:20:50,979 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 120 帧, 检测耗时: 0.228s, 实际帧间隔: 1.022s
2025-11-15 18:20:52,003 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-20-51-910_frame_120/annotated.png
2025-11-15 18:20:52,003 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=head, 置信度=0.86
2025-11-15 18:21:01,121 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 130 帧, 检测耗时: 0.211s, 实际帧间隔: 1.017s
2025-11-15 18:21:11,341 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 140 帧, 检测耗时: 0.227s, 实际帧间隔: 1.019s
2025-11-15 18:21:11,862 - __main__ - INFO - 接收到信号 15，正在关闭系统...
2025-11-15 18:21:11,862 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-15 18:21:11,862 - src.api_server - INFO - 正在停止API服务器...
2025-11-15 18:37:31,302 - __main__ - INFO - 初始化实时视频检测系统...
2025-11-15 18:37:31,302 - src.config_manager - INFO - 重新加载配置文件
2025-11-15 18:37:31,310 - src.config_manager - INFO - 配置文件加载成功: config/default_config.yaml
2025-11-15 18:37:31,310 - __main__ - INFO - 正在初始化系统组件...
2025-11-15 18:37:31,310 - __main__ - INFO - 预加载AI模型...
2025-11-15 18:37:31,310 - src.model_manager - INFO - 正在加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 18:37:31,547 - src.model_manager - INFO - 模型加载成功: pt_dir/constuction_waste/constuction_waste/best.pt
  - 类别数量: 14
  - 设备: cpu
2025-11-15 18:37:31,548 - src.model_manager - INFO - 正在加载模型: pt_dir/person/best.pt
2025-11-15 18:37:31,622 - src.model_manager - INFO - 模型加载成功: pt_dir/person/best.pt
  - 类别数量: 3
  - 设备: cpu
2025-11-15 18:37:31,622 - src.model_manager - INFO - 正在加载模型: pt_dir/luotu/best.pt
2025-11-15 18:37:31,670 - src.model_manager - INFO - 模型加载成功: pt_dir/luotu/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 18:37:31,671 - src.model_manager - INFO - 正在加载模型: pt_dir/fire_smoke/best.pt
2025-11-15 18:37:31,777 - src.model_manager - INFO - 模型加载成功: pt_dir/fire_smoke/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 18:37:31,778 - src.model_manager - INFO - 正在加载模型: pt_dir/helmet/best.pt
2025-11-15 18:37:31,849 - src.model_manager - INFO - 模型加载成功: pt_dir/helmet/best.pt
  - 类别数量: 2
  - 设备: cpu
2025-11-15 18:37:31,849 - src.model_manager - INFO - 批量加载完成: 5/5 个模型加载成功
2025-11-15 18:37:31,849 - __main__ - INFO - 模型预加载完成: 5/5 个模型可用
2025-11-15 18:37:31,850 - __main__ - INFO -   ✓ 火焰检测: pt_dir/fire_smoke/best.pt
2025-11-15 18:37:31,850 - __main__ - INFO -   ✓ 人员检测: pt_dir/person/best.pt
2025-11-15 18:37:31,851 - __main__ - INFO -   ✓ 安全帽检测: pt_dir/helmet/best.pt
2025-11-15 18:37:31,851 - __main__ - INFO -   ✓ 垃圾分类: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 18:37:31,852 - __main__ - INFO -   ✓ 裸土检测: pt_dir/luotu/best.pt
2025-11-15 18:37:31,852 - __main__ - INFO - 初始化检测引擎...
2025-11-15 18:37:31,853 - src.detection_engine - INFO - 加载模型: pt_dir/constuction_waste/constuction_waste/best.pt
2025-11-15 18:37:32,104 - src.detection_engine - INFO - 模型加载成功，使用设备: cpu
2025-11-15 18:37:32,104 - src.detection_engine - INFO - 服务器公网URL: http://localhost:8081
2025-11-15 18:37:32,104 - src.detection_engine - INFO - 未设置类别过滤，将检测所有类别
2025-11-15 18:37:32,104 - src.detection_engine - INFO - 自定义处理器配置已加载，将在流启动时按需初始化
2025-11-15 18:37:32,105 - src.detection_engine - INFO - 检测引擎初始化完成
2025-11-15 18:37:32,105 - __main__ - INFO - 初始化流管理器...
2025-11-15 18:37:32,105 - src.detection_engine - INFO - 添加检测结果回调函数
2025-11-15 18:37:32,105 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 18:37:32,105 - src.detection_engine - INFO - 添加流状态回调函数
2025-11-15 18:37:32,106 - src.stream_manager - INFO - 流监控线程启动
2025-11-15 18:37:32,106 - src.stream_manager - INFO - 视频流管理器初始化完成
2025-11-15 18:37:32,106 - __main__ - INFO - 初始化场景管理组件...
2025-11-15 18:37:32,106 - src.scene_mapper - INFO - 加载算法映射: 5 个算法
2025-11-15 18:37:32,107 - src.device_platform_client - INFO - 设备平台客户端初始化: http://host.docker.internal:8081
2025-11-15 18:37:32,107 - __main__ - INFO - 初始化报警系统...
2025-11-15 18:37:32,107 - src.kafka_publisher - INFO - 初始化Kafka生产者: host.docker.internal:9092, topic: event-alarm
2025-11-15 18:37:32,109 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 18:37:32,111 - kafka.conn - INFO - Probing node bootstrap-0 broker version
2025-11-15 18:37:32,117 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 18:37:32,118 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 18:37:32,158 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: connecting to host.docker.internal:9092 [('192.168.65.254', 9092) IPv4]
2025-11-15 18:37:32,159 - kafka.conn - ERROR - Connect attempt to <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]> returned error 111. Disconnecting.
2025-11-15 18:37:32,159 - kafka.conn - INFO - <BrokerConnection node_id=bootstrap-0 host=host.docker.internal:9092 <connecting> [IPv4 ('192.168.65.254', 9092)]>: Closing connection. KafkaConnectionError: 111 ECONNREFUSED
2025-11-15 18:37:32,159 - src.kafka_publisher - ERROR - Kafka生产者初始化失败: NoBrokersAvailable
2025-11-15 18:37:32,159 - src.alarm_system - INFO - Kafka推送器初始化成功
2025-11-15 18:37:32,160 - src.alarm_system - INFO - 告警通知方式: http, 格式: v2 (sceneId, deviceGbCode, alarmTime, path)
2025-11-15 18:37:32,160 - src.alarm_system - INFO - 启动 4 个通知处理线程
2025-11-15 18:37:32,161 - src.alarm_system - INFO - 添加报警规则: default - 默认报警规则
2025-11-15 18:37:32,161 - src.alarm_system - INFO - 报警系统初始化完成
2025-11-15 18:37:32,161 - src.heartbeat_manager - INFO - 心跳管理器初始化完成，心跳间隔: 10秒
2025-11-15 18:37:32,161 - src.scene_manager - INFO - 场景到期监控已启动
2025-11-15 18:37:32,161 - src.scene_manager - INFO - 场景管理器初始化完成
2025-11-15 18:37:32,161 - src.detection_engine - INFO - 添加报警回调函数
2025-11-15 18:37:32,162 - __main__ - INFO - 初始化API服务器...
2025-11-15 18:37:32,163 - src.api_server - INFO - API服务器初始化完成
2025-11-15 18:37:32,163 - __main__ - INFO - 系统组件初始化完成
2025-11-15 18:37:32,164 - __main__ - INFO - 启动实时视频检测系统...
2025-11-15 18:37:32,164 - src.api_server - INFO - 启动API服务器: 0.0.0.0:8080
2025-11-15 18:37:32,164 - __main__ - INFO - 实时视频检测系统启动成功
2025-11-15 18:37:41,927 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001"}], "sceneId": 12453, "algorithmCode": "安全帽检测", "type": "3", "start": "00:00:00", "end": "23:59:59", "strategyTime": 15, "strategyCount": 10}
2025-11-15 18:37:41,928 - src.scene_manager - INFO - 开始部署场景v2: sceneId=12453, algorithmCode=安全帽检测, type=3
2025-11-15 18:37:41,929 - src.scene_manager - INFO - Type 3: 每日时间段=00:00:00-23:59:59, 永久有效
2025-11-15 18:37:41,929 - src.scene_manager - INFO - 开始部署场景: scene_12453, 算法: 安全帽检测, 设备数: 1, 时间类型: 3
2025-11-15 18:37:41,929 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-15 18:37:41,930 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 18:37:41,965 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://host.docker.internal:8554/stream1
2025-11-15 18:37:41,972 - src.stream_manager - INFO - 视频流注册成功: scene_scene_12453_31011500001320000001
2025-11-15 18:37:44,089 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-15 18:37:44,090 - src.detection_engine - INFO - 视频流检测启动成功: scene_scene_12453_31011500001320000001
2025-11-15 18:37:44,090 - src.stream_manager - INFO - 视频流启动成功: scene_scene_12453_31011500001320000001
2025-11-15 18:37:44,091 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程启动
2025-11-15 18:37:44,091 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已启动
2025-11-15 18:37:44,093 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-15 18:37:44,093 - src.scene_manager - INFO - 场景部署完成: 成功1个, 失败0个
2025-11-15 18:37:44,094 - src.scene_manager - INFO - 场景部署成功: sceneId=12453, type=3, months=None, daily=00:00:00-23:59:59
2025-11-15 18:37:44,095 - src.api_server - INFO - 场景下发成功: sceneId=12453, algorithmCode=安全帽检测
2025-11-15 18:37:49,305 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 视频设置:
2025-11-15 18:37:49,306 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-15 18:37:49,306 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-15 18:37:49,307 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-15 18:37:49,307 - src.detection_engine - INFO - 开始处理视频流: scene_scene_12453_31011500001320000001
2025-11-15 18:37:54,025 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-37-53-940_frame_2/annotated.png
2025-11-15 18:37:54,025 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=high, 目标=no_helmet, 置信度=0.93
2025-11-15 18:37:57,611 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001"}], "sceneId": 12453, "algorithmCode": "火焰检测", "type": "3", "start": "00:00:00", "end": "23:59:59", "strategyTime": 15, "strategyCount": 10}
2025-11-15 18:37:57,621 - src.scene_manager - INFO - 开始部署场景v2: sceneId=12453, algorithmCode=火焰检测, type=3
2025-11-15 18:37:57,624 - src.scene_manager - INFO - 检测到场景 12453 已存在，先停止旧场景
2025-11-15 18:37:57,642 - src.detection_engine - INFO - 检测线程结束: scene_scene_12453_31011500001320000001
2025-11-15 18:37:57,644 - src.stream_manager - INFO - 流 scene_scene_12453_31011500001320000001 已断开: 检测线程结束
2025-11-15 18:37:57,647 - src.detection_engine - INFO - 视频流检测停止成功: scene_scene_12453_31011500001320000001
2025-11-15 18:37:57,648 - src.stream_manager - INFO - 视频流停止成功: scene_scene_12453_31011500001320000001
2025-11-15 18:37:57,648 - src.detection_engine - WARNING - 视频流不存在: scene_scene_12453_31011500001320000001
2025-11-15 18:37:57,649 - src.stream_manager - INFO - 视频流注销成功: scene_scene_12453_31011500001320000001
2025-11-15 18:37:57,649 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程结束
2025-11-15 18:37:57,649 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已停止
2025-11-15 18:37:57,650 - src.scene_manager - INFO - 部署 12453 已停止
2025-11-15 18:37:57,650 - src.scene_manager - INFO - Type 3: 每日时间段=00:00:00-23:59:59, 永久有效
2025-11-15 18:37:57,651 - src.scene_manager - INFO - 开始部署场景: scene_12453, 算法: 火焰检测, 设备数: 1, 时间类型: 3
2025-11-15 18:37:57,651 - src.scene_mapper - INFO - 算法 '火焰检测' -> 模型: pt_dir/fire_smoke/best.pt
2025-11-15 18:37:57,652 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 18:37:57,684 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://host.docker.internal:8554/stream1
2025-11-15 18:37:57,685 - src.stream_manager - INFO - 视频流注册成功: scene_scene_12453_31011500001320000001
2025-11-15 18:38:00,855 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-15 18:38:00,857 - src.detection_engine - INFO - 视频流检测启动成功: scene_scene_12453_31011500001320000001
2025-11-15 18:38:00,861 - src.stream_manager - INFO - 视频流启动成功: scene_scene_12453_31011500001320000001
2025-11-15 18:38:00,862 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程启动
2025-11-15 18:38:00,864 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已启动
2025-11-15 18:38:00,874 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-15 18:38:00,875 - src.scene_manager - INFO - 场景部署完成: 成功1个, 失败0个
2025-11-15 18:38:00,875 - src.scene_manager - INFO - 场景部署成功: sceneId=12453, type=3, months=None, daily=00:00:00-23:59:59
2025-11-15 18:38:00,876 - src.api_server - INFO - 场景下发成功: sceneId=12453, algorithmCode=火焰检测
2025-11-15 18:38:06,022 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 视频设置:
2025-11-15 18:38:06,024 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-15 18:38:06,024 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-15 18:38:06,025 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-15 18:38:06,025 - src.detection_engine - INFO - 开始处理视频流: scene_scene_12453_31011500001320000001
2025-11-15 18:38:06,913 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001"}], "sceneId": 12453, "algorithmCode": "火焰检测", "type": "3", "start": "00:00:00", "end": "23:59:59", "strategyTime": 15, "strategyCount": 10}
2025-11-15 18:38:06,913 - src.scene_manager - INFO - 开始部署场景v2: sceneId=12453, algorithmCode=火焰检测, type=3
2025-11-15 18:38:06,914 - src.scene_manager - INFO - 检测到场景 12453 已存在，先停止旧场景
2025-11-15 18:38:09,469 - src.detection_engine - INFO - 检测线程结束: scene_scene_12453_31011500001320000001
2025-11-15 18:38:09,470 - src.stream_manager - INFO - 流 scene_scene_12453_31011500001320000001 已断开: 检测线程结束
2025-11-15 18:38:09,470 - src.detection_engine - INFO - 视频流检测停止成功: scene_scene_12453_31011500001320000001
2025-11-15 18:38:09,471 - src.stream_manager - INFO - 视频流停止成功: scene_scene_12453_31011500001320000001
2025-11-15 18:38:09,471 - src.detection_engine - WARNING - 视频流不存在: scene_scene_12453_31011500001320000001
2025-11-15 18:38:09,472 - src.stream_manager - INFO - 视频流注销成功: scene_scene_12453_31011500001320000001
2025-11-15 18:38:09,472 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程结束
2025-11-15 18:38:09,472 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已停止
2025-11-15 18:38:09,472 - src.scene_manager - INFO - 部署 12453 已停止
2025-11-15 18:38:09,472 - src.scene_manager - INFO - Type 3: 每日时间段=00:00:00-23:59:59, 永久有效
2025-11-15 18:38:09,473 - src.scene_manager - INFO - 开始部署场景: scene_12453, 算法: 火焰检测, 设备数: 1, 时间类型: 3
2025-11-15 18:38:09,473 - src.scene_mapper - INFO - 算法 '火焰检测' -> 模型: pt_dir/fire_smoke/best.pt
2025-11-15 18:38:09,473 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 18:38:09,512 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://host.docker.internal:8554/stream1
2025-11-15 18:38:09,512 - src.stream_manager - INFO - 视频流注册成功: scene_scene_12453_31011500001320000001
2025-11-15 18:38:14,685 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-15 18:38:14,686 - src.detection_engine - INFO - 视频流检测启动成功: scene_scene_12453_31011500001320000001
2025-11-15 18:38:14,689 - src.stream_manager - INFO - 视频流启动成功: scene_scene_12453_31011500001320000001
2025-11-15 18:38:14,690 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程启动
2025-11-15 18:38:14,691 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已启动
2025-11-15 18:38:14,696 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-15 18:38:14,696 - src.scene_manager - INFO - 场景部署完成: 成功1个, 失败0个
2025-11-15 18:38:14,697 - src.scene_manager - INFO - 场景部署成功: sceneId=12453, type=3, months=None, daily=00:00:00-23:59:59
2025-11-15 18:38:14,697 - src.api_server - INFO - 场景下发成功: sceneId=12453, algorithmCode=火焰检测
2025-11-15 18:38:17,495 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 视频设置:
2025-11-15 18:38:17,496 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-15 18:38:17,496 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-15 18:38:17,496 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-15 18:38:17,497 - src.detection_engine - INFO - 开始处理视频流: scene_scene_12453_31011500001320000001
2025-11-15 18:38:27,237 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 10 帧, 检测耗时: 0.476s
2025-11-15 18:38:32,465 - src.api_server - INFO - 收到场景启停请求: sceneId=123, status=0
2025-11-15 18:38:37,603 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 20 帧, 检测耗时: 0.477s, 实际帧间隔: 1.026s
2025-11-15 18:38:40,599 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001"}], "sceneId": 123, "algorithmCode": "火焰检测", "type": "3", "start": "00:00:00", "end": "23:59:59", "strategyTime": 15, "strategyCount": 10}
2025-11-15 18:38:40,606 - src.scene_manager - INFO - 开始部署场景v2: sceneId=123, algorithmCode=火焰检测, type=3
2025-11-15 18:38:40,611 - src.scene_manager - INFO - Type 3: 每日时间段=00:00:00-23:59:59, 永久有效
2025-11-15 18:38:40,619 - src.scene_manager - INFO - 开始部署场景: scene_123, 算法: 火焰检测, 设备数: 1, 时间类型: 3
2025-11-15 18:38:40,620 - src.scene_mapper - INFO - 算法 '火焰检测' -> 模型: pt_dir/fire_smoke/best.pt
2025-11-15 18:38:40,621 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 18:38:40,773 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://host.docker.internal:8554/stream1
2025-11-15 18:38:40,785 - src.stream_manager - INFO - 视频流注册成功: scene_scene_123_31011500001320000001
2025-11-15 18:38:42,564 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-15 18:38:42,566 - src.detection_engine - INFO - 视频流检测启动成功: scene_scene_123_31011500001320000001
2025-11-15 18:38:42,575 - src.stream_manager - INFO - 视频流启动成功: scene_scene_123_31011500001320000001
2025-11-15 18:38:42,576 - src.heartbeat_manager - WARNING - 设备 31011500001320000001 心跳已在运行
2025-11-15 18:38:42,578 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-15 18:38:42,579 - src.scene_manager - INFO - 场景部署完成: 成功1个, 失败0个
2025-11-15 18:38:42,582 - src.scene_manager - INFO - 场景部署成功: sceneId=123, type=3, months=None, daily=00:00:00-23:59:59
2025-11-15 18:38:42,584 - src.api_server - INFO - 场景下发成功: sceneId=123, algorithmCode=火焰检测
2025-11-15 18:38:47,730 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 视频设置:
2025-11-15 18:38:47,731 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-15 18:38:47,731 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-15 18:38:47,731 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-15 18:38:47,731 - src.detection_engine - INFO - 开始处理视频流: scene_scene_123_31011500001320000001
2025-11-15 18:38:48,666 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 30 帧, 检测耗时: 0.526s, 实际帧间隔: 1.094s
2025-11-15 18:39:00,847 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 40 帧, 检测耗时: 1.377s, 实际帧间隔: 1.151s
2025-11-15 18:39:01,712 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 10 帧, 检测耗时: 1.309s
2025-11-15 18:39:10,271 - src.api_server - INFO - 收到场景下发请求: {"devices": [{"deviceGbCode": "31011500001320000001"}], "sceneId": 123, "algorithmCode": "安全帽检测", "type": "3", "start": "00:00:00", "end": "23:59:59", "strategyTime": 15, "strategyCount": 10}
2025-11-15 18:39:10,272 - src.scene_manager - INFO - 开始部署场景v2: sceneId=123, algorithmCode=安全帽检测, type=3
2025-11-15 18:39:10,273 - src.scene_manager - INFO - 检测到场景 123 已存在，先停止旧场景
2025-11-15 18:39:10,324 - src.detection_engine - INFO - 检测线程结束: scene_scene_123_31011500001320000001
2025-11-15 18:39:10,334 - src.stream_manager - INFO - 流 scene_scene_123_31011500001320000001 已断开: 检测线程结束
2025-11-15 18:39:10,428 - src.detection_engine - INFO - 视频流检测停止成功: scene_scene_123_31011500001320000001
2025-11-15 18:39:10,470 - src.stream_manager - INFO - 视频流停止成功: scene_scene_123_31011500001320000001
2025-11-15 18:39:10,489 - src.detection_engine - WARNING - 视频流不存在: scene_scene_123_31011500001320000001
2025-11-15 18:39:10,508 - src.stream_manager - INFO - 视频流注销成功: scene_scene_123_31011500001320000001
2025-11-15 18:39:10,520 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程结束
2025-11-15 18:39:10,553 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已停止
2025-11-15 18:39:10,563 - src.scene_manager - INFO - 部署 123 已停止
2025-11-15 18:39:10,566 - src.scene_manager - INFO - Type 3: 每日时间段=00:00:00-23:59:59, 永久有效
2025-11-15 18:39:10,572 - src.scene_manager - INFO - 开始部署场景: scene_123, 算法: 安全帽检测, 设备数: 1, 时间类型: 3
2025-11-15 18:39:10,576 - src.scene_mapper - INFO - 算法 '安全帽检测' -> 模型: pt_dir/helmet/best.pt
2025-11-15 18:39:10,585 - src.device_platform_client - INFO - 获取设备播放地址: 31011500001320000001 (尝试 1/3)
2025-11-15 18:39:10,675 - src.device_platform_client - INFO - 成功获取设备 31011500001320000001 的流地址: rtsp://host.docker.internal:8554/stream1
2025-11-15 18:39:10,678 - src.stream_manager - INFO - 视频流注册成功: scene_scene_123_31011500001320000001
2025-11-15 18:39:12,669 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 50 帧, 检测耗时: 0.729s, 实际帧间隔: 1.247s
2025-11-15 18:39:15,850 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 帧率设置: fps_limit=1, frame_interval=1.0
2025-11-15 18:39:15,858 - src.detection_engine - INFO - 视频流检测启动成功: scene_scene_123_31011500001320000001
2025-11-15 18:39:15,867 - src.stream_manager - INFO - 视频流启动成功: scene_scene_123_31011500001320000001
2025-11-15 18:39:15,878 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳工作线程启动
2025-11-15 18:39:15,879 - src.heartbeat_manager - INFO - 设备 31011500001320000001 心跳线程已启动
2025-11-15 18:39:15,885 - src.scene_manager - INFO - 设备 31011500001320000001 部署成功
2025-11-15 18:39:15,887 - src.scene_manager - INFO - 场景部署完成: 成功1个, 失败0个
2025-11-15 18:39:15,887 - src.scene_manager - INFO - 场景部署成功: sceneId=123, type=3, months=None, daily=00:00:00-23:59:59
2025-11-15 18:39:15,888 - src.api_server - INFO - 场景下发成功: sceneId=123, algorithmCode=安全帽检测
2025-11-15 18:39:21,046 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 视频设置:
2025-11-15 18:39:21,047 - src.detection_engine - INFO -   - 缓冲区大小: 1
2025-11-15 18:39:21,047 - src.detection_engine - INFO -   - 分辨率: 1280x720
2025-11-15 18:39:21,047 - src.detection_engine - INFO -   - 编码格式: 875967080.0
2025-11-15 18:39:21,048 - src.detection_engine - INFO - 开始处理视频流: scene_scene_123_31011500001320000001
2025-11-15 18:39:22,628 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 60 帧, 检测耗时: 0.479s, 实际帧间隔: 1.021s
2025-11-15 18:39:25,122 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/18-39-25-014_frame_2/annotated.png
2025-11-15 18:39:25,123 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=no_helmet, 置信度=0.92
2025-11-15 18:39:33,097 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 10 帧, 检测耗时: 0.254s
2025-11-15 18:39:33,931 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 70 帧, 检测耗时: 0.723s, 实际帧间隔: 1.104s
2025-11-15 18:39:43,843 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 20 帧, 检测耗时: 0.235s, 实际帧间隔: 1.076s
2025-11-15 18:39:44,021 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 80 帧, 检测耗时: 0.479s, 实际帧间隔: 1.032s
2025-11-15 18:39:54,033 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 30 帧, 检测耗时: 0.261s, 实际帧间隔: 1.014s
2025-11-15 18:39:54,176 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 90 帧, 检测耗时: 0.508s, 实际帧间隔: 1.011s
2025-11-15 18:39:56,002 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/18-39-55-905_frame_31/annotated.png
2025-11-15 18:39:56,002 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=no_helmet, 置信度=0.90
2025-11-15 18:40:04,166 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 40 帧, 检测耗时: 0.233s, 实际帧间隔: 1.017s
2025-11-15 18:40:04,323 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 100 帧, 检测耗时: 0.496s, 实际帧间隔: 1.017s
2025-11-15 18:40:08,941 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_12453_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_12453_31011500001320000001/18-40-08-835_frame_103/annotated.png
2025-11-15 18:40:08,942 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_12453_31011500001320000001, 类型=medium, 目标=fire, 置信度=0.50
2025-11-15 18:40:14,331 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 50 帧, 检测耗时: 0.213s, 实际帧间隔: 1.022s
2025-11-15 18:40:14,882 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 110 帧, 检测耗时: 0.480s, 实际帧间隔: 1.057s
2025-11-15 18:40:24,557 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 60 帧, 检测耗时: 0.237s, 实际帧间隔: 1.019s
2025-11-15 18:40:25,101 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 120 帧, 检测耗时: 0.467s, 实际帧间隔: 1.023s
2025-11-15 18:40:26,564 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/18-40-26-466_frame_61/annotated.png
2025-11-15 18:40:26,564 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=no_helmet, 置信度=0.86
2025-11-15 18:40:26,564 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_123_31011500001320000001, 类别=no_helmet, 置信度=0.86
2025-11-15 18:40:26,565 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_123_31011500001320000001 | 类别: no_helmet | 置信度: 0.86 | 级别: high | 连续帧数: 30
2025-11-15 18:40:26,569 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 18:40:26,585 - src.device_platform_client - INFO - 图片上传成功: http://host.docker.internal:8081/alarm/images/2025-11-15/unknown_1763203226.png
2025-11-15 18:40:26,585 - src.alarm_system - INFO - 图片上传成功: http://host.docker.internal:8081/alarm/images/2025-11-15/unknown_1763203226.png
2025-11-15 18:40:26,592 - src.device_platform_client - INFO - 告警发送成功: sceneId=123, device=31011500001320000001
2025-11-15 18:40:26,593 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=123, 设备=31011500001320000001, 类型=no_helmet
2025-11-15 18:40:34,723 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 70 帧, 检测耗时: 0.219s, 实际帧间隔: 1.018s
2025-11-15 18:40:35,381 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 130 帧, 检测耗时: 0.485s, 实际帧间隔: 1.026s
2025-11-15 18:40:44,957 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 80 帧, 检测耗时: 0.213s, 实际帧间隔: 1.021s
2025-11-15 18:40:45,564 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 140 帧, 检测耗时: 0.469s, 实际帧间隔: 1.020s
2025-11-15 18:40:55,113 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 90 帧, 检测耗时: 0.205s, 实际帧间隔: 1.019s
2025-11-15 18:40:55,781 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 150 帧, 检测耗时: 0.475s, 实际帧间隔: 1.022s
2025-11-15 18:40:57,188 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/18-40-57-093_frame_91/annotated.png
2025-11-15 18:40:57,189 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=no_helmet, 置信度=0.90
2025-11-15 18:41:05,325 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 100 帧, 检测耗时: 0.217s, 实际帧间隔: 1.017s
2025-11-15 18:41:06,020 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 160 帧, 检测耗时: 0.484s, 实际帧间隔: 1.023s
2025-11-15 18:41:15,526 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 110 帧, 检测耗时: 0.224s, 实际帧间隔: 1.021s
2025-11-15 18:41:16,262 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 170 帧, 检测耗时: 0.480s, 实际帧间隔: 1.026s
2025-11-15 18:41:25,759 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 120 帧, 检测耗时: 0.215s, 实际帧间隔: 1.021s
2025-11-15 18:41:26,507 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 180 帧, 检测耗时: 0.479s, 实际帧间隔: 1.021s
2025-11-15 18:41:27,795 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/18-41-27-697_frame_121/annotated.png
2025-11-15 18:41:27,795 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=no_helmet, 置信度=0.93
2025-11-15 18:41:36,241 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 130 帧, 检测耗时: 0.229s, 实际帧间隔: 1.048s
2025-11-15 18:41:37,175 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 190 帧, 检测耗时: 0.512s, 实际帧间隔: 1.065s
2025-11-15 18:41:46,449 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 140 帧, 检测耗时: 0.224s, 实际帧间隔: 1.026s
2025-11-15 18:41:47,340 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 200 帧, 检测耗时: 0.505s, 实际帧间隔: 1.015s
2025-11-15 18:41:56,748 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 150 帧, 检测耗时: 0.240s, 实际帧间隔: 1.028s
2025-11-15 18:41:57,506 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 210 帧, 检测耗时: 0.478s, 实际帧间隔: 1.020s
2025-11-15 18:41:58,759 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/18-41-58-661_frame_151/annotated.png
2025-11-15 18:41:58,759 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=no_helmet, 置信度=0.94
2025-11-15 18:41:58,760 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_123_31011500001320000001, 类别=no_helmet, 置信度=0.94
2025-11-15 18:41:58,760 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_123_31011500001320000001 | 类别: no_helmet | 置信度: 0.94 | 级别: high | 连续帧数: 29
2025-11-15 18:41:58,764 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 18:41:58,778 - src.device_platform_client - INFO - 图片上传成功: http://host.docker.internal:8081/alarm/images/2025-11-15/unknown_1763203318.png
2025-11-15 18:41:58,778 - src.alarm_system - INFO - 图片上传成功: http://host.docker.internal:8081/alarm/images/2025-11-15/unknown_1763203318.png
2025-11-15 18:41:58,786 - src.device_platform_client - INFO - 告警发送成功: sceneId=123, device=31011500001320000001
2025-11-15 18:41:58,786 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=123, 设备=31011500001320000001, 类型=no_helmet
2025-11-15 18:42:03,497 - src.detection_engine - ERROR - 保存检测结果失败: [Errno 2] No such file or directory: 'results/2025-11-15/scene_scene_123_31011500001320000001/18-42-03-465_frame_155'
2025-11-15 18:42:05,807 - src.detection_engine - ERROR - 保存检测结果失败: [Errno 2] No such file or directory: 'results/2025-11-15/scene_scene_123_31011500001320000001/18-42-05-739_frame_156'
2025-11-15 18:42:10,236 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 160 帧, 检测耗时: 0.453s, 实际帧间隔: 1.246s
2025-11-15 18:42:11,526 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 220 帧, 检测耗时: 0.569s, 实际帧间隔: 1.398s
2025-11-15 18:42:19,842 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 170 帧, 检测耗时: 0.238s, 实际帧间隔: 1.063s
2025-11-15 18:42:21,663 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 230 帧, 检测耗时: 0.488s, 实际帧间隔: 1.017s
2025-11-15 18:42:29,021 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/18-42-28-908_frame_178/annotated.png
2025-11-15 18:42:29,022 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=no_helmet, 置信度=0.83
2025-11-15 18:42:30,094 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 180 帧, 检测耗时: 0.245s, 实际帧间隔: 1.023s
2025-11-15 18:42:33,413 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 240 帧, 检测耗时: 2.034s, 实际帧间隔: 1.021s
2025-11-15 18:42:41,233 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 190 帧, 检测耗时: 0.250s, 实际帧间隔: 1.115s
2025-11-15 18:42:43,133 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 250 帧, 检测耗时: 0.502s, 实际帧间隔: 1.127s
2025-11-15 18:42:51,477 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 200 帧, 检测耗时: 0.229s, 实际帧间隔: 1.027s
2025-11-15 18:42:53,355 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 260 帧, 检测耗时: 0.530s, 实际帧间隔: 1.016s
2025-11-15 18:42:59,651 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/18-42-59-544_frame_207/annotated.png
2025-11-15 18:42:59,651 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=no_helmet, 置信度=0.83
2025-11-15 18:43:01,644 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 210 帧, 检测耗时: 0.214s, 实际帧间隔: 1.019s
2025-11-15 18:43:03,471 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 270 帧, 检测耗时: 0.514s, 实际帧间隔: 1.017s
2025-11-15 18:43:11,816 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 220 帧, 检测耗时: 0.223s, 实际帧间隔: 1.017s
2025-11-15 18:43:13,703 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 280 帧, 检测耗时: 0.505s, 实际帧间隔: 1.023s
2025-11-15 18:43:22,059 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 230 帧, 检测耗时: 0.221s, 实际帧间隔: 1.021s
2025-11-15 18:43:23,867 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 290 帧, 检测耗时: 0.484s, 实际帧间隔: 1.018s
2025-11-15 18:43:30,196 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/18-43-30-106_frame_237/annotated.png
2025-11-15 18:43:30,196 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=no_helmet, 置信度=0.75
2025-11-15 18:43:30,197 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_123_31011500001320000001, 类别=no_helmet, 置信度=0.75
2025-11-15 18:43:30,197 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_123_31011500001320000001 | 类别: no_helmet | 置信度: 0.75 | 级别: high | 连续帧数: 30
2025-11-15 18:43:30,201 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 18:43:30,219 - src.device_platform_client - INFO - 图片上传成功: http://host.docker.internal:8081/alarm/images/2025-11-15/unknown_1763203410.png
2025-11-15 18:43:30,219 - src.alarm_system - INFO - 图片上传成功: http://host.docker.internal:8081/alarm/images/2025-11-15/unknown_1763203410.png
2025-11-15 18:43:30,224 - src.device_platform_client - INFO - 告警发送成功: sceneId=123, device=31011500001320000001
2025-11-15 18:43:30,224 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=123, 设备=31011500001320000001, 类型=no_helmet
2025-11-15 18:43:32,758 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 240 帧, 检测耗时: 0.669s, 实际帧间隔: 1.024s
2025-11-15 18:43:34,105 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 300 帧, 检测耗时: 0.496s, 实际帧间隔: 1.021s
2025-11-15 18:43:42,457 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 250 帧, 检测耗时: 0.243s, 实际帧间隔: 1.019s
2025-11-15 18:43:44,304 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 310 帧, 检测耗时: 0.500s, 实际帧间隔: 1.019s
2025-11-15 18:43:52,570 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 260 帧, 检测耗时: 0.222s, 实际帧间隔: 1.013s
2025-11-15 18:43:54,472 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 320 帧, 检测耗时: 0.505s, 实际帧间隔: 1.019s
2025-11-15 18:44:02,639 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 270 帧, 检测耗时: 0.218s, 实际帧间隔: 1.013s
2025-11-15 18:44:04,737 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 330 帧, 检测耗时: 0.480s, 实际帧间隔: 1.027s
2025-11-15 18:44:05,809 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/18-44-05-701_frame_272/annotated.png
2025-11-15 18:44:05,809 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=no_helmet, 置信度=0.87
2025-11-15 18:44:12,966 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 280 帧, 检测耗时: 0.221s, 实际帧间隔: 1.022s
2025-11-15 18:44:14,929 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 340 帧, 检测耗时: 0.483s, 实际帧间隔: 1.020s
2025-11-15 18:44:23,113 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 290 帧, 检测耗时: 0.212s, 实际帧间隔: 1.016s
2025-11-15 18:44:25,144 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 350 帧, 检测耗时: 0.491s, 实际帧间隔: 1.019s
2025-11-15 18:44:33,377 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 300 帧, 检测耗时: 0.240s, 实际帧间隔: 1.026s
2025-11-15 18:44:35,600 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 360 帧, 检测耗时: 0.519s, 实际帧间隔: 1.043s
2025-11-15 18:44:36,488 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/18-44-36-373_frame_302/annotated.png
2025-11-15 18:44:36,492 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=no_helmet, 置信度=0.90
2025-11-15 18:44:43,587 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 310 帧, 检测耗时: 0.208s, 实际帧间隔: 1.023s
2025-11-15 18:44:45,746 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 370 帧, 检测耗时: 0.484s, 实际帧间隔: 1.019s
2025-11-15 18:44:53,853 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 320 帧, 检测耗时: 0.230s, 实际帧间隔: 1.022s
2025-11-15 18:44:56,043 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 380 帧, 检测耗时: 0.479s, 实际帧间隔: 1.029s
2025-11-15 18:45:04,039 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 330 帧, 检测耗时: 0.235s, 实际帧间隔: 1.019s
2025-11-15 18:45:06,178 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 390 帧, 检测耗时: 0.494s, 实际帧间隔: 1.015s
2025-11-15 18:45:07,098 - src.detection_engine - INFO - 创建告警事件: stream_id=scene_scene_123_31011500001320000001, image_url=http://localhost:8081/results/2025-11-15/scene_scene_123_31011500001320000001/18-45-06-994_frame_332/annotated.png
2025-11-15 18:45:07,098 - src.stream_manager - WARNING - 报警事件: 流ID=scene_scene_123_31011500001320000001, 类型=high, 目标=no_helmet, 置信度=0.91
2025-11-15 18:45:07,098 - src.alarm_system - WARNING - 触发报警: 规则=默认报警规则, 流=scene_scene_123_31011500001320000001, 类别=no_helmet, 置信度=0.91
2025-11-15 18:45:07,098 - src.alarm_system - WARNING - [ALARM] 规则: 默认报警规则 | 流: scene_scene_123_31011500001320000001 | 类别: no_helmet | 置信度: 0.91 | 级别: high | 连续帧数: 7
2025-11-15 18:45:07,102 - src.device_platform_client - INFO - 上传告警图片: annotated.png
2025-11-15 18:45:07,118 - src.device_platform_client - INFO - 图片上传成功: http://host.docker.internal:8081/alarm/images/2025-11-15/unknown_1763203507.png
2025-11-15 18:45:07,119 - src.alarm_system - INFO - 图片上传成功: http://host.docker.internal:8081/alarm/images/2025-11-15/unknown_1763203507.png
2025-11-15 18:45:07,129 - src.device_platform_client - INFO - 告警发送成功: sceneId=123, device=31011500001320000001
2025-11-15 18:45:07,129 - src.alarm_system - INFO - 告警HTTP回调成功: sceneId=123, 设备=31011500001320000001, 类型=no_helmet
2025-11-15 18:45:14,183 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 340 帧, 检测耗时: 0.225s, 实际帧间隔: 1.018s
2025-11-15 18:45:16,437 - src.detection_engine - INFO - 流 scene_scene_12453_31011500001320000001 已处理 400 帧, 检测耗时: 0.473s, 实际帧间隔: 1.025s
2025-11-15 18:45:17,004 - src.device_platform_client - ERROR - 设备 31011500001320000001 心跳异常: HTTPConnectionPool(host='host.docker.internal', port=8081): Max retries exceeded with url: /device/heartBeat (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0xffff7091a050>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-11-15 18:45:24,129 - __main__ - INFO - 接收到信号 15，正在关闭系统...
2025-11-15 18:45:24,130 - __main__ - INFO - 正在关闭实时视频检测系统...
2025-11-15 18:45:24,131 - src.api_server - INFO - 正在停止API服务器...
2025-11-15 18:45:24,400 - src.detection_engine - INFO - 流 scene_scene_123_31011500001320000001 已处理 350 帧, 检测耗时: 0.236s, 实际帧间隔: 1.021s
