# AI识别厂商接入文档

## 目录

1. 算法场景下发
2. 根据设备图标号获取设备直播流
3. 根据设备图标号发送播放地址(保话心跳)
4. 设备告警信息推送

---

## 1. 算法场景下发

### 接口功能说明
算法场景与设备相关信息下发给第三方厂商

### 请求地址
由第三方算法厂商提供

### 请求类型
由第三方算法厂商提供

### 请求参数

| 参数 | 必选 | 类型 | 说明 |
|------|------|------|------|
| devices | ture | array | 设备列表 |
| -deviceGbCode | true | string | 所有的设备图标号 |
| -area | true | array | 检测区域点位，可以有多个区域 |
| scene | true | string | 场景名称 |
| startDate | true | string | 场景启动时间，格式：yyyy-MM-dd HH:mm:ss |
| endDate | true | string | 场景结束时间，格式：yyyy-MM-dd HH:mm:ss |
| algorithm | true | string | 算法名称 |

### 返回字段

| 返回字段 | 字段类型 | 说明 |
|----------|----------|------|
| status | int | 返回结果状态。0：正常；1：错误。 |
| message | string | 返回说明 |

### 接口请求示例

```json
{
    "devices": [
        {
            "deviceGbCode": "31011500001320000001",
            "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"
        },
        {
            "deviceGbCode": "31011500001320000002",
            "area": "(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00);(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00),(1.00,2.00)"
        }
    ],
    "scene": "明火告警",
    "algorithm": "火焰检测",
    "startDate": "2024-06-01 10:00:00",
    "endDate": "2025-06-01 10:00:00"
}

## 2. 根据设备图标号获取直播流地址

### 接口说明
根据设备图标号获取直播流地址

### 请求地址
`http://[ip]:[port]/device/getPlayUrl`

### 请求类型
POST

### 请求参数

| 参数 | 必选 | 类型 | 说明 |
|------|------|------|------|
| deviceGbCode | true | String | 设备图标号 |

### 返回字段

| 返回字段 | 字段类型 | 说明 |
|----------|----------|------|
| status | int | 返回结果状态。0：正常；1：错误。 |
| message | string | 返回说明 |
| data | object | 返回数据 |
| -rtmp | string | rtmp流量放地址 |
| -hls | string | hls流量放地址 |
| -flv | string | flv流量放地址 |
| -webrtc | string | webrtc流量放地址 |

### 请求参数
```json
{"deviceGbCode":"31011500001320000001"}

### 返回结果
```json
{
    "status": 0,
    "message": "ok",
    "data": {
        "rtmp": "rtmp://127.0.0.1:1980/3101870000200000000310101000011800000131010100001320000008",
        "hls": "http://127.0.0.1:1980/3101870000200000000310101000011800000131010100001320000008.m3u8",
        "flv": "http://127.0.0.1:1980/3101870000200000000310101000011800000131010100001320000008.flv",
        "webrtc": "webrtc://127.0.0.1:1980/3101870000200000000310101000011800000131010100001320000008"
    }
}

## 3. 根据设备图标号进行播放地址的保洁

### 接口说明
当获取通道播放的url地址信息以后，则需要在播放以后，请求当前接口间隔小于10s/次。以保证能够持续播放。

### 接口地址
`http://[ip]:[port]/device/hearBeat`

### 接口类型
POST

### 请求参数

| 参数 | 必选 | 类型 | 说明 |
|------|------|------|------|
| deviceGbCode | true | String | 设备图标号 |

### 响应结果

| 返回字段 | 字段类型 | 说明 |
|----------|----------|------|
| status | int | 返回结果状态。0：正常；1：错误。 |
| message | string | 返回说明 |

### 请求示例
```json
{"deviceGbCode":"31011500001320000001"}

## 4. 设备告警事件接收

### 接口说明
使用kafka接收第三方算法厂商推送的告警事件，topic为`event-alarm`

### 接收字段

| 参数 | 必选 | 类型 | 说明 |
|------|------|------|------|
| scene | true | string | 事件告警场景 |
| alarmTime | true | string | 事件告警事件，格式：yyyy-MM-dd HH:mm:ss |
| pic | true | string | 告警抓拍图片 |
| deviceGbCode | true | string | 设备图标号 |
| record | true | string | 告警录像地址 |

### 接收示例
```json
{
    "scene": "火警",
    "alarmTime": "2024-05-21 10:04:29",
    "pic": "http://127.0.0.1/alarm.jpg",
    "deviceGbCode": "31011500001320000001",
    "record": "http://127.0.0.1/alarm.mp4"
}