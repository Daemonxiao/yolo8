# 实时视频检测系统配置文件

# 模型配置
model:
  # 模型文件路径
  path: "pt_dir/constuction_waste/best.pt"
  #path: "yolov8n.pt"
  # 备用模型配置（可选择不同精度的模型）
  models:
    high_accuracy: "pt_dir/constuction_waste/best.pt"
    lightweight: "yolov8n.pt"
  # 当前使用的模型类型
  current_model: "high_accuracy"

# 检测参数配置
detection:
  # 置信度阈值（0.0-1.0）
  confidence_threshold: 0.5
  # IoU阈值（用于非极大值抑制）
  iou_threshold: 0.45
  # 检测图像尺寸
  image_size: 640
  # 处理频率（每秒处理多少帧，0表示处理所有帧）
  fps_limit: 1
  # 最大同时处理的视频流数量
  max_streams: 10
  # 自动缩放高分辨率图像以提高性能
  auto_resize: true
  # 自动缩放的最大分辨率（单边）
  max_resolution: 640
  # 类别过滤（只检测指定类别，为空则检测所有类别）
  target_classes: []
  # 示例: 只检测人
  # target_classes: ["person"]
  # 示例: 只检测人和安全帽
  # target_classes: ["person", "helmet"]
  # 自定义类别名称映射（中文化）
  custom_class_names:
    "pallet": "托盘"
    "wires": "电线"
    "rebar": "钢筋"
    "cementitious": "水泥材料"
    "pvc": "PVC材料"
    "bricks": "砖块"
    "Disposed Soil": "废弃土壤"
    "Temporary Soil": "临时土壤"
    "Roll-Off Dumpster": "垃圾箱"
    "Roll-off Dumpster": "垃圾箱"
    "Disposed Gravel": "废弃砂石"
    "Temporary Gravel": "临时砂石"
    "Temporary Sand": "临时沙土"
    "wood": "木材"
  
  # 自定义处理类型（可选）
  # 可选值: "", "high_temperature_alert", "morning_meeting_alert"
  custom_type: ""
  
  # 自定义处理配置
  custom_type_config:
    # 高温预警配置（当custom_type为"high_temperature_alert"时使用）
    temperature_threshold: 35.0    # 高温阈值（摄氏度）
    temperature_source: "api"      # 温度来源: "api", "sensor", "fixed"
    enabled: true                  # 是否启用
    api_key: ""                    # 天气API密钥
    city: "北京"                   # 城市名称
    fixed_temperature: 25.0        # 固定温度值（当source为"fixed"时使用）
    
    # 安全晨会预警配置（当custom_type为"morning_meeting_alert"时使用）
    meeting_start_time: "08:00"    # 晨会开始时间
    meeting_end_time: "08:30"      # 晨会结束时间
    weekdays: [0, 1, 2, 3, 4]      # 工作日（0=周一, 6=周日）
    person_class_names: ["person", "人", "人员"]  # 人员类别名称

# 报警规则配置
alarm:
  # 触发报警的最小置信度
  min_confidence: 0.5
  # 连续检测到目标的帧数才触发报警
  consecutive_frames: 3
  # 报警冷却时间（秒）- 避免频繁报警
  cooldown_seconds: 30
  # 报警级别
  levels:
    low: 0.3
    medium: 0.5
    high: 0.7
  # 支持的报警方式
  notification_methods:
    - "callback"  # HTTP回调
    - "log"       # 日志记录
    - "email"     # 邮件通知（可选）

# 视频流配置
video_streams:
  # 缓冲区大小（帧数）
  buffer_size: 5
  # 连接超时时间（秒）
  connection_timeout: 10
  # 重连间隔（秒）
  reconnect_interval: 5
  # 最大重连次数
  max_reconnect_attempts: 3
  # 支持的视频格式
  supported_formats:
    - "rtsp"
    - "rtmp"
    - "http"
    - "file"
    - "camera"

# API服务配置
api:
  # 服务端口
  port: 8080
  # 服务主机
  host: "0.0.0.0"
  # API版本
  version: "v1"
  # 是否启用调试模式
  debug: false
  # 允许的跨域来源
  cors_origins:
    - "*"

# 日志配置
logging:
  # 日志级别
  level: "INFO"
  # 日志文件路径
  file_path: "logs/detection.log"
  # 日志文件大小限制（MB）
  max_file_size: 100
  # 保留的日志文件数量
  backup_count: 5
  # 日志格式
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# 性能配置
performance:
  # 是否使用GPU
  use_gpu: false
  # GPU设备ID
  gpu_device: 0
  # 工作线程数
  worker_threads: 4
  # 内存使用限制（MB）
  memory_limit: 2048

# 存储配置
storage:
  # 是否保存检测结果信息文件
  save_results: true
  # 是否保存检测图像
  save_images: true
  # 结果保存路径
  results_path: "results/"
  # 图像保存路径
  images_path: "results/images/"
  # 数据保留天数
  retention_days: 30
  # 是否只保存有检测结果的帧
  save_only_detections: true
  # 最大保存文件数量（防止磁盘满）
  max_saved_files: 10000
  # 图像质量设置
  image_format: "png"  # 图像格式: "png"(无损) 或 "jpg"(有损)
  jpeg_quality: 100    # JPEG质量 (1-100，仅当format为jpg时有效)
  png_compression: 1   # PNG压缩级别 (0-9，0最快，9最小)
  # 视频捕获设置
  capture_width: 640   # 期望的捕获宽度 (降低以避免H264问题)
  capture_height: 480  # 期望的捕获高度
  capture_fps: 15      # 期望的捕获帧率 (降低以减少编码负担)
  # 优先编码格式 ("YUYV", "MJPEG", "AUTO")
  preferred_codec: "YUYV"
